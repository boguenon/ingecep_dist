IG$._I95.prototype.JJ$4=function(a6,az){var ao,an,bb=this,bo=bb._ILb?bb._ILb.cco:null,H=az.data,bu=az.colfix,bh=az.rowfix,aV=(H.length>0)?H[0].length:0,A,aI=[],bi=[],bc,aO,aA=bb.cop.relationgroups;bb.drawmode="protovis";bb.mresult=az;bb.rct=a6;var b=$(bb.container),aa=IG$.x_10._w(b),aq=IG$.x_10._h(b);switch(a6){case"boxplot":var B=[],bz=[],aM,bc,a8=[],K=0;for(ao=bu;ao<aV;ao++){for(an=0;an<bh;an++){aM=(an==0)?H[an][ao].text:aM+IG$.sX+H[an][ao].text}bz.push(aM);a8.push({id:aM,median:0,uq:0,lq:0,max:0,min:0})}for(ao=bu;ao<aV;ao++){bc=[];var bw=Number(H[bh][ao].code),D=bw,bg=0,aj,bk,bC,ar=parseInt((H.length-bh)*0.8),bs=parseInt((H.length-bh)*0.2),a9=parseInt((H.length-bh)*0.5);for(an=bh;an<H.length;an++){bC=Number(H[an][ao].code);bw=Math.min(bw,bC);D=Math.max(D,bC);bg+=bC;bc.push(bC)}bc=bc.sort(function(h,c){return h-c});a8[ao-bu].min=bw;a8[ao-bu].max=D;a8[ao-bu].median=bc[a9];a8[ao-bu].lq=bc[bs];a8[ao-bu].uq=bc[ar];K=Math.max(K,D)}var aZ=aa,ba=aq;bb.vismargin={top:0,bottom:20,right:20,left:40};aa-=bb.vismargin.left+bb.vismargin.right;aq-=bb.vismargin.top+bb.vismargin.bottom;var Z=pv.Scale.ordinal(a8,function(c){return c.id}).splitBanded(0,aa,3/5);X=pv.Scale.linear(0,K).range(0,aq);af=Z.range().band/2;bb.vis=new pv.Panel().canvas(bb.container).width(aa).height(aq).top(bb.vismargin.top).bottom(bb.vismargin.bottom).left(bb.vismargin.left).right(bb.vismargin.right);bb.vis.add(pv.Rule).data(X.ticks()).bottom(X).strokeStyle(function(c){return(c==0||c==1)?"#000":"#ccc"}).anchor("left").add(pv.Label).text(X.tickFormat);var ai=bb.vis.add(pv.Panel).data(a8).left(function(c){return Z(c.id)}).width(af*2);ai.anchor("bottom").add(pv.Label).textBaseline("top").text(function(c){return c.id});ai.add(pv.Rule).left(af).bottom(function(c){return X(c.min)}).height(function(c){return X(c.max)-X(c.min)});ai.add(pv.Rule).data(function(c){return[c.min,c.max]}).bottom(X).left(af/2).width(af);ai.add(pv.Bar).bottom(function(c){return X(c.lq)}).height(function(c){return X(c.uq)-X(c.lq)}).fillStyle(function(c){return c.median>0.5*(c.uq-c.lq)+c.lq?"#aec7e8":"#ffbb78"}).strokeStyle("black").lineWidth(1).antialias(false);ai.add(pv.Rule).bottom(function(c){return X(c.median)});bb.vis.render();break;case"performancemap":var B=[],bz=["Name"],aM,bc,l,a1=30,bd=100;for(ao=bu;ao<aV;ao++){for(an=0;an<bh;an++){aM=(an==0)?H[an][ao].text:aM+IG$.sX+H[an][ao].text}l=IG$.measureText(12,aM);a1=Math.max(l.width+10,a1);bz.push(aM)}for(ao=bh;ao<H.length;ao++){bc=[];for(an=0;an<bu;an++){aM=(an==0)?H[ao][an].text:aM+IG$.sX+H[ao][an].text}l=IG$.measureText(12,aM);bd=Math.max(l.width,bd);bc.push(aM);for(an=bu;an<aV;an++){bc.push(Number(H[ao][an].code)||0)}B.push(bc)}B=B.map(function(c){return pv.dict(bz,function(){return c[this.index]})});bz.shift();var Z=pv.dict(bz,function(c){return pv.mean(B,function(h){return h[c]})}),af=pv.dict(bz,function(c){return pv.deviation(B,function(h){return h[c]})}),N=pv.dict(bz,function(c){return pv.Scale.linear().domain(-3*af[c]+Z[c],3*af[c]+Z[c]).range("white","steelblue")});var am=24,aF=13;bb.vismargin={top:a1,left:bd,width:bz.length*am,height:B.length*aF};var bm=$(bb.container),bp=Math.max(bb.vismargin.width+bb.vismargin.left,aa),aw=Math.max(bb.vismargin.top+bb.vismargin.height,aq);bm.css({overflow:"scroll"});bb.vis=new pv.Panel().canvas(bb.container).width(bb.vismargin.width).height(bb.vismargin.height).top(a1).left(bd);bb.vis.add(pv.Panel).data(bz).left(function(){return this.index*am}).width(am).add(pv.Panel).data(B).top(function(){return this.index*aF}).height(aF).fillStyle(function(h,c){return N[c](h[c])}).strokeStyle("white").lineWidth(1).antialias(false).title(function(h,c){return h.Name+"'s "+c+": "+h[c]});bb.vis.add(pv.Label).data(bz).top(3).left(function(){return this.index*am+am/2}).textAngle(-Math.PI/2).textBaseline("middle");bb.vis.add(pv.Label).data(B).top(function(){return this.index*aF+aF/2}).left(3).textAlign("right").textBaseline("middle").text(function(c){return c.Name});bb.vis.render();break;case"parallel":for(ao=bu;ao<H[0].length;ao++){A="";for(an=0;an<bh;an++){A=(an==0?H[ao][an].text:A+IG$.sX+H[ao][an].text)}aI.push(A)}var al=[],bz=[],f={},F;for(ao=bu;ao<H[0].length;ao++){A="";for(an=0;an<bh;an++){A=(an==0)?H[an][ao].text:A+IG$.sX+H[an][ao].text}f[A]={name:A,unit:""};bz.push(A)}var a=pv.keys(f);for(ao=bh;ao<H.length;ao++){A="";for(an=0;an<bu;an++){A=(an==0)?H[ao][an].text:A+IG$.sX+H[ao][an].text}var ag={};ag.name=A;for(an=bu;an<H[ao].length;an++){ag[bz[an-bu]]=Number(H[ao][an].code)}al.push(ag)}bb.vismargin={left:30,right:30,top:30,bottom:40};aa-=bb.vismargin.left+bb.vismargin.right;aq-=bb.vismargin.top+bb.vismargin.bottom;var ap=0.5,Z=pv.Scale.ordinal(a).splitFlush(0,aa),X=pv.dict(a,function(c){return pv.Scale.linear(al.filter(function(h){return !isNaN(h[c])}),function(h){return Math.floor(h[c])-ap},function(h){return Math.ceil(h[c])+ap}).range(0,aq)}),au=pv.dict(a,function(c){return pv.Scale.linear(al.filter(function(h){return !isNaN(h[c])}),function(h){return Math.floor(h[c])-ap},function(h){return Math.ceil(h[c])+ap}).range("steelblue","brown")});var R=pv.dict(a,function(c){return{min:X[c].domain()[0],max:X[c].domain()[1]}}),aE=a[0];bb.vis=new pv.Panel().canvas(bb.container).width(aa).height(aq).left(bb.vismargin.left).right(bb.vismargin.right).top(bb.vismargin.top).bottom(bb.vismargin.bottom);var by=bb.vis.add(pv.Panel).data(al).visible(function(c){F=a.every(function(h){return(c[h]>=R[h].min)&&(c[h]<=R[h].max)});return F});by.add(pv.Line).data(a).left(function(c,h){return Z(c)}).bottom(function(c,h){return X[c](h[c])}).strokeStyle("#ddd").lineWidth(1).antialias(false);var M=bb.vis.add(pv.Rule).data(a).left(Z);M.anchor("top").add(pv.Label).top(-12).font("bold 10px sans-serif").text(function(c){return f[c].name});var aW=bb.vis.add(pv.Panel);var p=aW.add(pv.Panel).data(al).visible(function(c){F=a.every(function(h){return(c[h]>=R[h].min)&&(c[h]<=R[h].max)});return F});p.add(pv.Line).data(a).left(function(c,h){return Z(c)}).bottom(function(c,h){return X[c](h[c])}).strokeStyle(function(c,h){return au[aE](h[aE])}).lineWidth(1);var Y=function(h){var c=h.dim;R[c].min=Math.max(X[c].domain()[0],X[c].invert(aq-h.y-h.dy));R[c].max=Math.min(X[c].domain()[1],X[c].invert(aq-h.y));aE=c;bb.Umx.call(bb,R,bz);aW.render();return false};var a4=function(h){if(h.dy<3){var c=h.dim;R[c].min=Math.max(X[c].domain()[0],X[c].invert(0));R[c].max=Math.min(X[c].domain()[1],X[c].invert(aq));h.y=0;h.dy=aq;aE=c;bb.Umx.call(bb,null);aW.render()}return false};var aQ=aW.add(pv.Panel).data(a.map(function(c){return{y:0,dy:aq,dim:c}})).left(function(c){return Z(c.dim)-30}).width(60).fillStyle("rgba(0,0,0,.001)").cursor("crosshair").event("mousedown",pv.Behavior.select()).event("select",Y).event("selectend",a4).add(pv.Bar).left(25).top(function(c){return c.y}).width(10).height(function(c){return c.dy}).fillStyle(function(c){return c.dim==aE?au[c.dim]((R[c.dim].max+R[c.dim].min)/2):"hsla(0,0,50%,.5)"}).strokeStyle("white").cursor("move").event("mousedown",pv.Behavior.drag()).event("dragstart",Y).event("drag",Y);aQ.anchor("bottom").add(pv.Label).textBaseline("top").text(function(c){return R[c.dim].min.toFixed(0)+f[c.dim].unit});aQ.anchor("top").add(pv.Label).textBaseline("bottom").text(function(c){return R[c.dim].max.toFixed(0)+f[c.dim].unit});bb.vis.render();if(!bb.sbx){bb.sbx=$("<div class='m-vis-selbutton'>Selected</div>").appendTo(bb.P1);bb.sbx.bind("click",function(){bb.pj4.call(bb,null)})}break;case"networkdiagram_pos":case"networkdiagram_neg":var aG=(bb.cop.rel_range1==IG$.UNDEFINED||bb.cop.rel_range1==null)?-1:bb.cop.rel_range1,aD=(bb.cop.rel_range2==IG$.UNDEFINED||bb.cop.rel_range2==null)?1:bb.cop.rel_range2;bb.vismargin={left:0,right:0,top:0,bottom:90};aa-=bb.vismargin.left+bb.vismargin.right;aq-=bb.vismargin.top+bb.vismargin.bottom;var q=bb.JJ$1(az,(a6=="networkdiagram_pos")?1:0,false,aA,{s:aG,t:aD});bb.vis=new pv.Panel().canvas(bb.container).width(aa).height(aq).bottom(90);var bv=bb.vis.add(pv.Layout.Arc).nodes(q.nodes).links(q.links).sort(function(h,c){return h.group==c.group?c.linkDegree-h.linkDegree:c.group-h.group});bv.link.add(pv.Line);bv.node.add(pv.Dot).size(function(c){return c.linkDegree+4}).fillStyle(pv.Colors.category19().by(function(c){return c.group})).strokeStyle(function(){return this.fillStyle().darker()});bv.label.add(pv.Label);bb.vis.render();break;case"matrixdiagram":var J=pv.Colors.category19().by(function(c){return c.group}),aG=(bb.cop.rel_range1==IG$.UNDEFINED||bb.cop.rel_range1==null)?-1:bb.cop.rel_range1,aD=(bb.cop.rel_range2==IG$.UNDEFINED||bb.cop.rel_range2==null)?1:bb.cop.rel_range2;bb.vismargin={left:90,right:0,top:90,bottom:0};aa-=bb.vismargin.left+bb.vismargin.right;aq-=bb.vismargin.top+bb.vismargin.bottom;var q=bb.JJ$1(az,2,false,aA,{s:aG,t:aD});bb.vis=new pv.Panel().canvas(bb.container).width(aa).height(aq).top(bb.vismargin.top).left(bb.vismargin.left);var aU=bb.vis.add(pv.Layout.Matrix).nodes(q.nodes).links(q.links).sort(function(h,c){return c.group-h.group});aU.link.add(pv.Bar).fillStyle(function(c){return c.linkValue?((c.targetNode.group==c.sourceNode.group)?J(c.sourceNode):"#555"):"#eee"}).antialias(false).lineWidth(1);aU.label.add(pv.Label).textStyle(J);bb.vis.render();break;case"anderson":var ac=150,I=20;var o=[],ay={},ak=[],aL=[],aK=0,ae,aV=H[0].length,a3,aP;for(ao=bu;ao<H[0].length;ao++){A="";for(an=0;an<bh;an++){A=(an==0)?H[an][ao].text:A+"_"+H[an][ao].text}ak.push(A)}for(ao=0;ao<bb._ILb.rows.length;ao++){if(bb._ILb.rows[ao].name==bb.cop.andersonspecies){aK=ao;break}}for(ao=bh;ao<H.length;ao++){ae=H[ao][aK].text;if(!ay[ae]){ay[ae]=ae}a3={species:ae};for(an=bu;an<aV;an++){a3[ak[an-bu]]=H[ao][an].code}aL.push(a3)}for(aP in ay){o.push(aP)}var bm=$(bb.container),bp=Math.max((ac+I)*ak.length,aa),aw=Math.max((ac+I)*ak.length,aq)+I;bm.css({overflow:"scroll"});var e=pv.rgb(144,144,144,0.2),J=pv.colors("rgba(30, 108, 11, 1)","rgba(0, 72, 140, 1)","rgba(51, 38, 9, 1)","rgba(216, 64, 0, 1)","rgba(67, 76, 67, 1)","rgba(179, 0, 35, 1)","rgba(248, 215, 83, 1)","rgba(92, 151, 70, 1)","rgba(62, 117, 167, 1)","rgba(122, 101, 62, 1)","rgba(225, 102, 42, 1)","rgba(116, 121, 111, 1)","rgba(196, 56, 79, 1)","rgba(255, 248, 163, 1)","rgba(196, 204, 143, 1)","rgba(178, 200, 217, 1)","rgba(190, 163, 122, 1)","rgba(243, 170, 121, 1)","rgba(181, 181, 169, 1)","rgba(230, 165, 164, 1)"),a5=pv.dict(ak,function(c){return pv.Scale.linear(aL,function(h){return h[c]}).range(0,ac)});bb.vismargin={left:10,right:0,top:5,bottom:0};aa-=bb.vismargin.left+bb.vismargin.right;aq-=bb.vismargin.top+bb.vismargin.bottom;bb.vismargin.width=bp;bb.vismargin.height=aw;bb.vis=new pv.Panel().canvas(bb.container).width((ac+I)*ak.length).height((ac+I)*ak.length+I).left(bb.vismargin.left).top(bb.vismargin.top);var S=bb.vis.add(pv.Panel).data(ak).top(function(){return this.index*(ac+I)+I/2}).height(ac).add(pv.Panel).data(function(c){return ak.map(function(h){return({px:h,py:c})})}).left(function(){return this.index*(ac+I)+I/2}).width(ac);var bq=S.add(pv.Panel).visible(function(c){return c.px!=c.py}).strokeStyle("#aaa");var av=bq.add(pv.Rule).data(function(c){return a5[c.px].ticks(5)}).left(function(h,c){return a5[c.px](h)}).strokeStyle("#eee");av.anchor("bottom").add(pv.Label).visible(function(){return(S.parent.index==ak.length-1)&&!(S.index&1)}).text(function(h,c){return a5[c.px].tickFormat(h)});av.anchor("top").add(pv.Label).visible(function(){return(S.parent.index==0)&&(S.index&1)}).text(function(h,c){return a5[c.px].tickFormat(h)});var Q=bq.add(pv.Rule).data(function(c){return a5[c.py].ticks(5)}).bottom(function(h,c){return a5[c.py](h)}).strokeStyle("#eee");Q.anchor("left").add(pv.Label).visible(function(){return(S.index==0)&&(S.parent.index&1)}).text(function(h,c){return a5[c.py].tickFormat(h)});Q.anchor("right").add(pv.Label).visible(function(){return(S.index==ak.length-1)&&!(S.parent.index&1)}).text(function(h,c){return a5[c.py].tickFormat(h)});var G=bq.add(pv.Dot).data(aL).left(function(h,c){return a5[c.px](h[c.px])}).bottom(function(h,c){return a5[c.py](h[c.py])}).size(10).strokeStyle(null).fillStyle(function(c){return af&&((c[af.px]<af.x1)||(c[af.px]>af.x2)||(c[af.py]<af.y1)||(c[af.py]>af.y2))?e:J(c.species)});var aT=bb.vis;var u=function(h,c){af=h;af.px=c.px;af.py=c.py;af.x1=a5[c.px].invert(h.x);af.x2=a5[c.px].invert(h.x+h.dx);af.y1=a5[c.py].invert(ac-h.y-h.dy);af.y2=a5[c.py].invert(ac-h.y);G.context(null,0,function(){aT.render()});bb.Umx.call(bb,null,ak,af)};bq.add(pv.Panel).data([{x:20,y:20,dx:100,dy:100}]).cursor("crosshair").events("all").event("mousedown",pv.Behavior.select()).event("selectstart",function(){af=null;return aT}).event("select",u).add(pv.Bar).visible(function(r,c,h){return af&&af.px==h.px&&af.py==h.py}).left(function(c){return c.x}).top(function(c){return c.y}).width(function(c){return c.dx}).height(function(c){return c.dy}).fillStyle("rgba(0,0,0,.15)").strokeStyle("white").cursor("move").event("mousedown",pv.Behavior.drag()).event("drag",u);S.anchor("center").add(pv.Label).visible(function(c){return c.px==c.py}).font("bold 14px sans-serif").text(function(c){return c.px.replace(/([WL])/," $1").toLowerCase()});bb.vis.add(pv.Dot).data(o).bottom(10).left(function(){return 15+this.index*65}).size(8).strokeStyle(null).fillStyle(J).anchor("right").add(pv.Label);bb.vis.render();if(!bb.sbx){bb.sbx=$("<div class='m-vis-selbutton'></div>").appendTo(bb.P1);bb.sbx.bind("click",function(){bb.pj4.call(bb,null)})}break;case"forcelayout":bb.vismargin={left:0,right:0,top:0,bottom:0};aa-=bb.vismargin.left+bb.vismargin.right;aq-=bb.vismargin.top+bb.vismargin.bottom;var a7=pv.Colors.category19(),aG=(bb.cop.rel_range1==IG$.UNDEFINED||bb.cop.rel_range1==null)?-1:bb.cop.rel_range1,aD=(bb.cop.rel_range2==IG$.UNDEFINED||bb.cop.rel_range2==null)?1:bb.cop.rel_range2;var q=bb.JJ$1(az,2,true,aA,{s:aG,t:aD});bb.vis=new pv.Panel().canvas(bb.container).width(aa).height(aq).fillStyle("white").event("mousedown",pv.Behavior.pan()).event("mousewheel",pv.Behavior.zoom());var ax=bb.vis.add(pv.Layout.Force).nodes(q.nodes).links(q.links).chargeConstant(-9000);ax.link.add(pv.Line);ax.node.add(pv.Dot).size(function(c){return(c.linkDegree+4)*Math.pow(this.scale,-1.5)}).fillStyle(function(c){return c.fix?"brown":a7(c.group)}).strokeStyle(function(){return this.fillStyle().darker()}).lineWidth(1).title(function(c){return c.nodeName}).event("mousedown",pv.Behavior.drag()).event("drag",ax);bb.vis.render();break;case"chord":var bB=[],bc,m,aR=[],aV=H[0].length,bD=bo?bo.chd_method||"relations":"relations",T=aV-bu,aN=[],C=0,bx,J=d3.scale.category20c(),aG=(bb.cop.rel_range1==IG$.UNDEFINED||bb.cop.rel_range1==null)?-1:bb.cop.rel_range1,aD=(bb.cop.rel_range2==IG$.UNDEFINED||bb.cop.rel_range2==null)?1:bb.cop.rel_range2;if(bD=="tablematrix"){var aY={},P=[],af=0,ad,E,ab,d,bA;if(bu>0){for(ao=bh;ao<H.length;ao++){ad=H[ao][0].code;if(!aY[ad]){E={name:ad,seq:af,r:ao,c:-1};P.push(E);af++;aY[ad]=E;aN.push({title:ad,code:ad})}}for(ao=bu;ao<aV;ao++){ad=H[0][ao].code;if(aY[ad]){aY[ad].c=ao}}for(ao=0;ao<P.length;ao++){bc=[];bA=P[ao].r;for(an=0;an<P.length;an++){d=P[an].c;ab=0;if(d>-1){ab=Number(H[bA][d].code)||0}if(ab>0){C=1}bc.push(ab)}bB.push(bc)}}}else{var br=bb.JJ$1(az,2,false,aA,{s:aG,t:aD}),T=br.nodes.length,ad;for(ao=0;ao<br.nodes.length;ao++){bc=[];ad=br.nodes[ao].nodeName;aR.push({name:ad});for(an=0;an<br.nodes.length;an++){bc.push(0)}aN.push({title:ad,code:ad});bB.push(bc)}for(ao=0;ao<br.links.length;ao++){m=br.links[ao];bB[m.source][m.target]=(m.value+1);if(m.source!=m.target){bB[m.target][m.source]=(m.value+1);C=1}}}if(C==0){return}var aZ=aa,ba=aq,aB=(bo?bo.colorset:"")||az.c_cset,aJ=d3.layout.chord().sortSubgroups(d3.descending).matrix(bB),L=Math.min(aa,aq)*0.41,z=L*1.1,a7=["#009CFF","#FBE105","#72C936","#C42AD8","#2164E9","#FF9600","#F02F1B"];if(IG$.__c_&&IG$.__c_.chartcolors&&IG$.__c_.chartcolors[aB]){a7=IG$.__c_.chartcolors[aB]}var N=d3.scale.ordinal().domain(d3.range(a7.length)).range(a7),bv=d3.svg.arc().innerRadius(L).outerRadius(z),W=d3.svg.chord().radius(L);bb.vis=aJ;function aX(h,c){h.transition().duration(3000).style("stroke",function(r){return N(c.index)}).attr("stroke-dashoffset","1000").attr("animation","dash 5s linear forwards")}function at(c){return function(r,h){var h=d3.interpolate(c.groups()[h],r);return function(s){return bv(h(s))}}}function V(c){return function(r,h){var h=d3.interpolate(c.chords()[h],r);return function(s){return W(h(s))}}}function n(h){var c=(h.endAngle-h.startAngle)/h.value;return[{angle:h.value*c/2+h.startAngle,label:aN[h.index].title}]}function bj(c){return function(r,h){a0.selectAll(".chord path").transition().ease("linear in ").delay(function(t,s){return s*10}).filter(function(s){return s.source.index!=h&&s.target.index!=h}).style("opacity",c)}}var a0=d3.select(bb.container).append("svg").attr("width",aZ).attr("height",ba).append("g").attr("id","circle").attr("transform","translate("+aZ/2+","+ba/2+")");var O=a0.append("defs"),U=[],aS;for(ao=0;ao<a7.length;ao++){aS=O.append("linearGradient").attr("id","color"+ao);aS.append("stop").attr("offset","0%").attr("stop-color",a7[ao]);aS.append("stop").attr("offset","100%").attr("stop-color",a7[ao]);U.push(aS)}a0.append("g").selectAll("path").data(aJ.groups).enter().append("path").attr("class","arc").style("fill",function(c){return N(c.index)}).style("stroke","#FFFFFF").style("stroke-width","3.5px").attr("d",bv).on("mouseover",function(c){d3.select(this).transition().duration(100).style("stroke","gold").style("stroke-width","2.5px").style("cursor","pointer")}).on("mouseout",function(c){d3.select(this).transition().duration(100).style("stroke","#FFFFFF").style("stroke-width","2.5px")}).on("click",function(h,c){bx=h.index;a0.selectAll(".chord path").transition().ease("linear-in").style("opacity",function(s,r){if(h.index!=s.source.index&&h.index!=s.target.index){return 0.1}else{return 1}}).style("stroke",function(s,r){if(h.index!=s.source.index&&h.index!=s.target.index){return"#FFF"}else{return"#FFF"}}).style("stroke-width",function(s,r){if(h.index!=s.source.index&&h.index!=s.target.index){return"0px"}else{return"1px"}}).call(aX,h);a0.select(".chord").selectAll("path").style("fill",function(w,t){var v,s;if(w.source.index==h.index||w.source.subindex==h.index){s=h.index%U.length;if(U[s]){v="url(#color"+s+")"}}return v})});function aH(v,c,t){var h="",s="",r="";if(v=="S"){h=aN[c].title;s=aN[t].title;r="<span style='color:#C0FF00'>"+bB[c][t]+" </span>"}return h+" "+s+"<br><br>"+r}var a2=d3.tip().attr("class","d3-tip").offset([0,0]).html(function(c){return aH("S",c.source.index,c.source.subindex)});a0.call(a2);var be=a0.append("g").attr("class","ticks").selectAll("g").data(aJ.groups).enter().append("g").attr("class","group").selectAll("g").data(n).enter().append("g").attr("class","neighs").attr("transform",function(c){return"rotate("+(c.angle*180/Math.PI-90)+")translate("+z+",0)"});be.append("line").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0).style("stroke","#ffffff");be.append("text").attr("x",8).attr("dy",".35em").attr("transform",function(c){return c.angle>Math.PI?"rotate(180)translate(-16)":null}).style("text-anchor",function(c){return c.angle>Math.PI?"end":null}).style("text-weight","bold").style("text-size","13px").text(function(c){return c.label});var bl=a0.append("g").attr("class","chord").selectAll("path").data(aJ.chords).enter().append("path").style("opacity",0).attr("d",W).on("mouseover",a2.show).on("mouseout",a2.hide);a0.selectAll(".ticks").selectAll(".group").data(aJ.groups).selectAll(".neighs").data(n).transition().duration(1500).attr("transform",function(c){return"rotate("+(c.angle*180/Math.PI-90)+")translate("+z+",0)"});a0.selectAll(".arc").data(aJ.groups).transition().duration(1500).select("title").text(function(h,c){return neighs[c].name+": "+formatPercent(h.value)+" of origins"});a0.select(".chord").selectAll("path").data(aJ.chords).style("fill",function(t,h){var s,c=t.target.index%U.length;if(U[c]){s="url(#color"+c+")"}return s}).transition().duration(1500).style("opacity",1).attrTween("d",V(aJ));break;case"sunburst":if(!window.d3){return}var aZ=aa,ba=aq,ah=Math.min(aZ,ba)/2,bn,bt=bu;J=d3.scale.category20c(),sundata={name:"root",children:[]},aV=H[0].length,pva=[];for(ao=0;ao<bu;ao++){pva.push({name:null,child:sundata})}for(ao=bh;ao<H.length;ao++){for(an=0;an<bu;an++){if(pva[an].name!=H[ao][an].code){if(an==0){bn={name:H[ao][an].code};sundata.children.push(bn);pva[an].child=bn}else{bn={name:H[ao][an].code};pva[an-1].child.children.push(bn);pva[an].child=bn}pva[an].name=bn.name;if(an==bu-1){bn.size=Number(H[ao][bt].code||0)}else{bn.children=[]}}}}function g(c){c.x0=c.x;c.dx0=c.dx}function at(c){var h=d3.interpolate({x:c.x0,dx:c.dx0},c);return function(s){var r=h(s);c.x0=r.x;c.dx0=r.dx;return bv(r)}}bb.vis=d3.select(bb.container).append("svg:svg").attr("width",aZ).attr("height",ba).append("svg:g").attr("transform","translate("+aa/2+","+aq/2+")");var bf=d3.layout.partition().sort(null).size([2*Math.PI,ah*ah]).value(function(c){return c.size});var bv=d3.svg.arc().startAngle(function(c){return c.x}).endAngle(function(c){return c.x+c.dx}).innerRadius(function(c){return Math.sqrt(c.y)}).outerRadius(function(c){return Math.sqrt(c.y+c.dy)});var aC=bb.vis.data([sundata]).selectAll("g").data(bf.nodes).enter().append("svg:g").attr("display",function(c){return c.depth?null:"none"});aC.append("svg:path").attr("d",bv).attr("fill-rule","evenodd").style("stroke","#fff").style("fill",function(c){return J((c.children?c:c.parent).name)}).each(g);aC.append("svg:text").attr("transform",function(c){return"rotate("+(c.x+c.dx/2-Math.PI/2)/Math.PI*180+")"}).attr("x",function(c){return Math.sqrt(c.y)}).attr("dx","6").attr("dy",".35em").text(function(c){return c.name});d3.select("#size").on("click",function(){aC.data(bf.value(function(c){return c.size})).transition().duration(1500).attrTween("d",at);d3.select("#size").classed("active",true);d3.select("#count").classed("active",false)});d3.select("#count").on("click",function(){aC.data(bf.value(function(c){return 1})).transition().duration(1500).attrTween("d",at);d3.select("#size").classed("active",false);d3.select("#count").classed("active",true)});break}};IG$._I95.prototype.JJ$4a=function(l,c){var a,f=this;f.drawmode="dcust";f.mresult=c;f.rct=l;var g=$(f.container),d=IG$.x_10._w(g),e=IG$.x_10._h(g);switch(l){case"bullet":a=new IG$._ICa($(f.container));a.i2.call(a,f.mresult);f.dcust=a;break;case"nation":a=new IG$.qiNul($(f.container),f._ILb,f.cop);a.i2.call(a,f.mresult);f.dcust=a;break}};IG$._I95.prototype.JJ$1=function(w,m,h,c,l){var x=this,r,p,y=w.data,n=w.colfix,f=w.rowfix,z,g,d,o=[],v,u,s,t,e={nodes:[],links:[]},q,c=(c)?c.split(","):null;for(r=n;r<y[0].length;r++){z="";for(p=0;p<f;p++){z=(p==0?y[p][r].text:z+IG$.sX+y[p][r].text)}e.nodes.push({nodeName:z,group:(c&&c.length>r-n&&c[r-n]!="")?parseInt(c[r-n]):r})}s=e.nodes.length;for(r=f;r<y.length;r++){g=[];for(p=n;p<y[r].length;p++){d=Number(y[r][p].code)||0;g.push(d)}o.push(g)}for(v=0;v<s;v++){for(u=0;u<v+1;u++){if(v!=u){t={source:v,target:u};q=x.JJ$2.call(x,o,v,u);if(l.s<=q&&q<=l.t){t.value=q;t.value=(h==true)?(q+1)*10:q*10;if(m==1){if(q>0){e.links.push(t)}}else{if(m==0){if(q<0){e.links.push(t)}}else{e.links.push(t)}}}}}}return e};IG$._I95.prototype.JJ$2=function(h,u,t){var m=h.length,e=0,p=0,n=0,c=0,v=0,d,g;for(g=0;g<h.length;g++){d=h[g];var f=d[u];var r=d[t];e+=f;p+=r;n+=Math.pow(f,2);c+=Math.pow(r,2);v+=f*r}var s=(m*v)-(e*p);var q=Math.sqrt((m*n)-Math.pow(e,2));var l=Math.sqrt((m*c)-Math.pow(p,2));return s/(q*l)};IG$._I95.prototype.JJ$3=function(b){var f,d,e=b.data,c=b.colfix,h=b.rowfix,m,g=[],a=[],o,n,l=this;l.drawmode="qavis";for(f=c;f<e[0].length;f++){m="";for(d=0;d<h;d++){m=(d==0?e[d][f].text:m+IG$.sX+e[d][f].text)}g.push(m)}for(f=h;f<e.length;f++){o=[];for(d=c;d<e[f].length;d++){n=Number(e[f][d].code);o.push(n)}a.push(o)}l.qavis=new IG$.c$s22(l.container,{cr1:l.cop.comp_range0,cr2:l.cop.comp_range1});l.qavis.m1$5=a;l.qavis.fields=g;l.qavis.c10()};IG$._I95.prototype.centroid=function(m){var a=m.length;var g=0;var e=0;var d;var b=a-1;var l;var h;for(var c=0;c<a;b=c++){l=m[c];h=m[b];d=l.lng*h.lat-h.lng*l.lat;g+=(l.lng+h.lng)*d;e+=(l.lat+h.lat)*d}d=this.area(m)*6;return{lng:g/d,lat:e/d}};IG$._I95.prototype.l3=function(v){var h,e,q="d3ext",x=this;if(q=="google"){e="map__US";if(typeof(IG$._I5f[e])=="undefined"){x.l2("US","",e,"ploc",x);return}var m=IG$._I5f[e];h=new google.maps.LatLng(37.09024,-95.712891);var p={zoom:4,center:h,mapTypeId:google.maps.MapTypeId.ROADMAP};var w=new google.maps.Map(x.container,p);if(typeof(m)!="undefined"){var s,r,o=180000,n=3000;var d={};var b=NaN;var z=NaN;for(s=v.rowfix;s<v.data.length;s++){var f=v.data[s][0].text;if(typeof(m.data[f])!="undefined"){var u=0;var a;for(r=v.colfix;r<v.cols;r++){a=v.data[s][r].code;u+=Number(a)}if(typeof(d[f])=="undefined"){d[f]={};d[f].lat=m.data[f].lat;d[f].lng=m.data[f].lng;d[f].value=u;b=(isNaN(b)==true)?u:Math.max(b,u);z=(isNaN(z)==true)?u:Math.min(z,u)}else{d[f].value+=u;b=Math.max(b,d[f].value);z=Math.min(z,d[f].value)}}}for(var A in d){h=new google.maps.LatLng(d[A].lat,d[A].lng);var y=(b-z==0)?1:((d[A].value-z)/(b-z));var g=(o-n)*y;var t=IG$._I15("153a6f","a7d6ef",10,y*10);var l={center:h,radius:g,strokeColor:"#efefef",strokeOpacity:0.5,strokeWeight:1,fillColor:t,fillOpacity:0.6};var c=new google.maps.Circle(l);c.setMap(w)}}}else{if(q=="protovis"){x.l4(v)}else{if(q=="d3"){x.l5(v)}else{if(q=="gsapi"){x.l6()}else{if(q=="d3ext"){x.l5a(v)}}}}}};IG$._I95.prototype.l4=function(c){var m=this;var d=function(h){if(h<17){return"#008038"}if(h<20){return"#A3D396"}if(h<23){return"#FDD2AA"}if(h<26){return"#F7976B"}if(h<29){return"#F26123"}if(h<32){return"#E12816"}return"#B7161E"};us_lowres.forEach(function(h){h.code=h.code.toUpperCase();h.centLatLon=m.centroid(h.borders[0])});var p=[];for(i=c.rowfix;i<c.data.length;i++){var l=c.data[i][0].text;var b=0;var e;for(j=c.colfix;j<c.cols;j++){e=c.data[i][j].code;b+=Number(e)}p[l]=b}var n=$(m.container),o=IG$.x_10._w(n),g=IG$.x_10._h(n);var f=pv.Geo.scale().domain({lng:-128,lat:24},{lng:-64,lat:50}).range({x:0,y:0},{x:o,y:g});m.vismargin={top:30,bottom:20};m.vis=new pv.Panel().canvas(m.container).width(o).height(g-m.vismargin.top-m.vismargin.bottom).top(30).bottom(20);var a=m.vis.add(pv.Panel).data(us_lowres);a.add(pv.Panel).data(function(h){return h.borders}).add(pv.Line).data(function(h){return h}).left(f.x).top(f.y).fillStyle(function(q,h,r){return d(p[r.code])}).lineWidth(1).strokeStyle("white").antialias(false);m.vis.add(pv.Label).data(us_lowres).left(function(h){return f(h.centLatLon).x}).top(function(h){return f(h.centLatLon).y}).text(function(h){return h.code}).textAlign("center").textBaseline("middle");m.vis.add(pv.Bar).data(pv.range(14,32.1,3)).bottom(function(h){return this.index*12}).height(10).width(10).left(5).fillStyle(function(h){return d(14+3*this.index)}).lineWidth(null).anchor("right").add(pv.Label).textAlign("left").text(function(h){return h+" - "+(h+3)+"%"});m.vis.render()};IG$._I95.prototype.l5=function(d){var l=this;var e=function(p){if(p<17){return"#008038"}if(p<20){return"#A3D396"}if(p<23){return"#FDD2AA"}if(p<26){return"#F7976B"}if(p<29){return"#F26123"}if(p<32){return"#E12816"}return"#B7161E"};var o=d3.geo.path();var g=d3.select(l.container).append("svg");var c=g.append("g").attr("id","counties").attr("class","Blues");var n=g.append("g").attr("id","states");d3.json("./data/us-counties.json",function(p){c.selectAll("path").data(p.features).enter().append("path").attr("class",data?b:null).attr("d",o)});d3.json("./data/us-states.json",function(p){n.selectAll("path").data(p.features).enter().append("path").attr("d",o)});var m=[];for(i=d.rowfix;i<d.data.length;i++){var h=d.data[i][0].text;var a=0;var f;for(j=d.colfix;j<d.cols;j++){f=d.data[i][j].code;a+=Number(f)}m[h]=a}c.selectAll("path").attr("class",b);function b(p){return"q"+Math.min(8,~~(m[p.id]*9/12))+"-9"}};IG$._I95.prototype.l5a=function(){var D=this,g,A,z,b,r,C=D.mresult,x=C.colfix,p=C.rowfix,E=C.data,t=(E.length>0)?E[0].length:0,v=D.container,e=D.cop,a=D._ILb,f=e.mapcategory,u=-1,s=(IG$.mLU?IG$.mLU.maptype:null),m=null,q={},d,y,B,o,F,w=[],l=function(c){if(c<17){return"#008038"}if(c<20){return"#A3D396"}if(c<23){return"#FDD2AA"}if(c<26){return"#F7976B"}if(c<29){return"#F26123"}if(c<32){return"#E12816"}return"#B7161E"};if(s){for(A=0;A<s.length;A++){if(s[A].subtype==e.maptype){m=s[A];break}}}if(a){for(A=0;A<a.rows.length;A++){if(a.rows[A].uid==f){u=A;break}}if(u<0&&a.rows.length>0){u=0}}if(m==null){return}for(A=x;A<t;A++){F="";for(z=0;z<p;z++){b=E[z][A];F+=(b.text||b.code)+IG$.sX}w.push({cindex:A,c:A-x,name:F,maxvalue:null,minvalue:null,sumvalue:0})}for(A=p;A<E.length;A++){d=((u>-1)?E[A][u].code:"NO_REGION");d=d?d.toLowerCase():"";if(q[d]){o=q[d]}else{q[d]=o=[];for(z=0;z<w.length;z++){o.push(0)}}for(z=x;z<t;z++){B=z-x;b=E[A][z];y=(b.code&&b.code!="")?parseFloat(b.code):0;o[B]+=y;w[B].maxvalue=(w[B].maxvalue==null)?o[B]:Math.max(w[B].maxvalue,o[B]);w[B].minvalue=(w[B].minvalue==null)?o[B]:Math.min(w[B].minvalue,o[B]);w[B].sumvalue+=y}}g="./data/"+m.filename;var h=function(n){var c=$(v),G=new gJ(c);G.color=l;G.clickHandler={o:D,f:function(I){var H={name:G.mapseries[G.legidx||0].name},J={point:{category:I.value}};if(H.name.charAt(H.name.length-1)==" "){H.name=H.name.substring(0,H.name.length-1)}D.p1.call(D,H,J)}};G.drawMap.call(G,n,{scale:m.scale,maptype:m.subtype,mapseries:w,mapdp:q})};$.getJSON(g,h)};IG$._I95.prototype.l6=function(){var c=this,a=c.container,e=new google.visualization.GeoChart(a),b={region:"840"},d=new google.visualization.DataTable();d.addColumn("string","State");d.addColumn("number","Data");e.draw(d,b)};IG$._I95.prototype.l3a=function(D){var E=this,x,u,F=D.data,q=D.colfix,b=D.rowfix,n=E._ILb.cco,m=n.tm_l_cl,f=(D.data.length>0?D.data[0].length:0),v=[],o=[],c,a=[],y,s,p,A={},t,B,l=$(E.container),z={ty:0},d,g=0;l.empty();if(IG$.__c_&&IG$.__c_.chartcolors&&IG$.__c_.chartcolors[n.colorset]){d=IG$.__c_.chartcolors[n.colorset]}else{d=Highcharts.getOptions().colors}for(x=0;x<q;x++){o.push({value:null,seq:0,point:null})}for(x=q;x<f;x++){y="";for(u=0;u<b;u++){y=(u==0)?F[u][x].text:y+IG$.sX+F[u][x].text}a.push({name:y,selected:(x-q==E.ti?true:false)})}if(a&&a.length>1){t=$("<div class='mtreemap-caption'></div>");l.append(t);$.each(a,function(h,w){$("<input type='radio' name='category' value='"+h+"'>"+w.name+"&nbsp;&nbsp;&nbsp;&nbsp;</input>").prop("checked",w.selected).appendTo(t).bind("change",function(G){E.ti=h;E.l3a.call(E,E.mresult)})});z.ty=t.height()}for(x=b;x<F.length;x++){c=F[x];for(u=0;u<q;u++){val=c[u].text;if(o[u].value!=val){if(u==0){s={id:"id_"+o[u].seq,name:val,value:0};if(m){s.colorValue=0}else{s.color=d[g%d.length]}o[u].seq++;o[u].point=s;v.push(s);g++}else{p=o[u-1].point;s={id:p.id+"_"+o[u].seq,name:val,parent:p.id,value:0};if(m){s.colorValue=0}o[u].seq++;o[u].point=s;v.push(s)}}o[u].value=val;if(m){o[u].colorValue=val}}if(c.length>E.ti+q){B=c[E.ti+q];p=o[q-1].point;s={id:p.id+"_"+(E.ti+q),name:a[E.ti].name,parent:p.id,value:Number(B.code)};if(m){s.colorValue=Number(B.code)}v.push(s);for(k=0;k<o.length;k++){val=Number(B.code);if(val){o[k].point.value+=val;if(m){o[k].point.colorValue=o[k].point.value}}}}}var e=IG$.x_10._w(l),y=IG$.x_10._h(l),r=new Object();E.drawmode="treemap";z.box=$("<div></div>").appendTo(l);z.box.css({position:"absolute",width:e,height:y-z.ty,top:z.ty,left:0});r.chart={animation:false,renderTo:z.box[0],reflow:false,alignTicks:true,borderWidth:0};r.colors=d;if(n.showtitle==true){var C=n.title||"";r.title={text:C};switch(n.titleposition){case"BOTTOM_LEFT":r.title.align="left";r.title.floating=true;r.chart.marginBottom=50;r.title.y=y-20;break;case"BOTTOM_CENTER":r.title.align="center";r.title.floating=true;r.chart.marginBottom=50;r.title.y=y-20;break;case"BOTTOM_RIGHT":r.title.align="right";r.title.floating=true;r.chart.marginBottom=50;r.title.y=y-20;break;case"TOP_LEFT":r.title.align="left";r.title.verticalAlign="top";break;case"TOP_CENTER":break;case"TOP_RIGHT":r.title.align="right";r.title.verticalAlign="top";break}}else{r.title={text:""}}if(m){r.colorAxis={minColor:"#FFFFFF",maxColor:Highcharts.getOptions().colors[0]}}r.series=[{type:"treemap",layoutAlgorithm:n.tm_l_alg||"squarified",allowDrillToNode:true,dataLabels:{enabled:false},levelIsConstant:false,levels:[{level:1,colorByPoint:false,dataLabels:{enabled:true},borderWidth:2}],drillUpButton:{text:"< "+IRm$.r1("B_BACK"),relativeTo:"plotBox",position:{y:0,x:0}},data:v}];z.map=new Highcharts.Chart(r);E.treemap=z};