(function(b){function c(n){if(typeof n==="number"){return n.toString()}var m={"<":"lt",">":"gt",'"':"quot","'":"apos"};for(var l in m){n=n.replace(new RegExp(l,"g"),"&"+m[l]+";")}return n}function a(r,s){var n=[],p="undefined",o;if(typeof r.unshift!="undefined"){var m=r.length;for(o=0;o<m;o++){if(typeof r[o]!=p){var q=s.call(this,r[o],o);if(q!==null){n.push(q)}}}}else{for(o in r){if(r.hasOwnProperty(o)){var q=s.call(this,r[o],o);if(q!==null){n.push(q)}}}}return n}function f(n,o,l){for(var m in n){if(n.hasOwnProperty(m)){l=o.call(this,l,n[m],m)}}return l}function k(n,m,l,o){if(typeof o==="undefined"||o===null){o=""}if(typeof m==="object"){m=a(m,function(r,q){switch(q){case"transform":return;case"fill":if(r.match(/^hsb/)){var p=r.replace(/^hsb\(|\)$/g,"").split(",");if(p.length===3){r=b.hsb2rgb(p[0],p[1],p[2]).toString()}}}return q+'="'+c(r)+'"'}).join(" ")}return"<"+n+(l?' transform="matrix('+l.toString().replace(/^matrix\(|\)$/g,"")+')" ':" ")+m+">"+o+"</"+n+">"}function h(l){return{font:{family:l.attrs.font.replace(/^.*?"(\w+)".*$/,"$1"),size:typeof l.attrs["font-size"]==="undefined"?null:parseInt(l.attrs["font-size"]),style:typeof l.attrs["font-style"]==="undefined"?null:l.attrs["font-style"],weight:typeof l.attrs["font-weight"]==="undefined"?null:l.attrs["font-weight"]},anchor:typeof l.attrs["text-anchor"]==="undefined"?null:l.attrs["text-anchor"]}}function j(o){var n="normal",l="text-anchor: "+(o.anchor||"middle")+"; ",m=o.font;return l+["font:",(m.style||n),n,(m.weight||n),(m.size?m.size+"px":"10px")+"/normal",m.family].join(" ")}function d(l){if(/^[0-9A-F]{6}$/i.test(l)){l="#"+l}return l}function e(n,m,l){if(n===null){n=10}return n*4.5/13*(m-0.2-l/2)*3.5}var g={text:function(o){var n=h(o),l=new Array,m=o.attrs.text.toString().split("\n"),p=m.length;a(m,function(s,q){var r=f(o.attrs,function(u,v,t){if(t!=="text"&&t!=="w"&&t!=="h"){if(t==="font-size"){v=parseInt(v)+"px"}if(t==="stroke"){v=d(v)}u[t]=c(v.toString())}return u},{style:j(n)+";"});if(o.node.className.baseVal!=""){r["class"]=o.node.className.baseVal}l.push(k("text",r,o.matrix,k("tspan",{dy:e(n.font.size,q+1,p)},null,s.replace(/&/g,"&amp;"))))});return l},path:function(m){var l=(m.matrix.a===1&&m.matrix.d===1)?{}:{transform:m.matrix.toString()};return k("path",f(m.attrs,function(o,p,n){if(n==="path"){n="d"}if(n==="stroke"){p=d(p)}o[n]=p.toString();return o},{}),m.matrix)}};b.fn.toSVG=function(){var o=this,w={svg:b.svg,vml:b.vml},u='<svg style="overflow: hidden; position: relative;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+o.width+'" version="1.1" height="'+o.height+'">';b.svg=true;b.vml=false;for(var q=o.bottom;q!=null;q=q.next){if(q.node.style.display==="none"){continue}var B="";if(typeof g[q.type]==="function"){u+=g[q.type](q);continue}switch(q.type){case"image":B+=' preserveAspectRatio="none"';break}for(i in q.attrs){var l=i;var A="";switch(i){case"r":if(q.type!="rect"){break}A=q.attrs.r;q.attrs.rx=A;q.attrs.ry=A;continue;case"src":l="xlink:href";break;case"transform":l="";break;case"fill":if(q.attrs.gradient){continue}break;case"gradient":var m=q.id;var z=q.attrs.gradient;var s=0.5,p=0.5;z=String(z).replace(b._radial_gradient,function(E,C,F){type="radial";if(C&&F){s=parseFloat(C);p=parseFloat(F);var D=((p>0.5)*2-1);Math.pow(s-0.5,2)+Math.pow(p-0.5,2)>0.25&&(p=Math.sqrt(0.25-Math.pow(s-0.5,2))*D+0.5)&&p!=0.5&&(p=p.toFixed(5)-0.00001*D)}return""});z=z.split(/\s*\-\s*/);if(q.attrs.gradient.match(/^r/g)){var x=b._parseDots(z);if(!x){continue}u+="<defs>";u+='	    <radialGradient id="radialgradient'+m+'" fx="'+s+'" fy="'+p+'" >';for(var v=0;v<x.length;v++){var t=(v/(x.length-1)*100)+"%";if(x[v].offset){t=x[v].offset}u+='<stop stop-color="'+x[v].color+'" offset="'+t+'"/>'}u+="    </radialGradient>";u+="</defs>";l="fill";A="url(#radialgradient"+m+")"}else{var r=z.shift();r=parseFloat(r)*-1;if(isNaN(r)){continue}var x=b._parseDots(z);if(!x){continue}var n=[0,0,Math.cos(b.rad(r)),Math.sin(b.rad(r))],y=1/(Math.max(Math.abs(n[2]),Math.abs(n[3]))||1);n[2]*=y;n[3]*=y;if(n[2]<0){n[0]=-n[2];n[2]=0}if(n[3]<0){n[1]=-n[3];n[3]=0}u+="<defs>";u+='	    <linearGradient id="lineargradient'+m+'" x1="'+n[0]+'" y1="'+n[1]+'" x2="'+n[2]+'" y2="'+n[3]+'">';for(var v=0;v<x.length;v++){var t=(v/(x.length-1)*100)+"%";if(x[v].offset){t=x[v].offset}u+='<stop stop-color="'+x[v].color+'" offset="'+t+'"/>'}u+="    </linearGradient>";u+="</defs>";l="fill";A="url(#lineargradient"+m+")"}break;case"stroke":if(A){A=d(A)}else{A=d(q.attrs[i].toString())}break}if(l){if(A){B+=" "+l+'="'+c(A)+'"'}else{B+=" "+l+'="'+c(q.attrs[i].toString())+'"'}}}if(q.node.className.baseVal!=""){B+=' class="'+q.node.className.baseVal+'"'}u+="<"+q.type+' transform="matrix('+q.matrix.toString().replace(/^matrix\(|\)$/g,"")+')"'+B+"></"+q.type+">"}u+="</svg>";b.svg=w.svg;b.vml=w.vml;return u}})(window.Raphael);