IG$._Ic2=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:false,resizable:false,width:360,autoHeight:true,dbscan:1,callback:null,serverNode:null,_IG0:function(){this.close()},_IFf:function(){var a=this,k=a.down("[name=nosqldb]"),g=a.down("[name=dbgroups]"),c=g.getSelectionModel().selected,m,b=k.getValue(),f,e,d;if(!b){return}for(f=0;f<k.store.data.items.length;f++){e=k.store.data.items[f];if(e.get("poolname")==b){m=e.get("dbtype");break}}if(m){var l={dbtype:m,dbname:b,scan:0,dbnodes:[]};if(c&&c.length){for(f=0;f<c.length;f++){d=c.items[f];l.dbnodes.push({name:d.get("name"),uid:d.get("uid")})}}a.callback&&a.callback.execute(l);a.close()}},in$t:function(){var b=this,a=new IG$._I3e();a.init(b,{ack:"25",payload:IG$._I2d({address:"/",dbtype:"57"},"address;dbtype"),mbody:IG$._I2e({option:"standard"})},b,function(c){var g=this,f=IG$._I18(c,"/smsg/item"),e,m,k,l=[],d=g.down("[name=nosqldb]");l.push({name:"Select Database Instance",poolname:""});if(f){m=IG$._I26(f);for(e=0;e<m.length;e++){k=IG$._I1c(m[e]);if(k.dbtype=="57"){l.push({name:k.disp,poolname:k.name,uid:k.uid||"",dbtype:k.dbtype,isuserdb:(k.isuserdb=="T"?true:false),savepwd:(k.isuserdb=="T"&&k.savepwd=="F"?false:true)})}}d.store.loadData(l);d.setValue(g.dbname||"")}},false);a._l()},l1:function(){var d=this,a=d.down("[name=nosqldb]"),c=new IG$._I3e(),b={address:"/"+a.getValue(),option:"StoredContent"};if(a.getValue()){c.init(d,{ack:"25",payload:IG$._I2d(b,"address;option;pwd"),mbody:IG$._I2e(b)},d,function(e){var k=this,m=IG$._I18(e,"/smsg/item"),n=[],g,l=k.down("[name=dbgroups]"),f;if(m){snodes=IG$._I26(m);for(f=0;f<snodes.length;f++){g=IG$._I1c(snodes[f]);n.push(g)}}l.store.loadData(n)});c._l()}},initComponent:function(){var a=this;a.title=IRm$.r1("T_NOSQLDATA_TITLE");$s.apply(this,{defaults:{bodyStyle:"padding:10px"},layout:"fit",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},border:0,items:[{xtype:"combobox",name:"nosqldb",fieldLabel:"Database",queryMode:"local",displayField:"name",valueField:"poolname",editable:false,autoSelect:true,store:{xtype:"store",fields:["name","poolname","dbtype"]},listeners:{change:function(b){var c=this,d=c.down("[name=dbgroups]");d.store.loadData([]);c.l1()},scope:this}},{xtype:"gridpanel",name:"dbgroups",height:180,store:{fields:["name","uid"]},selType:"checkboxmodel",selModel:{selMode:"MULTI"},columns:[{text:"Name",dataIndex:"name",flex:1}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._IFf()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(c){var b=this;b.in$t()}}});IG$._Ic2.superclass.initComponent.apply(this,arguments)}});IG$._IC9=$s.extend(IG$._I57,{ReportUID:"",scroll:false,initialized:false,closable:true,autoScroll:false,bodyBorder:false,layout:"fit",autoHeight:true,groupmeasures:null,dbscan:100,rx:function(e){var b=this,a=this.columnview.store,d=a.data.items[e],c;a.remove(d)},cx:function(f){var b=this,a=this.columnview.store,e=a.data.items[f],d={};IG$._I1d(e.data,d);var c=new IG$._Ic4({item:d,styles:b.styles});c.callback=new IG$._I3d(b,b.rs_cx,e);c.show()},rs_cx:function(q,l){var k,m=["text","datatype","fieldname","sortorder","sorttype","itemstyle","groupmeasure","removeblank","isdatetype","datefield","dateformat","type","dateitems","datecustom","aggregate"],p;for(k=0;k<m.length;k++){p=m[k];l.set(p,q[p])}var s,n=l.get("sortorder"),c=l.get("sorttype"),e=l.get("removeblank"),b=l.get("isdatetype"),o=l.get("dateformat"),g=l.get("dateitems"),a=l.get("datecustom"),d=l.get("aggregate");s=n||"";s=(s=="asc")?"▲":(s=="desc")?"▼":"";s=(s!=""&&c=="NUMBER")?s+"(Numeric)":s;l.set("sortdesc",s)},setFieldType:function(a){var c=this.down("[name=columnview]"),b;for(b=0;b<c.store.data.items.length;b++){if(c.store.data.items[b].data.checked==true){c.store.data.items[b].set("datatype",a)}}},initComponent:function(){var a=this,b=new $s.menu({items:[{text:"Set as Number Field",handler:function(){this.setFieldType("number")},scope:this},{text:"Set as Text Field",handler:function(){this.setFieldType("string")},scope:this}]});a.styles=[];a.columnobj=[];a.columninfo=[];$s.apply(this,{tbar:[" ",{iconCls:"icon-toolbar-save",tooltip:IRm$.r1("L_SAVE_EXCEL"),handler:function(){this._t$("cmd_save")},scope:this},{iconCls:"icon-toolbar-option",tooltip:"Options",handler:function(){this._t$("cmd_option")},scope:this},{iconCls:"icon-toolbar-style",tooltip:"Style",handler:function(){this._t$("cmd_style")},scope:this}],items:[{xtype:"form",layout:"anchor",bodyPadding:4,defaults:{anchor:"100%"},items:[{xtype:"displayfield",value:"Options and Loaded data list"},{xtype:"panel",border:0,layout:{type:"hbox",padding:5},items:[{xtype:"gridpanel",plain:true,name:"datainfo",flex:1,height:120,split:true,resizable:false,collapsible:false,layout:"fit",collapsed:false,stateful:true,columnLines:true,store:{fields:["name","uid","type","nodepath"]},plugins:[{ptype:"cellediting",clicksToEdit:false}],columns:[{xtype:"gridcolumn",flex:1,text:"Data name",dataIndex:"name",editor:{allowBlank:false}},{xtype:"actioncolumn",width:50,sortable:false,items:[{iconCls:"icon-grid-config",tooltip:IRm$.r1("B_CONFIG_ITEM"),handler:function(d,e,c){a.cxc(e)},scope:a}]}]}]},{xtype:"displayfield",value:"Metric Items"},{xtype:"gridpanel",name:"columnview",region:"center",collapsible:false,stateful:true,columnLines:true,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell"},store:{fields:["name","alias","nodename"],data:[]},split:false,scroll:"vertical",initialized:false,autoHeight:true,flex:1,autoScroll:true,plugins:[{ptype:"cellediting",clicksToEdit:false}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{iconCls:"icon-toolbar-groupmeasure",text:IRm$.r1("L_GROUP_MEASURE"),tooltip:IRm$.r1("L_GROUP_MEASURE"),handler:function(){this._t$("cmd_group_measure")},scope:this},{iconCls:"icon-toolbar-moveup",text:IRm$.r1("B_MOVE_UP"),tooltip:IRm$.r1("B_MOVE_UP"),handler:function(){this._t$("cmd_move_up")},scope:this},{iconCls:"icon-toolbar-movedown",text:IRm$.r1("B_MOVE_DOWN"),tooltip:IRm$.r1("B_MOVE_DOWN"),handler:function(){this._t$("cmd_move_down")},scope:this},]}],columns:[{xtype:"gridcolumn",text:"Colmn name",dataIndex:"text",flex:2,editor:{allowBlank:false}},{xtype:"gridcolumn",text:"Location",dataIndex:"nodepath",flex:2},{xtype:"gridcolumn",text:"GroupInfo",dataIndex:"groupmeasure",flex:2},{xtype:"gridcolumn",width:120,text:"Data type",dataIndex:"datatype",field:{xtype:"combobox",queryMode:"local",displayField:"name",valueField:"value",editable:false,autoSelect:true,triggerAction:"all",selectOnTab:true,store:{xtype:"store",fields:["name","value"],data:[{name:"String",value:"string"},{name:"Numeric",value:"number"}]},lazyRender:true,listClass:"x-combo-list-small"}},{xtype:"gridcolumn",width:120,text:"Aggregation",dataIndex:"aggregate",field:{xtype:"combobox",queryMode:"local",displayField:"name",valueField:"value",editable:false,autoSelect:true,triggerAction:"all",selectOnTab:true,store:{xtype:"store",fields:["name","value"],data:[{name:"Average",value:"avg"},{name:"Sum",value:"sum"},{name:"Minimum",value:"min"},{name:"Maximum",value:"max"}]}}},{xtype:"gridcolumn",width:80,text:"Sort",dataIndex:"sortdesc"},{xtype:"gridcolumn",width:100,text:"Style",dataIndex:"itemstyle"},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-config",tooltip:IRm$.r1("B_CONFIG_ITEM"),handler:function(d,e,c){a.cx(e)},scope:a},{iconCls:"icon-grid-delete",tooltip:IRm$.r1("B_DELETE_ITEM"),handler:function(d,e,c){a.rx(e)},scope:a}]}],viewConfig:{stripeRows:false,trackOver:false},listeners:{selectionchange:function(c,d){},afterrender:function(c){this.initialized=true},beforeitemcontextmenu:function(f,d,l,g,m){m.stopEvent();var c=m.pageX,n=m.pageY,k=m.getTarget();b.showBy(k);return false},itemclick:function(d,c,g,f,l,k){a.s1=c}}}]}]});IG$._IC9.superclass.initComponent.call(this)},_t$:function(b){var a=this;switch(b){case"cmd_save":this.sK4a();break;case"cmd_style":var c=new IG$._I9c({styleinfo:this.styles});IG$._I_5(this,c);break;case"cmd_option":var c=new IG$._Ic2({dbscan:a.dbscan,callback:new IG$._I3d(a,a.rs_changeOption)});IG$._I_5(this,c);break;case"cmd_group_measure":a.u1();break;case"cmd_move_up":a.u2(-1);break;case"cmd_move_down":a.u2(1);break}},rs_changeOption:function(b){var a=this;if(b){this.dbnode=b.dbnode;this.dbtype=b.dbtype;this.dbname=b.dbname;this.dbscan=b.scan;this.loadTableContent()}},loadTableContent:function(){var a=this,b=new IG$._I3e();a.setLoading(true);b.init(a,{ack:"25",payload:IG$._I2d({uid:this.uid,dbtype:a.dbtype,dbname:a.dbname,nodename:a.dbnode,option:"nosqldb"},"uid;dbtype;option;dbname;nodename"),mbody:IG$._I2e({option:"standard"})},a,a.rs_loadTableContent,null);b._l()},rs_loadTableContent:function(a){var b=this,e=b.down("[name=datainfo]"),k=[],g,f,c,d;g=IG$._I18(a,"/smsg");b.setLoading(false);if(g){f=IG$._I26(g);for(c=0;c<f.length;c++){d=IG$._I1b(f[c],"name");k.push({name:d,alias:d,aggregate:"avg"})}}e.store.loadData(k)},u2:function(k){var e=this,b=e.s1,c=e.down("[name=columnview]"),g=c.store,l=g.data.items.length,d,a,f=c.getSelectionModel();if(b){d=g.indexOf(b);a=d+k;if(a>-1&&a<l){g.removeAt(d);g.insert(a,b);f.select(b)}}},u1:function(){var a=this,f=a.header,g=a.columnview,m=g.store,l=g.getSelectionModel(),b,c,d,e;b=l?l.getSelection():null;if(b&&b.length>1){for(e=0;e<b.length;e++){c=b[e].data;if(c.datatype!="numeric"&&c.datatype!="number"){d=c.text+" is not a numeric value.\nSelection allows numeric value only.";break}}}else{d="Check items to group measure. \nNeed 2 or more items selected."}if(d){IG$._I54("Selection Error",d,null,a,null,null,1,"error")}else{var k=new IG$._Ic3({sel:b,callback:new IG$._I3d(a,a.rs_u1,b)});IG$._I_5(this,k)}},rs_u1:function(c,e){var d=this,f=d.groupmeasures,a=null,g,b;if(f){for(b=0;b<f.length;b++){if(f[b].name==c.name){a=f[b];break}}}if(!a){a=c;d.groupmeasures=d.groupmeasures||[];d.groupmeasures.push(c)}for(b=0;b<e.length;b++){g=e[b];g.set("groupmeasure",a.name)}},sK4a:function(){var a=this,e,g,k=[],f=new IG$._I3e(),b;a.setLoading(true,true);k.push("<smsg><info option='updatecolumnuid' baseuid='"+this.uid+"'>");for(e=0;e<this.columnview.store.data.items.length;e++){g=this.columnview.store.data.items[e].data;g.uid=(g.uid||"");g.uid=(g.uid.indexOf("-")>0)?g.uid:"";g.fieldid="column_"+e;b=(IG$._I34(g.datatype)?"Measure":"Metric");if(g.isdatetype==true){b="DateMetric"}k.push("<column name='"+g.text+"' datatype='"+g.datatype+"' fieldname='"+g.fieldname+"' type='"+b+"'"+((g.sortorder)?" sortorder='"+g.sortorder+"'":"")+((g.sorttype)?" sorttype='"+g.sorttype+"'":"")+((g.itemstyle)?" itemstyle='"+g.itemstyle+"'":"")+" removeblank='"+(g.removeblank==true?"T":"F")+"' fieldid='"+g.fieldid+"' groupmeasure='"+(g.groupmeasure||"")+"' isdatetype='"+(g.isdatetype==true?"T":"F")+"' dateitems='"+(g.dateitems||"")+"' datecustom='"+(g.datecustom||"")+"' dateformat='"+(g.dateformat||"")+"' nodename='"+(g.nodename||a.dbnode||"")+"' aggregate='"+(g.aggregate||"")+"' uid='"+g.uid+"'/>")}k.push("<GroupMeasures>");if(this.groupmeasures){for(e=0;e<this.groupmeasures.length;e++){k.push("<GroupMeasure"+IG$._I20(this.groupmeasures[e],"uid;name;nodepath","s")+"/>")}}k.push("</GroupMeasures>");k.push("</info>");k.push("</smsg>");f.init(a,{ack:"31",payload:IG$._I2d({uid:this.uid}),mbody:k.join("")},a,a.rs_sK4a,null);f._l()},rs_sK4a:function(l){var a=this,c=IG$._I18(l,"/smsg"),m=IG$._I26(c),e=this.columnview.store.data.items,k,g,d=0,f,b;a.setLoading(true,true);for(g=0;g<m.length;g++){k=IG$._I29(m[g]);if(k=="column"){e[d].set("uid",IG$._I1b(m[g],"uid"));e[d].set("nodepath",IG$._I1b(m[g],"nodepath"));d++}else{if(k=="measuregroup"){b=IG$._I1c(m[g]);if(this.groupmeasures){for(f=0;f<this.groupmeasures.length;f++){if(this.groupmeasures[f].name==b.name){this.groupmeasures[f].uid=b.uid;this.groupmeasures[f].dim_uid=b.dim_uid;break}}}}}}this.sK4()},sK4:function(){var b=this,m="",o=[],k,g,f=[],n,a,l=[],q,p=new IG$._I3e(),e="%^;",s=this.down("[name=datainfo]");b.setLoading(true,true);o.push("<smsg><item uid='"+this.uid+"'>");o.push("<result cols='"+this.columnview.store.data.items.length+"' resultlimit='0' resulttype='external'");o.push(" dbtype='"+this.dbtype+"' dbname='"+this.dbname+"' tablename='"+this.tablename+"'");o.push(" dbnode='"+this.dbnode+"'");o.push(" dbscan='"+this.dbscan+"'");o.push(">");o.push("<Header>");for(k=0;k<this.columnview.store.data.items.length;k++){n=this.columnview.store.data.items[k].data;n.uid=(n.uid||"");n.uid=(n.uid.indexOf("-")>0)?n.uid:"";n.fieldid="column_"+k;o.push("<column name='"+n.text+"' type='"+n.datatype+"' fieldname='"+n.fieldname+"' fieldid='"+n.fieldid+"'"+((n.sortorder)?" sortorder='"+n.sortorder+"'":"")+((n.sorttype)?" sorttype='"+n.sorttype+"'":"")+((n.itemstyle)?" itemstyle='"+n.itemstyle+"'":"")+" removeblank='"+(n.removeblank==true?"T":"F")+"' isdatetype='"+(n.isdatetype==true?"T":"F")+"' dateitems='"+(n.dateitems||"")+"' datecustom='"+(n.datecustom||"")+"' dateformat='"+(n.dateformat||"")+"' groupmeasure='"+(n.groupmeasure||"")+"' aggregate='"+(n.aggregate||"")+"' dbnode='"+(n.nodename||this.dbnode||"")+"' uid='"+n.uid+"'/>");f.push(n.dataIndex);l.push({index:k,name:n.text,uid:n.uid,tuple:{}})}o.push("</Header>");o.push("<DataObjects>");for(k=0;k<s.store.data.items.length;k++){o.push("<data uid='"+s.store.data.items[k].get("uid")+"' name='"+s.store.data.items[k].get("name")+"'/>")}o.push("</DataObjects>");if(this.tabdimension&&this.down("[name=cbtabdim]").getValue()==true){o.push("<TabDimension"+IG$._I20(this.tabdimension,"uid;name","s")+"/>")}if(this.groupmeasures&&this.groupmeasures.length>0){o.push("<GroupMeasures>");for(k=0;k<this.groupmeasures.length;k++){o.push("<GroupMeasure"+IG$._I20(this.groupmeasures[k],"uid;name;nodepath","s")+"/>")}o.push("</GroupMeasures>")}o.push("<Styles>");for(k=0;k<this.styles.length;k++){o.push(this.styles[k].tx())}o.push("</Styles>");o.push("</result></item></smsg>");m=o.join("");p.init(b,{ack:"31",payload:IG$._I2d({uid:this.uid}),mbody:m},b,b.rs_sK4,null);p._l()},rs_sK4:function(a){var b=this;b.setLoading(false);IG$._I54(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},sk4:function(){var c=this,b=this.down("[name=txttabdim]").getValue();if(b==""){return}var f=new IG$._I3e(),d="31",a=IG$._I2d({address:this.nodepath+"/"+b,name:b,type:"TabDimension",pid:this.uid,description:""},"address;name;type;pid;description;memo"),e=IG$._I2e();f.init(c,{ack:d,payload:a,mbody:e},c,c.rs_sk4,null);f._l()},rs_sk4:function(a){var b=IG$._I18(a,"/smsg/item");if(b){this.tabdimension=IG$._I1c(b)}},entryLogin:function(b){if(demos.Login.success==true){var a=this;a.sK5(a)}else{history.back(-1)}},sK5:function(){var a=this,c=this.down("[name=datainfo]");a.setLoading(true,true);this.header=[];this.headermap={};this.dataset=[];c.store.loadData([]);var b=new IG$._I3e();b.init(a,{ack:"5",payload:IG$._I2d({uid:a.uid}),mbody:IG$._I2e({option:"content"},"option")},a,a.rs_sK5,null);b._l()},rs_sK5:function(a){var c,b=this,d=IG$._I18(a,"/smsg/item"),e=IG$._I18(a,"/smsg/item/Result");if(d!=null){this.nodepath=IG$._I1b(d,"nodepath")}if(e!=null){this.delimiter=IG$._I1b(e,"delimiter");this.dbnode=IG$._I1b(e,"dbnode");this.dbscan=parseInt(IG$._I1b(e,"dbscan")||"100");this.parseResultData(e);this.drawDataView()}},drawDataView:function(){var a=this,f=this.columnobj,e=this.columninfo,b,c,g,l,k=this.columnview.store,d;for(d=0;d<this.header.length;d++){b={xtype:"gridcolumn",text:this.header[d].code,dataIndex:d,editor:{allowBlank:false}};l=this.header[d].sortorder||"";l=(l=="asc")?"▲":(l=="desc")?"▼":"";l=(l!=""&&this.header[d].sorttype=="NUMBER")?l+"("+this.header[d].sorttype+")":l;e.push({text:this.header[d].code,uid:this.header[d].uid||null,datatype:this.header[d].datatype||"string",fieldname:this.header[d].fieldname||this.header[d].code,sortorder:this.header[d].sortorder,sorttype:this.header[d].sorttype,itemstyle:this.header[d].itemstyle||"",sortdesc:l,nodepath:this.header[d].nodepath||"",groupmeasure:this.header[d].groupmeasure||"",removeblank:this.header[d].removeblank,isdatetype:this.header[d].isdatetype||false,dateformat:this.header[d].dateformat||"",dateitems:this.header[d].dateitems||null,datecustom:this.header[d].datecustom||null,nodename:this.header[d].nodename||null,aggregate:this.header[d].aggregate||null,dataIndex:d});f.push(b)}k.loadData(e)},cxc:function(f){var b=this,a=this.down("[name=datainfo]").store,e=a.data.items[f],c=e.get("name");this.tablename=c;var b=this,d=new IG$._I3e();b.setLoading(true,true);d.init(b,{ack:"25",payload:IG$._I2d({uid:this.uid,dbtype:b.dbtype,nodename:b.dbnode,dbname:b.dbname,tablename:b.tablename,option:"nosqldb",dbscan:(b.dbscan||1)},"uid;dbtype;option;dbname;tablename;dbscan;nodename"),mbody:IG$._I2e({option:"standard"})},b,b.rs_cxc,null);d._l()},rs_cxc:function(k){var a=this,c={},m,f,g,e,b,l;b=IG$._I18(k,"/smsg");if(b){l=IG$._I26(b);for(f=0;f<l.length;f++){g=IG$._I1b(l[f],"name");e=IG$._I1b(l[f],"type");c[g]=1;if(!this.headermap[g]){m={uid:null,code:g,datatype:e,fieldname:g};this.headermap[g]=m;this.header.push(m)}}for(f=this.header.length-1;f>=0;f--){g=this.header[f].fieldname;if(!c[g]){this.header.splice(f,1);delete this.headermap[g]}}this.columninfo=[];this.drawDataView()}},parseResultData:function(b){var c=IG$._I18(b,"Header");this.cols=parseInt(IG$._I1b(b,"cols"));this.dbtype=IG$._I1b(b,"dbtype");this.dbname=IG$._I1b(b,"dbname");this.tablename=IG$._I1b(b,"tablename");if(this.dbtype&&this.dbname){this.loadTableContent()}var a=IG$._I26(c);var e,d,n,f;for(e=0;e<a.length;e++){n={};n.uid=IG$._I1b(a[e],"uid")||null;n.code=IG$._I1b(a[e],"name");n.datatype=IG$._I1b(a[e],"type")||"string";n.fieldname=IG$._I1b(a[e],"fieldname")||n.code;n.sortorder=IG$._I1b(a[e],"sortorder");n.sorttype=IG$._I1b(a[e],"sorttype");n.itemstyle=IG$._I1b(a[e],"itemstyle");n.groupmeasure=IG$._I1b(a[e],"groupmeasure")||"";n.removeblank=(IG$._I1b(a[e],"removeblank")=="T"?true:false);n.isdatetype=(IG$._I1b(a[e],"isdatetype")=="T"?true:false);n.dateformat=IG$._I1b(a[e],"dateformat");n.dateitems=IG$._I1b(a[e],"dateitems");n.datecustom=IG$._I1b(a[e],"datecustom");n.aggregate=IG$._I1b(a[e],"aggregate")||"avg";this.header.push(n);this.headermap[n.fieldname]=n}var l=IG$._I18(b,"Styles"),k;if(l){a=IG$._I26(l);for(e=0;e<a.length;e++){k=new IG$._IF7(a[e],"appstyle",true);this.styles.push(k)}}var g=IG$._I18(b,"DataObjects"),m;if(g){m=IG$._I26(g);for(e=0;e<m.length;e++){this.dataset.push(IG$._I1c(m[e]))}}g=IG$._I18(b,"TabDimension");if(g){this.tabdimension=IG$._I1c(g);if(this.tabdimension.uid&&this.tabdimension.name){this.down("[name=cbtabdim]").setValue(true);this.down("[name=txttabdim]").setValue(this.tabdimension.name)}}g=IG$._I18(b,"GroupMeasures");if(g){this.groupmeasures=[];m=IG$._I26(g);for(e=0;e<m.length;e++){this.groupmeasures.push(IG$._I1c(m[e]))}}},l99:function(){var a=this.down("[name=columnview]"),c=$(a.el.dom).offset(),b=$(this.body.dom).offset();h=100;h=$(this.body.dom).height()-c.top+b.top-5;a.setHeight(h)},listeners:{afterrender:function(c){var a=c,b=a.down("[name=columnview]");a.l99.call(a);a.columnview=b;if(a.initialized==false){a.sK5();a.initialized=true}},deactivate:function(b){var a=b;a.disposeContent(a)},resize:function(){this.l99()}},disposeContent:function(a){}});IG$._Id9=$s.extend($s.window,{title:"Security Filter Management",modal:true,layout:"fit",closable:false,resizable:false,width:300,autoHeight:true,bodyPadding:10,bodyStyle:{background:"#ffffff"},callback:null,sel:null,_IG0:function(){this.close()},mm1:function(){if(this.callback){var c,b=this.down("[name=gridduty]"),a,d={};for(c=0;c<b.store.data.items.length;c++){a=b.store.data.items[c].get("index");d[a]=true}for(c=panel.securityfilter.length-1;c>=0;c--){a=panel.securityfilter[c].index;if(!d[a]){panel.securityfilter.splice(c,1)}}this.callback.execute()}this.close()},mm2:function(){var a=this,d=[],b=this.down("[name=gridduty]"),c;if(a.securityfilter){for(c=0;c<a.securityfilter.length;c++){a.securityfilter[c].index=c;d.push({authname:a.securityfilter[c].authname,active:a.securityfilter[c].active,index:c})}}b.store.loadData(d)},CM1:function(d,c){var a=this,f=a.down("[name=gridduty]"),g;if(c=="remove"){g=f.store.indexOf(d);this.securityfilter.splice(g,1);f.store.remove(d)}else{var e,m,l=d.get("index"),k;for(e=0;e<this.securityfilter.length;e++){if(this.securityfilter[e].index==l){k=this.securityfilter[e];m=e;break}}var b=new IG$._Ia1({_ILb:{filter:k},_ILa:{cubeuid:this.uid},callback:new IG$._I3d(this,function(n){this.securityfilter[m]=n.filter})});IG$._I_5(this,b)}},initComponent:function(){var a=this;var b=[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},border:0,items:[{xtype:"displayfield",value:"Select user duty from list"},{xtype:"gridpanel",name:"gridduty",height:150,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},multiSelect:true,store:{fields:["authname","active","index"]},columns:[{header:"Auth Name",dataIndex:"authname",flex:1,sortable:false,hideable:false},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-add",tooltip:"Edit",handler:function(e,g,d){var f=e.store.getAt(g);a.CM1.call(a,f,"edit")}},{iconCls:"icon-grid-delete",tooltip:"Remove Filtering",handler:function(e,g,d){var f=e.store.getAt(g);a.CM1.call(a,f,"remove")}}]}]}]}];var c=[{text:IRm$.r1("B_CONFIRM"),handler:function(){this.mm1()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}];$s.apply(this,{items:b,buttons:c});IG$._Id9.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(a){this.mm2()}}});IG$._If2=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:false,resizable:false,width:450,autoHeight:true,_s1:null,callback:null,_IG0:function(){this.callback&&this.callback.execute(this);this.close()},_IFf:function(){var f=this,c,e,k=f.down("[name=grdschema]"),d=k.store,b=k.getSelectionModel(),a=b?b.getSelection():null,g;f._s1=[];if(a&&a.length>0){for(c=0;c<a.length;c++){g=a[c];f._s1.push({name:g.get("name"),uid:g.get("uid")})}}if(f._s1.length==0){return false}f._IG0()},i1:function(){var a=this,b=new IG$._I3e();a.setLoading(true);b.init(a,{ack:"25",payload:IG$._I2d({address:"/"},"address"),mbody:"<smsg></smsg>"},a,a.rs_i1,null);b._l()},rs_i1:function(a){var f=this,l,c,k,g,b,e;g=IG$._I18(a,"/smsg/item");f.setLoading(false);if(g){k=IG$._I26(g);b="<smsg>";for(c=0;c<k.length;c++){l=IG$._I1c(k[c]);b+="<item address='/"+l.name+"' option='StoredContent'/>"}b+="</smsg>";f.setLoading(true);e=new IG$._I3e();e.init(f,{ack:"25",payload:b,mbody:"<smsg></smsg>"},f,f.rs_i1a,null);e._l()}},rs_i1a:function(f){var m=this,a=IG$._I18(f,"/smsg"),k,c=[],e,l,g=m.down("[name=grdschema]"),b=g.store;m.setLoading(false);if(a){k=IG$._I26(a);for(e=0;e<k.length;e++){l=IG$._I1c(k[e]);l.dispname=l.name;l.dispname=IG$._I08(l.dispname);c.push(l)}b.loadData(c)}},initComponent:function(){this.title=IRm$.r1("T_SELECT_POOL");$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"panel",layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"displayfield",value:"* Select database connection pool to use in this model"},{xtype:"gridpanel",name:"grdschema",height:300,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell"},store:{xtype:"store",fields:["name","uid","memo","dispname"]},columns:[{header:"Name",name:"name",dataIndex:"dispname",sortable:false,flex:1}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._IFf()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(c,a){var b=this;setTimeout(function(){b.i1.call(b)},10)}}});IG$._If2.superclass.initComponent.apply(this,arguments)}});IG$.mm$99=function(k){var m=this,q,g,e,d,f,c=(k?IG$._I18(k,"/smsg/item"):null),l,p,b,o;m.pools=[];m.pooluids=[];m.zoom=1;m.groupview=false;m.tables=[];m.relations=[];m.cAM=false;if(c){m.item=IG$._I1c(c);l=IG$._I18(c,"objinfo");if(l){m.pools=IG$._I1b(l,"pool").split(";");m.pooluids=IG$._I1b(l,"pooluid").split(";");q=IG$._I1b(l,"zoomfactor");if(q){m.zoom=Number(q)}q=IG$._I1b(l,"groupview");m.groupview=(q=="T")?true:false;q=IG$._I1b(l,"fixjoin");m.cAM=(q=="T")?true:false}l=IG$._I18(c,"Tables");if(l){d=IG$._I26(l);for(g=0;g<d.length;g++){p=new IG$.mm$98(d[g]);p.cAM=m.cAM;p.fields=[];f=IG$._I26(d[g]);for(e=0;e<f.length;e++){o=IG$._I1c(f[e]);o.selected=(o.selected=="T")?true:false;o.seq=p.seq;o.iskey=(o.iskey=="T")?true:false;p.fields.push(o)}m.tables.push(p)}}l=IG$._I18(c,"Relation");if(l){var n,a;d=IG$._I26(l);for(g=0;g<d.length;g++){q=d[g];b=IG$._I1c(q);b.p1dist=b.p1dist?parseInt(b.p1dist):null;n=IG$._I18(q,"source");a=IG$._I18(q,"target");b.source=IG$._I1c(n);b.source.seq=(b.source.seq?parseInt(b.source.seq):0)||0;b.source.formula=IG$._I1a(n,"formula");b.target=IG$._I1c(a);b.target.seq=(b.target.seq?parseInt(b.target.seq):0)||0;b.target.formula=IG$._I1a(a,"formula");m.relations.push(b)}}}};IG$.mm$98=function(a){var b=this,c;b.ranged=false;if(a!=null){c=IG$._I1c(a);c.cpM=c.cpM=="T";c.vr=c.vr=="T";IG$._I1d(c,b,null)}if(b.seq){b.seq=parseInt(b.seq)}else{b.seq=0}};IG$.mm$98.prototype={s1:function(){var c=this,b=0,d=c.bbox,a;if(c.box){c.bbox={left:c.box.pobj.o5.offset().left,top:c.box.pobj.o5.offset().top};d=c.bbox;a=$(c.box.o3.body.dom);b=a.offset().left-d.left}return b},s2:function(g){var k=this,b=0,o=k.bbox,e,l,f,n;if(k.box){k.bbox={left:k.box.pobj.o5.offset().left,top:k.box.pobj.o5.offset().top};o=k.bbox;l=$(k.box.o3.body.dom);f=k.box.o3.down("[name=skey]");n=f&&f.body?$(f.body.dom):null;b=l.offset().top-o.top+(n?n.height()||0:0);if(g!=null){var a=k.box.o3,c=null,d;d=a.l2.call(a,g);b+=d.d;k.ranged=d.ranged}}return b},s3:function(){var b=this,a=0;if(b.box){a=b.box.o3.getWidth()}return a},s4:function(){var b=this,a=0;if(b.box){a=(b.box.cpM==true)?b.box.theight:b.box.o3.getHeight()}return a}};IG$.mm$99.prototype={l1:function(){var c,b,e=this,g,a,d="<smsg>";d+="<item"+IG$._I20(e.item,"uid;name;type","s")+">";d+="<objinfo"+IG$._I20({pool:e.pools.join(";"),pooluid:e.pooluids.join(";"),zoomfactor:e.zoomfactor},"pool;pooluid;zoomfactor","s")+IG$._I20({groupview:e.groupview,fixjoin:e.cAM},"groupview;fixjoin","b")+"/>";d+="<Tables>";for(c=0;c<e.tables.length;c++){a=e.tables[c];a.vr=true;d+="<Table"+IG$._I20(a,"uid;name;memo;type;schemaname;nodepath","s")+IG$._I20(a,"x;y;width;height;seq;theight","i")+IG$._I20(a,"cpM;vr","b")+">";for(b=0;b<a.fields.length;b++){g=a.fields[b];g.tableuid=g.tableuid||a.uid;if(g.iskey||g.hasjoin){d+="<Field"+IG$._I20(g,"uid;alias;name;nodepath;datatype;tablename;type;tableuid","s")+IG$._I20(g,"datasize;iskey","i")+IG$._I20(g,"selected","b")+"/>"}}d+="</Table>"}d+="</Tables>";d+="<Relation>";for(c=0;c<e.relations.length;c++){d+="<Link"+IG$._I20(e.relations[c],"join;operator","s")+IG$._I20(e.relations[c],"p1dist","i")+">";d+="<source"+IG$._I20(e.relations[c].source,"uid;nodepath;datatype;name;tablename;type;tableuid","s")+" seq='"+(e.relations[c].source.seq||0)+"'>";d+="<formula><![CDATA["+(e.relations[c].source.formula||"")+"]]></formula>";d+="</source>";d+="<target"+IG$._I20(e.relations[c].target,"uid;nodepath;datatype;name;tablename;type;tableuid","s")+" seq='"+(e.relations[c].target.seq||0)+"'>";d+="<formula><![CDATA["+(e.relations[c].target.formula||"")+"]]></formula>";d+="</target>";d+="</Link>"}d+="</Relation>";d+="<AuthFilter>";d+="</AuthFilter>";d+="</item>";d+="</smsg>";return d}};IG$.m92=function(c,a){var b=this;b.sobj=a;b.viewer=c;b.dialog=[];b.links=[];b.Z1=1;b.lm="2"};IG$.m92.prototype={init:function(){var a=this;a.mpt=null;a.o6=$("<div></div>").css({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:"#ffffff",overflow:"auto"}).appendTo(a.viewer);a.paint=$("<div></div>");a.paint.appendTo(a.o6);a.o5=$("<div></div>").css({position:"absolute",top:0,bottom:0,width:IG$.x_10._w(a.o6),height:IG$.x_10._h(a.o6),backgroundColor:"none"}).appendTo(a.o6);a.sb();a.o6.droppable({drop:function(b,c){}});a.l1(a.o5[0]);a.o6.bind("resize",function(b){a.s5.call(a)})},z1:function(b){var a=this;a.Z1+=b;$(a.viewer).animate({zoom:a.Z1},400)},l1:function(b){var a=this,c=this;c.dropZone=$s.create($s.dropzone,b,{ddGroup:"CubeModelDDGroup",nodeouttimer:-1,getTargetFromEvent:function(k){var f=k.browserEvent.pageX||k.browserEvent.clientX,d=k.browserEvent.pageY||k.browserEvent.clientY,g=a.getRendererByPoint(f,d);if(g==null){g=b}return g},notifyOut:function(d,k,g){var f=this;if(f.lastOverNode){f.onNodeOut(f.lastOverNode,d,k,g);f.lastOverNode=null}a.isDragging=false;if(!a.hideDropFeedback){return}a.hideDropFeedback.call(a,k);if(f.accept==true&&f.pivotmove==true){if(a.sheetobj){if(f.nodeouttimer>-1){clearTimeout(f.nodeouttimer)}f.nodeouttimer=setTimeout(function(){a.hideDropFeedback.call(a,k)},100)}}},onNodeEnter:function(n,q,o,l){a.isDragging=true;var p=this,m,f,k,d=false,g=false;if(l.records&&l.records.length>0){f=l.records[0].get("type");if(f=="Table"||f=="InlineView"){g=true}}else{if(l.cellData){f=l.cellData;g=true}}p.accept=g},onNodeOut:function(k,d,g,f){},onNodeOver:function(n,d,m,l){var k=this,g,f;if(window.Ext){f=((k.accept==true)?Ext.dd.DropZone.prototype.dropAllowed:Ext.dd.DropZone.prototype.dropNotAllowed)}else{f=k.accept}if(k.accept==true){if(l.records&&l.records.length>0){g=l.records[0].data}else{g=l.cellData}}return f},onNodeDrop:function(l,d,k,g){var f=this;if(f.accept==true){if(g.records&&g.records.length>0){dt=g.records[0].data;a.sobj.d3.call(a.sobj,k,dt)}else{dt=g.cellData}}f.accept=false;return true}})},_f1:function(c){var f=this,b=f.o6,e=c.box.o3,k=f.viewer,a,d,g;if(e){d=b.offset();if(e.$ex){if(f._psel&&f._psel.box){$(f._psel.box.o3.$ex.$view).removeClass("igc-f-table")}g=$(e.$ex.$view);a=g.offset();g.addClass("igc-f-table");b.animate({scrollTop:Math.max(a.top-d.top+b.scrollTop()-(k.height()-g.height())/2,0),scrollLeft:Math.max(a.left-d.left+b.scrollLeft()-(k.width()-g.width())/2,0)},200)}else{if(e.el&&e.el.dom){if(f._psel&&f._psel.box){$(f._psel.box.o3.el.dom).removeClass("igc-f-table")}g=$(e.el.dom);a=g.offset();g.addClass("igc-f-table");b.animate({scrollTop:Math.max(a.top-d.top+b.scrollTop()-(k.height()-g.height())/2,0),scrollLeft:Math.max(a.left-d.left+b.scrollLeft()-(k.width()-g.width())/2,0)},200)}}f._psel=c}},getRendererByPoint:function(){return null},sb:function(){var a=this,b=this;a.o7=$("<div></div>").css({position:"absolute",top:0,bottom:0,width:IG$.x_10._w(a.o6),height:IG$.x_10._h(a.o6),backgroundColor:"none"}).appendTo(a.o5);a.rcanvas=Raphael(a.o7[0],0,0,"100%","100%");a._ca=[]},sc:function(b,p){var n=this;switch(b){case"down":n.mpt={x:p.pageX,y:p.pageY};break;case"up":n.mpt=null;break;case"move":var l=IG$.x_10._w(o6),o=IG$.x_10._w(o5),f=IG$.x_10._h(o6),k=IG$.x_10._h(o5);if(n.mpt!=null&&(l<o||f<k)){var e=n.paint,g=n.o5,u=n.o7,c=n.o6.offset(),d=g.offset(),t=p.pageX-n.mpt.x,s=p.pageY-n.mpt.y,q;q={top:d.top+s,left:d.left+t};n.mpt={x:p.pageX,y:p.pageY};if(q.top<f-k||q.left<l-o||q.top-c.top>0||q.left-c.left>0){return}u.offset(q);g.offset(q);e.offset(q)}break}},clearAll:function(){var a=this;a.dialog=[];a.links=[];a.rcanvas.clear();$.each(a._ca,function(b,d){d.remove()});a._ca=[];a.o5.empty();a.sb()},s5t:-1,s5:function(){var a=this;if(a.s5t){clearTimeout(a.s5t)}a.s5t=setTimeout(function(){a.s5m.call(a)},100)},s5m:function(){var e=this,d=e.o6.offset(),a=IG$.x_10._w(e.o6),c=IG$.x_10._h(e.o6),b;for(b=0;b<e.dialog.length;b++){a=Math.max(a,e.dialog[b].table.s1()+e.dialog[b].table.s3()+100);c=Math.max(c,e.dialog[b].table.s2()+e.dialog[b].table.s4()+100)}IG$.x_10._w(e.o5,a);IG$.x_10._h(e.o5,c);IG$.x_10._w(e.o7,a);IG$.x_10._h(e.o7,c);IG$.x_10._w(e.paint,a);IG$.x_10._h(e.paint,c);e.rcanvas.setSize(a,c);e.s6()},s6:function(){var b=this,a;b.rcanvas.clear();$.each(b._ca,function(d,e){e.remove()});b._ca=[];for(a=0;a<b.links.length;a++){b.links[a].refresh.call(b.links[a],a,b.sobj.c1.groupview==true)}},s7:function(e,l,g,d,f,c){var k=this,a=new IG$.m93(k,e,l,g,d,f);a.main=c;a.cp.call(a,f.cpM);a.o3.cAM.call(a.o3,f.cAM);k.dialog.push(a);return a},s8:function(m,d,k,e){var g=this,f,a,c;g.relations=e;for(f=0;f<g.links.length;f++){c=g.links[f];if(!c){continue}if((c.o10.uid==m.uid&&c.o11.uid==d.uid&&c.o10.seq==m.seq&&c.o11.seq==d.seq)||(c.o10.uid==d.uid&&c.o11.uid==m.uid&&c.o10.seq==d.seq&&c.o11.seq==m.seq)){a=c;break}}if(a){a.links.push(k)}else{a=new IG$.m94(g,m,d,k,e);g.links.push(a)}return a},s9:function(b){var k=this,e=k.sobj,d=e.c1,f,c,g=k.dialog,l=k.links,a;for(f=0;f<d.tables.length;f++){if(b.table==d.tables[f]){d.tables.splice(f,1);break}}for(f=0;f<g.length;f++){if(g[f]==b){g.splice(f,1);break}}for(f=l.length-1;f>=0;f--){if(l[f].o10==b.table||l[f].o11==b.table){a=l[f];for(c=d.relations.length-1;c>=0;c--){if(d.relations[c].bl==a){d.relations.splice(c,1)}}l.splice(f,1)}}e.l5a.call(e);e.d1.call(e);e.d2.call(e)}};IG$.m93=function(e,k,g,d,m,n){var l=this,f=this,c=e,a,b=n.name;f.pobj=e;f.table=n;n.theight=n.theight||m;if(n.seq&&n.seq>0){b+="("+n.seq+")"}f.table.cpM=f.table.cpM||false;f.o3=new $s.panel({renderTo:this.pobj.o5[0],table:n,autoScroll:false,stateful:false,resizable:true,draggable:true,floating:true,baseCls:$s.baseCSSPrefix+"window",plain:false,minimizable:false,alwaysFramed:true,closable:true,cpa:c,title:b,x:k,border:1,y:g,width:d,height:n.theight,viewmode:"physical",cam:false,cAM:function(o){var p=this;p.cam=o;p.g_key.setVisible(o);p.l1()},layout:{type:"vbox",align:"stretch"},l1:function(){var q=this,p=[],s=[],o;if(q.table.fields){for(o=0;o<q.table.fields.length;o++){if(q.cam&&(q.table.fields[o].iskey==true||q.table.fields[o].hasjoin==true)){s.push(q.table.fields[o])}else{p.push(q.table.fields[o])}}}q.g_key.store.loadData(s);q.g_fields.store.loadData(p);q.l3()},l2:function(v){var x=this,o={d:0,ranged:false},t,q,y=false,p,u=false,s,w;if(x.cam){p=x.g_key;w=p.getHeight();for(t=0;t<p.store.data.items.length;t++){if(p.store.data.items[t].get("name")==v){q=p.getView().getNode(t);break}}if(q){u=true;s=$(q).offset().top-$(p.el.dom).offset().top+$(q).height()/2;if(s>-1&&s<w){y=true}else{s=(s<0)?0:s;s=Math.min(s,w)}}}if(u==false){p=x.g_fields;w=p.getHeight();for(t=0;t<p.store.data.items.length;t++){if(p.store.data.items[t].get("name")==v){q=p.getView().getNode(t);break}}if(q){s=$(q).offset().top-$(p.el.dom).offset().top+$(q).height()/2;if(s>-1&&s<w){y=true}else{s=(s<0)?0:s;s=Math.min(s,w)}}}if(s){o.d=s}o.ranged=y;return o},l3:function(){var s=this,t,q=22,p,o=s.getHeight();if(s.cam){t=s.g_key.store.data.items.length;if(t==0){s.g_key.setVisible(false)}else{s.g_key.setVisible(true);p=Math.min(q*t+2,o*0.4);s.g_key.setHeight(p)}s.cpa.s6.call(s.cpa)}},_s1:function(){var o=this;o.__s&&clearTimeout(o.__s);o.__s=setTimeout(function(){o._s1a.call(o)},40)},_s1a:function(){var q=this,s=q.down("[name=g_fields]"),p=s.store,o=q.down("[name=skey]").getValue();if(o){o=o.toLowerCase();p.clearFilter(true);p.filterBy(function(t){var w=true,v=t.get("name").toLowerCase(),u=t.get("alias")||"";u=u.toLowerCase();w=v.indexOf(o)>-1||u.indexOf(o)>-1;return w})}else{p.clearFilter(false)}},items:[{xtype:"textfield",name:"skey",emptyText:"Search Items",enableKeyEvents:true,listeners:{keyup:function(o,q,p){o.ownerCt._s1.call(o.ownerCt)}}},{xtype:"gridpanel",name:"g_key",border:0,scroll:"vertical",autoScroll:true,enableDragDrop:true,enableDD:true,useArrows:true,header:false,hideHeaders:true,hidden:true,cpa:c,ddGroup:"CubeModelFieldDDGroup",viewConfig:{emptyText:IRm$.r1("L_P_RELOAD"),plugins:{ptype:"gridviewdragdrop",ddGroup:"CubeModelFieldDDGroup"},listeners:{beforedrop:function(q,t,u,o){var s=t.records[0],p=u;if(s&&p){c.sobj.d4.call(c.sobj,s,p)}return false},drop:function(q,s,t,o){var p=t?" "+o+" "+t.get("name"):" on empty view"}}},store:{fields:["name","nodepath","datasize","datatype","tablename","type","selected","seq","alias","tableuid"]},afterScroll:function(){this.cpa.s6.call(this.cpa)},columns:[{xtype:"checkcolumn",dataIndex:"selected",enableColumnHide:false,checkedAll:false,width:30,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"},listeners:{checkchange:function(p,w,x,u){var v=this,o=l.o3.g_fields,t=o.store.data.items[w],q=t.get("nodepath"),y=l.table,s;for(s=0;s<y.fields.length;s++){if(y.fields[s].nodepath==q){y.fields[s].selected=x;break}}},headerclick:function(u,v,x,s,q){var p,o=u.ownerCt,w=l.table;if(v.xtype=="checkcolumn"){v.checkedAll=!v.checkedAll;for(p=0;p<o.store.data.items.length;p++){o.store.data.items[p].set("selected",v.checkedAll)}for(p=0;p<w.fields.length;p++){w.fields[p].selected=v.checkedAll}}}}},{header:"Name",dataIndex:"name",sortable:true,hideable:false,flex:1},{header:"Alias",dataIndex:"alias",sortable:true,hideable:false,hidden:true,flex:1}],listeners:{afterrender:function(p){var o=this.getView();o.on("bodyscroll",this.afterScroll,this)},scrollershow:function(o,p,q){}}},{xtype:"gridpanel",name:"g_fields",border:0,scroll:"vertical",autoScroll:true,enableDragDrop:true,enableDD:true,useArrows:true,header:false,hideHeaders:true,flex:1,cpa:c,ddGroup:"CubeModelFieldDDGroup",viewConfig:{emptyText:IRm$.r1("L_P_RELOAD"),plugins:{ptype:"gridviewdragdrop",ddGroup:"CubeModelFieldDDGroup"},listeners:{beforedrop:function(q,t,u,o){var s=t.records[0],p=u;if(s&&p){c.sobj.d4.call(c.sobj,s,p)}return false},drop:function(q,s,t,o){var p=t?" "+o+" "+t.get("name"):" on empty view"}}},store:{fields:["name","nodepath","datasize","datatype","tablename","type","selected","seq","alias","tableuid"]},afterScroll:function(){this.cpa.s6.call(this.cpa)},columns:[{xtype:"checkcolumn",dataIndex:"selected",enableColumnHide:false,checkedAll:false,width:30,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"},listeners:{checkchange:function(p,w,x,u){var v=this,o=l.o3.g_fields,t=o.store.data.items[w],q=t.get("nodepath"),y=l.table,s;for(s=0;s<y.fields.length;s++){if(y.fields[s].nodepath==q){y.fields[s].selected=x;break}}},headerclick:function(u,v,x,s,q){var p,o=u.ownerCt,w=l.table;if(v.xtype=="checkcolumn"){v.checkedAll=!v.checkedAll;for(p=0;p<o.store.data.items.length;p++){o.store.data.items[p].set("selected",v.checkedAll)}for(p=0;p<w.fields.length;p++){w.fields[p].selected=v.checkedAll}}}}},{header:"Name",dataIndex:"name",sortable:true,hideable:false,flex:1},{header:"Alias",dataIndex:"alias",sortable:true,hideable:false,hidden:true,flex:1}],listeners:{afterrender:function(p){var o=this.getView();o.on("bodyscroll",this.afterScroll,this)},scrollershow:function(o,p,q){}}}],bbar:[{xtype:"button",iconCls:"icon-tb-alias",tooltip:"Alias",handler:function(){var s=this.o3,q=this.o3.g_key,o=this.o3.g_fields,t=o.columns,p=q.columns;if(s.viewmode=="physical"){s.viewmode="logical"}else{if(s.viewmode=="logical"){s.viewmode="both"}else{s.viewmode="physical"}}switch(s.viewmode){case"physical":t[1].show();t[2].hide();p[1].show();p[2].hide();break;case"logical":t[1].hide();t[2].show();p[1].hide();p[2].show();break;default:t[1].show();t[2].show();p[1].show();p[2].show();break}},scope:l},{xtype:"button",iconCls:"icon-tb-refresh",tooltip:"Refresh",handler:function(){var p=this,o=p.o3.g_fields;p.main.l5.call(p.main,p.table)},scope:l},{xtype:"button",iconCls:"icon-tb-preview",tooltip:"Preview",handler:function(){this.main.l5m.call(this.main,this.table)},scope:l},{xtype:"displayfield",value:"",name:"m_disp"}],listeners:{afterrender:function(p){var o=this;o.cam=o.cpa.sobj.cAM;o.g_key=o.down("[name=g_key]");o.g_fields=o.down("[name=g_fields]");o.m_disp=o.down("[name=m_disp]");o.l1()},scrollershow:function(o,p,q){},resize:function(p,q,o,t,s,u){p.l3();e.s5.call(e)},move:function(p,o,s,q){if(o<0||s<0){this.setPosition(o<0?0:o,s<0?0:s)}e.s5.call(e)},close:function(o,p){c.s9.call(c,l)}}})};IG$.m93.prototype={cAM:function(a){if(this.table.cAM==a){return}this.table.cAM=a;this.o3.cAM.call(this.o3,a)},cp:function(c){var f=this,a=f.pobj,e,g,d;if(f.table.cpM==c){return}f.table.cpM=c;f.o3.cpM=c;if(c==true){e=$(f.o3.body.dom);bem=$(f.o3.el.dom);d=Math.abs(bem.height()-e.height()+5);d=Math.max(d,40);f.table.theight=f.o3.getHeight();f.o3.setHeight(d)}else{f.o3.setHeight(f.table.theight);var b=f.table.twidth,d=f.table.theight;f.o3.setWidth(b);f.o3.setHeight(d)}a.s5.call(a);a.s6.call(a)}};IG$.m94=function(b,e,f,d,a){var c=this;c.pobj=b;c.o10=e;c.o11=f;c.links=[d];c.relations=a;c.o8="";c.o9="";c.lm=b.lm};IG$.m94.prototype={validateDirection:function(){var d=$(this.o10.box.o3.body.dom),e=d.offset(),g=$(this.o11.box.o3.body.dom),c=g.offset(),b=IG$.x_10._w(d),a=IG$.x_10._w(g);if(e.left+b<c.left){this.o8="right";this.o9="left"}else{if(c.left+a<e.left){this.o8="left";this.o9="right"}else{if(e.left>c.left){this.o8="right";this.o9="right"}else{this.o8="right";this.o9="right"}}}},l2:function(b,a){var c=new IG$.m$93({pobj:this.pobj,link:b,links:a,relations:this.relations,callback:new IG$._I3d(this,this.rs_l2)});c.show(null)},rs_l2:function(e){var c=this,a=e[0],d=e[1],b;switch(d){case"remove":this.pobj.sobj.d1m.call(this.pobj.sobj);this.pobj.sobj.s6.call(this.pobj.sobj);this.pobj.s6.call(this.pobj);break;case"confirm":for(b=0;b<c.links.length;b++){if(c.links[b]!=a[0]){c.links[b].join=a[0].join}}this.pobj.s6.call(this.pobj);break}},refresh:function(l,B){var A,c=this,a=1,f,e,d,b,x=c.o10,v=c.o11,k=c.links,o=10,F,D,G,y=5,z=10,C=c.pobj.rcanvas,E={stroke:"#8d8d8d","stroke-width":1,fill:"none",opacity:1},w={stroke:"#8d8d8d",fill:"#8d8d8d",opacity:1},H=0,p,n,s,u=[],q="0",m,t;if(c.links&&c.links.length>1&&B==true){a=c.links.length*1.5}c.validateDirection();u=(B==true&&k.length>0)?[k[0]]:k;$.each(u,function(Y,P){var W;if(!P){return}var Q=c.o8,g=c.o9;P.p1dist=(typeof(P.p1dist)=="undefined")?null:P.p1dist;if(P.source.tablename==v.name&&P.target.tablename==x.name&&P.source.seq==v.seq&&P.target.seq==x.seq){x=c.o11;v=c.o10;if(Q!=g){if(Q=="right"){Q="left"}else{Q="right"}if(g=="right"){g="left"}else{g="right"}}}else{x=c.o10;v=c.o11}p=(k.length==1||B==false)?k[Y].source.name:null;f={x:x.s1(),y:x.s2(p)};p=(k.length==1||B==false)?k[Y].target.name:null;b={x:v.s1(),y:v.s2(p)};if(x.ranged==true&&v.ranged==true){s=true;E.stroke="#000000";E["stroke-width"]=a;w.stroke="#000000";w.fill="#000000"}else{if(a>1){s=false;E.stroke="#000000";E["stroke-width"]=a;w.stroke="#000000";w.fill="#000000"}else{s=false}}if(Q=="right"){f.x+=x.s3();e={x:f.x+z,y:f.y}}else{if(Q=="left"){e={x:f.x-z,y:f.y}}}if(g=="right"){b.x+=v.s3();d={x:b.x+z,y:b.y}}else{if(g=="left"){d={x:b.x-z,y:b.y}}}if(q=="2"){if(Q==g&&g=="right"){e={x:Math.max(f.x,b.x)+z,y:f.y};d={x:Math.max(f.x,b.x)+z,y:b.y};if(P.p1dist!=null){W=f.x+P.p1dist;if(W<Math.max(f.x,b.x)+z){P.p1dist=null}}}else{if(Q==g&&g=="left"){e={x:Math.min(f.x,b.x)-z,y:f.y};d={x:Math.min(f.x,b.x)-z,y:b.y};if(P.p1dist!=null){W=f.x+P.p1dist;if(W>Math.min(f.x,b.x)-z){P.p1dist=null}}}else{t=(f.x+b.x)/2;e={x:t,y:f.y};d={x:t,y:b.y};if(P.p1dist!=null){W=f.x+P.p1dist;if(Q=="right"){if(W<f.x+z||W>b.x-z){P.p1dist=null}}else{if(W>f.x-z||W<b.x+z){P.p1dist=null}}}}}if(P.p1dist!=null){e.x=f.x+P.p1dist;d.x=e.x}}G=IG$._I44(e,d,3);G=G.length>0?G[1]:null;if(k&&k.length>0&&k[0].join=="right outer"){if(g=="right"){C.path("M"+b.x+" "+(b.y+o)+"L"+(b.x+o)+" "+b.y+"L"+b.x+" "+(b.y-o)).attr(E)}else{C.path("M"+b.x+" "+(b.y+o)+"L"+(b.x-o)+" "+b.y+"L"+b.x+" "+(b.y-o)).attr(E)}}else{if(k&&k.length>0&&k[0].join=="left outer"){if(Q=="right"){C.path("M"+f.x+" "+(f.y+o)+"L"+(f.x+o)+" "+f.y+"L"+f.x+" "+(f.y-o)).attr(E)}else{C.path("M"+(f.x)+" "+(f.y+o)+"L"+(f.x-o)+" "+f.y+"L"+(f.x)+" "+(f.y-o)).attr(E)}}}C.path("M"+f.x+" "+f.y+"L"+e.x+" "+e.y+"L"+d.x+" "+d.y+"L"+b.x+" "+b.y).attr(E);var I=(k.length==1||B==true)?k:[k[Y]];var aa=$("<div class='igc-cm-join'><span></span></div>").appendTo(c.pobj.o7),R="",Z=$("span",aa),V;if(B==true){for(Y=0;Y<k.length;Y++){if(Y>0){R+="\n"}R+=k[Y].source.name;if(k[Y].source.name!=k[Y].target.name){R+=" - "+k[Y].target.name}}}else{R=P.source.name+" - "+P.target.name}Z.html(R);aa.attr("title",R);V=Math.min(Z.width()/2||30,20);aa.css({left:G.x-V,top:G.y});aa.bind("click",function(ab){ab.preventDefault();ab.stopPropagation();c.l2.call(c,I,k)});c.pobj._ca.push(aa);if(q=="2"){var L=0,K=0,N=0,M=0,J=0,U=G.x,S=G.y;var T=function(ac,ab){var ad=this;L=ac+N;J=G.x+L;K=0;if(Q==g&&Q=="right"){if(J<Math.max(f.x,b.x)+o){L=Math.max(f.x,b.x)+o-G.x;return}else{if(J>Math.max(f.x,b.x)+500){L=Math.max(f.x,b.x)+500-G.x;return}}}else{if(Q=="right"){if(J<f.x+o){L=f.x+o-G.x;return}}else{if(J>f.x-o){L=f.x-o-G.x;return}}if(g=="left"){if(J>b.x-o){L=b.x-o-G.x;return}}else{if(J<b.x+o){L=b.x+o-G.x;return}}}ad.transform("t"+L+","+K)};var X=function(ab){};var O=function(ab){N=L;M=K;if(Math.abs(L)<2&&Math.abs(K)<2){c.l2.call(c,I,k)}else{P.p1dist=G.x+L-f.x;c.pobj.s6.call(c.pobj)}};aa.drag(T,X,O)}})}};IG$.m$93f=$s.extend($s.window,{title:"Join (Relation) Custom Field",modal:true,region:"center",layout:"fit",closable:false,resizable:false,width:420,l1:function(){var a=this,b=a._t1;if(b){a.down("[name=t_disp]").setValue(b.name);a.down("[name=t_value]").setValue(b.formula)}},l99:function(){var a=this,b=a._t1;if(b){b.formula=a.down("[name=t_value]").getValue()}a.callback&&a.callback.execute();a.close()},initComponent:function(){var a=this;$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",name:"t_disp"},{xtype:"textarea",name:"t_value",height:120},{xtype:"displayfield",value:"Field in formula, Use {FIELD}. Ex: SUBSTR({FIELD}, 1, 6)"}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this.l99()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(b){this.l1()}}});IG$.m$93f.superclass.initComponent.apply(this,arguments)}});IG$.m$93=$s.extend($s.window,{title:"Join (Relation) Editor",modal:true,region:"center",layout:"fit",closable:false,resizable:false,width:420,autoHeight:true,callback:null,l98:null,l1:function(){this.l98=null;if(this.link&&this.link.length>0){var a=this.down("[name=selR]"),e=this.down("[name=btn_upd]"),f=[],d,c,b;if(this.link.length>1){a.setVisible(true);e.setVisible(true);for(d=0;d<this.link.length;d++){b=this.link[d];f.push({name:b.source.tablename+"."+b.source.name+" - "+b.target.tablename+"."+b.target.name,__i:d})}a.store.loadData(f);a.setValue(0)}this.l1a(this.link[0])}},l1a:function(f){var e=this,d=e.down("[name=sfield]"),c=e.down("[name=tfield]"),a=e.down("[name=oprel]"),b=e.down("[name=opcon]");if(f){e.l98=f;d.setValue(e.ma(f.source));c.setValue(e.ma(f.target));a.setValue(f.join);b.setValue(f.operator)}},ma:function(a){var b="";if(a.formula){b=a.formula;b=b.replace("{FIELD}",a.name)}else{b=a.tablename+"."+a.name}return b},l97a:function(){var d,b,f=false,e,a=this.down("[name=selR]");if(this.link.length>1){for(d=0;d<this.relations.length;d++){if(this.relations[d]==this.l98){this.relations.splice(d,1);break}}for(d=0;d<this.link.length;d++){if(this.link[d]==this.l98){this.link.splice(d,1);f=true;break}}for(d=0;d<this.pobj.links.length;d++){e=false;for(b=0;b<this.pobj.links[d].links.length;b++){if(this.pobj.links[d].links[b]==this.l98){this.pobj.links[d].links.splice(b,1);e=true;break}}if(e==true){if(this.pobj.links[d].length==0){this.pobj.links.splice(d,1)}break}}if(f==true){var c=a.getValue();for(d=0;d<a.store.data.items.length;d++){if(a.store.data.items[d].get("__i")==c){a.store.removeAt(d);break}}if(a.store.data.items.length==1){a.hide()}if(a.store.data.items.length>0){a.setValue(a.store.data.items[0].get("__i"))}}for(d=0;d<a.store.data.items.length;d++){a.store.data.items[d].set("__i",d)}this.callback&&this.callback.execute([this.link,"remove"])}else{for(d=0;d<this.relations.length;d++){if(this.relations[d]==this.l98){this.relations.splice(d,1);break}}for(d=0;d<this.pobj.links.length;d++){f=false;for(b=0;b<this.pobj.links[d].links.length;b++){if(this.pobj.links[d].links[b]==this.l98){this.pobj.links[d].links.splice(b,1);f=true;break}}if(f==true){if(this.pobj.links[d].length==0){this.pobj.links.splice(d,1)}break}}this.callback&&this.callback.execute([this.link,"remove"]);this.close()}},l97:function(){var a=this.down("[name=oprel]"),b=this.down("[name=opcon]");if(this.l98){this.l98.join=a.getValue();this.l98.operator=b.getValue()}},l99:function(){this.l97();this.callback&&this.callback.execute([this.link,"confirm"]);this.close()},_m1:function(d){var b=this,a=b.l98,c=b.down("[name="+(d?"s":"t")+"field]"),e=d?a.source:a.target,f;if(e){f=new IG$.m$93f({_t1:e,callback:new IG$._I3d(b,function(){c.setValue(this.ma(e))})});IG$._I_5(b,f)}},initComponent:function(){$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"form",layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",fieldLabel:"Relation",name:"selR",hidden:true,queryMode:"local",autoSelect:true,autoScroll:true,editable:false,labelField:"name",displayField:"name",valueField:"__i",store:{fields:["name","__i"]},listeners:{change:function(e,d,a,b){var c=e.getValue();this.l1a(this.link[c])},scope:this}},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},name:"sfield_cnt",items:[{xtype:"textfield",name:"sfield",fieldLabel:"Source field",readOnly:true,flex:1},{xtype:"button",text:"..",handler:function(){this._m1(true)},scope:this}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},name:"tfield_cnt",items:[{xtype:"textfield",name:"tfield",fieldLabel:"Target field",readOnly:true,flex:1},{xtype:"button",text:"..",handler:function(){this._m1(false)},scope:this}]},{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},defaults:{labelWidth:150},title:"Options",items:[{xtype:"combobox",name:"oprel",fieldLabel:"Source to Target data is",queryMode:"local",autoSelect:true,editable:false,valueField:"op",displayField:"name",labelField:"name",$w:390,store:{fields:["name","op","desc"],data:[{name:"Inner equal",op:"inner",desc:"Show only match values"},{name:"Left outer",op:"left outer",desc:"Show all source values even not match"},{name:"Right outer",op:"right outer",desc:"Show all target values even not match"},{name:"Auto natural",op:"natural",desc:"Automatic join with column foreign key"},{name:"Full outer",op:"full outer",desc:"Show all source and target values"}]},listeners:{change:function(d){var f,b,c,e=d.getValue(),a=this.down("[name=op_desc]");for(b=0;b<d.store.data.items.length;b++){c=d.store.data.items[b];if(c.get("op")==e){f=c;break}}if(f){a.setValue("* "+f.get("desc"))}},scope:this}},{xtype:"displayfield",name:"op_desc"},{xtype:"combobox",name:"opcon",fieldLabel:"With Condition",queryMode:"local",autoSelect:true,editable:false,valueField:"op",displayField:"name",labelField:"name",hidden:false,store:{fields:["name","op"],data:[{name:"=",op:"="},{name:">",op:">"},{name:"<",op:"<"},{name:">=",op:">="},{name:"<=",op:"<="}]}}]},{xtype:"container",layout:{type:"hbox",align:"right"},items:[{xtype:"button",name:"btn_upd",text:"Confirm current",hidden:true,handler:function(){this.l97()},scope:this},{xtype:"button",text:"Remove Relation",handler:function(){this.l97a()},scope:this}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this.l99()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(a){this.l1()}}});IG$.m$93.superclass.initComponent.apply(this,arguments)}});IG$._IC7=$s.extend(IG$._I57,{collapseFirst:false,bodyBorder:false,layout:"border",defaults:{collapsible:false,split:false,animFloat:false,autoHide:false,useSplitTips:true},initialized:false,closable:true,m:null,overflowX:"hidden",overflowY:"hidden",cpM:false,_IFd:function(){var b=this,a=b.down("[name=mcontainer]");b.m=new IG$.m92($(a.body.dom),b);b.m.init();if(b.uid){b.l1();if(b.writable){IG$._I56(b,function(c){if(c!="unlock"){b.writable=false;b.down("[name=t_save]").hide()}})}}else{if(b._c$){b.rs_l1(b._c$)}else{b.c1=new IG$.mm$99(null);b.l2()}}},l1:function(){var a=this,b=new IG$._I3e();a.setLoading(true);b.init(a,{ack:"5",payload:IG$._I2d({address:a.uid},"address"),mbody:IG$._I2e({option:"diagnostics"})},a,a.rs_l1,null);b._l()},rs_l1:function(a){var b=this;b.c1=new IG$.mm$99(a);b.l2()},l2:function(){var b=this,d=new IG$._I3e(),a="",c;if(b.c1.pooluids.length==0){b._t$("cmd_add_schema");return}a="<smsg>";for(c=0;c<b.c1.pooluids.length;c++){a+="<item"+IG$._I30({address:b.c1.pooluids[c],option:"StoredContent"})+"/>"}a+="</smsg>";b.setLoading(true);d.init(b,{ack:"25",payload:a,mbody:IG$._I2e()},b,b.rs_l2,null);d._l()},rs_l2:function(a){var c=this,e=IG$._I18(a,"/smsg"),g,d=c.down("[name=sc_lst]"),b,f=[{name:"SELECT",value:""}];if(e){c.l2aT(e,f);d.store.loadData(f);d.setValue(f.length>1?f[1].value:"")}c.down("[name=b_rs]").setVisible(f.length>2);c.d1(1);c.d2()},l2aT:function(g,d){var k=IG$._I26(g),c,b,f,e,a;for(c=0;c<k.length;c++){a=IG$._I1c(k[c]);a.dispname=a.name;if(a.dispname.length>17&&a.dispname.charAt(17)=="_"){a.dispname=a.dispname.substring(18)}if(k[c].hasChildNodes()){e=IG$._I26(k[c]);for(b=0;b<e.length;b++){f=IG$._I1c(e[b]);d.push({value:f.uid,name:a.dispname+"-"+f.name})}}else{d.push({value:"",name:a.dispname+"-ERROR(No Schema)"})}}},l4:function(e,c){var a=this,g=a.down("[name=sc_lst]"),b=a.down("[name=f_kwd]"),f=g.getValue(),d=new IG$._I3e();if(f){a.setLoading(true);d.init(a,{ack:"25",payload:IG$._I2d({uid:f,option:c,search:b.getValue()},"uid;option;search"),mbody:IG$._I2e()},a,a.rs_l4,false,[e,c]);d._l()}},rs_l4:function(l,b){var m=this,c=b[0],k=b[1],o=m.down("[name=mgrid_schema]"),g=m.c1,a=IG$._I18(l,"/smsg/item"),d,f,e,p=[],n={};m.setLoading(false);if(a){d=IG$._I26(a);for(f=0;f<g.tables.length;f++){n[g.tables[f].uid]=1}for(f=0;f<d.length;f++){e=IG$._I1c(d[f]);if(!k){e.checked=false}if(n[e.uid]){e.used="*"}e.leaf=true;e.allowDrag=true;e.dispname=e.name;p.push(e)}}o.store.loadData(p)},l5a:function(){var e=this,d=e.down("[name=mgrid_schema]"),b,a=d.store,c=e.c1,f={};if(a.data.items.length){for(b=0;b<c.tables.length;b++){f[c.tables[b].uid]=1}for(b=0;b<a.data.items.length;b++){a.data.items[b].set("used",f[a.data.items[b].get("uid")]?"*":"")}}},l5:function(c,e,d){var a=this,b=new IG$._I3e();a.setLoading(true);b.init(a,{ack:"25",payload:IG$._I2d({uid:c.uid,nodepath:c.nodepath,name:c.name,option:"StoredContent"},"uid;name;nodepath;option"),mbody:IG$._I2e()},a,function(k,l){var g=this,q=IG$._I18(k,"/smsg/item"),p,f=[],o,n;if(q){p=IG$._I26(q,"Field");for(n=0;n<p.length;n++){o=IG$._I1c(p[n]);o.tablename=l.name||o.tablename;o.alias=o.alias||o.name;o.iskey=o.iskey=="T";o.leaf=true;o.dispname=o.name;o.allowDrag=true;o.seq=l.seq;o.tableuid=l.uid;f.push(o)}}l.fields=f;if(!e||(e&&d)){g.d1();g.d2()}},null,c);b._l()},l5m:function(a){var b=new IG$.DM2a({table:a});IG$._I_5(this,b)},d1m:function(){var f=this,d=f.c1,c,a,l,b,k,g,e;for(c=0;c<d.tables.length;c++){l=d.tables[c];tname=l.name+"_"+l.seq;for(a=0;a<l.fields.length;a++){l.fields[a].hasjoin=false}for(b=0;b<d.relations.length;b++){r=d.relations[b];k=r.source.tablename+"_"+r.source.seq;g=r.target.tablename+"_"+r.target.seq;e=(k==tname)?r.source.name:((g==tname)?r.target.name:null);if(e){for(a=0;a<l.fields.length;a++){if(l.fields[a].name==e){l.fields[a].hasjoin=true;break}}}}if(l.box&&l.cAM){l.box.o3.l1.call(l.box.o3)}}},d1:function(d){var l=this,e,f=l.c1,q,a,c=l.m,o,n,p,k,g,b;l.tablemap=l.tablemap||{};l.d1m();$.each(f.tables,function(u,y){var t,s,m,x,w,z,v;o=y.x=Number(y.x);n=y.y=Number(y.y);p=y.width=Number(y.width);k=y.height=Number(y.height);g=y.theight=Number(y.theight)||y.height;b=y.cpM;z=y.uid+"_"+y.seq;if(y.box){y.box.o3.l1.call(y.box.o3)}else{a=c.s7.call(c,o,n,p,k,y,l);y.box=a;if(d){l.l5.call(l,y,d,u==f.tables.length-1)}}l.tablemap[z]=y});c.s5.call(c)},d2:function(){var f=this,d,e,k,b,c=f.c1,a=f.m,g;for(d=c.relations.length-1;d>=0;d--){e=c.relations[d];k=f.tablemap[e.source.tableuid+"_"+e.source.seq];b=f.tablemap[e.target.tableuid+"_"+e.target.seq];if(!k||!b){c.relations.splice(d,1)}else{if(!e.bl){e.bl=a.s8.call(a,k,b,e,c.relations)}}}f.d1m();f.s6();a.s6.call(a)},s6:function(){var e=this,d=e.down("[name=mRel]"),b=[],a=e.m,c,g=a.relations||[],f,l,k;for(c=0;c<g.length;c++){f=g[c];l=f.source;k=f.target;if(l&&k){b.push({s0:l.tablename,t0:k.tablename,s1:l.seq,t1:k.seq,s2:l.name,t2:k.name,r0:f.join,sdesc:l.tablename+"."+l.name,tdesc:k.tablename+"."+k.name,l:f})}}d.store.loadData(b)},d3:function(f,g){var a=this,b=g,e,c=a.c1,k=a.m.viewer.offset(),d;e=new IG$.mm$98(null);IG$._I1d(b,e,"nodepath;name;type;uid;memo;schemaname;alias");e.x=f.getX()-k.left;e.y=f.getY()-k.top;e.width=180;e.height=200;e.seq=0;e.fields=[];for(d=0;d<c.tables.length;d++){if(c.tables[d].uid==e.uid){e.seq=Math.max(e.seq,c.tables[d].seq+1)}}c.tables.push(e);a.l5a();a.l5(e)},d5a:function(){var d=this,a=d.m,c,k,g,e,f,l=a.o5.offset(),b=d.c1;for(c=0;c<b.tables.length;c++){k=b.tables[c];g=k.box.o3;f=$(g.el.dom);e=f.offset();k.x=e.left-l.left;k.y=e.top-l.top;k.width=g.getWidth();k.height=g.getHeight();if(!k.cpM){k.theight=k.height}}},d5:function(f){var a=this;a.d5a();var c,b=a.c1,e=b.l1.call(b),d=new IG$._I3e(),g;a.setLoading(true);if(f){g=IG$._I2d({pid:b.item.pid,address:b.item.address,name:b.item.name,type:"CubeModel"},"address;uid;name;nodepath;option;type")}else{g=IG$._I2d({uid:a.uid},"uid;name;nodepath;option")}d.init(a,{ack:"31",payload:g,mbody:e},a,a.rs_d5,null);d._l()},rs_d5:function(a){var b=this,d=IG$._I18(a,"/smsg/item"),c;if(d){b.uid=IG$._I1b(d,"uid");c=IG$._I1b(d,"name");b.setTitle(c);b.down("[name=b_b_cube]").show()}IG$._I54(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},d4:function(b,g){var e=this,c=e.c1,a=e.m,d={join:"inner",operator:"="},f,k;d.source={nodepath:b.get("nodepath"),datasize:b.get("datasize"),datatype:b.get("datatype"),name:b.get("name"),tablename:b.get("tablename"),type:b.get("type"),seq:b.get("seq"),tableuid:b.get("tableuid")};d.target={nodepath:g.get("nodepath"),datasize:g.get("datasize"),datatype:g.get("datatype"),name:g.get("name"),tablename:g.get("tablename"),type:g.get("type"),seq:g.get("seq"),tableuid:g.get("tableuid")};c.relations.push(d);e.d1m();f=e.tablemap[d.source.tableuid+"_"+d.source.seq];k=e.tablemap[d.target.tableuid+"_"+d.target.seq];if(f&&k){d.bl=a.s8.call(a,f,k,d,c.relations);e.s6();a.s6.call(a)}},d6:function(){var a=this,b=new IG$._If2({callback:new IG$._I3d(a,a.rs_d6)});IG$._I_5(a,b)},rs_d6:function(f){var e=this,d,b,g,c=f._s1,a=[];if(c&&c.length>0){for(d=0;d<c.length;d++){g=false;for(b=0;b<e.c1.pooluids.length;b++){if(e.c1.pooluids[b]==c[d].uid){g=true;break}}if(!g){e.c1.pooluids.push(c[d].uid);e.c1.pools.push(c[d].name)}}e.l2()}},_t$:function(e){var b=this,a=b.m,d;switch(e){case"cmd_save":if(!b.uid){b.$f1(false)}else{b.d5()}break;case"cmd_saveas":b.$f1(false);break;case"cmd_simple_view":b.c1.groupview=!b.c1.groupview;a.s6.call(a);break;case"cmd_c_a":var c=b.c1;b.cpM=!b.cpM;for(d=0;d<c.tables.length;d++){if(c.tables[d].box.table.cpM!=b.cpM){c.tables[d].box.cp.call(c.tables[d].box,b.cpM)}}break;case"cmd_fix_key":var c=b.c1;c.cAM=!c.cAM;for(d=0;d<c.tables.length;d++){c.tables[d].box.cAM.call(c.tables[d].box,c.cAM)}break;case"cmd_add_schema":b.d6();break;case"cmd_table_order":var f=new IG$._IA9({c1:b.c1});f.show(b);break;case"cmd_zoomin":a.z1.call(a,0.2);break;case"cmd_zoomout":a.z1.call(a,-0.2);break;case"cmd_b_cube":IG$._I55(IRm$.r1("B_CONFIRM"),IRm$.r1("B_B_CUBE"),function(g){if(g=="yes"){b.b1.call(b)}});break}},b1:function(){var a=this,b=new IG$._I96({mode:"newitem",initpath:a.nodepath,callback:new IG$._I3d(a,function(e){var d=this,c=new IG$._I3e();c.init(d,{ack:"31",payload:IG$._I2d({address:e.nodepath+"/"+e.name,name:e.name,type:"Cube",pid:e.uid},"address;name;type;pid"),mbody:IG$._I2e()},d,function(f){var l=IG$._I18(f,"/smsg/item"),k=IG$._I1c(l),g=IG$._I7d;g&&g.m1$7.call(g,k.uid,"cube".toLowerCase(),k.name||e.name,null,false,true,{cube_model_uid:d.uid,build_cube:1})},null);c._l()})});IG$._I_5(a,b)},$f1:function(a){var b=this,c=new IG$._I96({mode:"newitem",initpath:b.nodepath,callback:new IG$._I3d(b,b.$f2,a)});IG$._I_5(b,c)},$f2:function(c,b){var a=this;a.c1.item={name:c.name,address:c.nodepath+"/"+c.name,pid:c.uid};a.d5(true)},_r_join:function(b){var f=this,d,e=f.c1,a=f.m,c=e.relations,g;for(d=0;d<c.length;d++){if(c[d]==b){c.splice(d,1);break}}for(d=0;d<a.links.length;d++){g=false;for(j=0;j<a.links[d].links.length;j++){if(a.links[d].links[j]==b){a.links[d].links.splice(j,1);g=true;break}}if(g==true){if(a.links[d].length==0){a.links.splice(d,1)}break}}f.d1m();f.s6();a.s6.call(a)},_s2:function(){var c=this,b=c.down("[name=txt_rel]").getValue(),d=c.down("[name=mRel]"),a=d.store;a.clearFilter();if(b){b=b.toLowerCase();a.filterBy(function(k){var g=[k.get("s0"),k.get("s2"),k.get("t0"),k.get("t2")],e=false,f;for(f=0;f<g.length;f++){if(g[f]&&g[f].toLowerCase().indexOf(b)>-1){e=true;break}}return e})}},initComponent:function(){var a=this;$s.apply(this,{items:[{xtype:"panel",region:"west",width:250,split:true,collapsible:true,hideHeaders:true,title:"Table Lists",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",layout:"anchor",defaults:{anchor:"100%",labelWidth:60},items:[{xtype:"fieldcontainer",fieldLabel:"Schema",layout:{type:"hbox",align:"stretch"},items:[{xtype:"combobox",editable:false,flex:1,queryMode:"local",name:"sc_lst",displayField:"name",valueField:"value",store:{xtype:"store",fields:["name","value"]}},{xtype:"button",iconCls:"icon-toolbar-add-schema",tooltip:"Add Schema",handler:function(){this._t$("cmd_add_schema")},scope:this},{xtype:"button",hidden:true,name:"b_rs",iconCls:"icon-toolbar-remove",tooltip:"Remove Schema",handler:function(){var e=this,c=e.c1?e.c1.pooluids:null,g=e.down("[name=sc_lst]"),b=g.store,k=g.getValue(),d,f;if(c.length>1){for(d=0;d<c.length;d++){if(c[d]==k){c.splice(d,1);break}}for(d=0;d<b.data.items.length;d++){f=b.data.items[d];if(f.get("value")==k){b.remove(f);break}}g.setValue(b.data.items[1].get("value"));e.down("[name=b_rs]").setVisible(b.data.items.length>2)}},scope:this}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:"Field",items:[{xtype:"textfield",name:"f_kwd",flex:1,enableKeyEvents:true,listeners:{keyup:function(b,d,c){d.keyCode==13&&this.l4(null,"StoredContent")},scope:this}},{xtype:"button",text:"..",handler:function(){this.l4(null,"StoredContent")},scope:this}]}]},{xtype:"gridpanel",name:"mgrid_schema",enableDragDrop:true,enableDD:true,useArrows:true,flex:1,ddGroup:"CubeModelDDGroup",viewConfig:{plugins:{ptype:"gridviewdragdrop",dragGroup:"CubeModelDDGroup"},listeners:{drop:function(d,e,f,b){var c=f?" "+b+" "+f.get("name"):" on empty view"}}},store:{xtype:"store",showcheckselect:true,fields:["name","type","nodepath","dispname","uid","used"]},columns:[{text:"",width:20,dataIndex:"used"},{text:IRm$.r1("B_NAME"),flex:1,hideable:false,dataIndex:"dispname"}],bbar:[{xtype:"displayfield",value:"Drag table to content area"}],listeners:{cellclick:function(b,c,q,l,p,s,m,n){var o=this,d=b.store.getAt(s),k=o.c1,g,f;if(d.get("used")=="*"){for(g=0;g<k.tables.length;g++){if(k.tables[g].uid==d.get("uid")){f=k.tables[g];break}}f&&o.m._f1(f)}},scope:this}}]},{type:"panel",html:"",overflowX:"hidden",overflowY:"hidden",name:"mcontainer",region:"center",title:"Model Contents"},{xtype:"panel",title:"Relations",region:"east",width:320,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"Search",name:"txt_rel",labelWidth:40,labelAlign:"right",flex:1,enableKeyEvents:!0,listeners:{keyup:function(c,b,d){if(b.keyCode==13){a._s2()}},scope:this}},{xtype:"button",text:"..",handler:function(){a._s2()}}]},{xtype:"gridpanel",name:"mRel",flex:1,store:{fields:["s0","s1","s2","t0","t1","t2","r0","sdesc","tdesc","l"]},columns:[{text:"From",flex:1,dataIndex:"sdesc"},{text:"To",flex:1,dataIndex:"tdesc"},{xtype:"actioncolumn",width:45,items:[{iconCls:"icon-grid-config",tooltip:"Config item",handler:function(d,g,c){var f=d.store.getAt(g),b=f.get("l"),e;if(b&&b.bl){e=b.bl;e.l2.call(e,[e.links[0]],e.links)}}},{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(c,e,b){var d=c.store.getAt(e);a._r_join(d.get("l"))}}]}]}]}],tbar:[{iconCls:"icon-toolbar-save",name:"t_save",tooltip:"Save table",handler:function(){this._t$("cmd_save")},scope:this},{iconCls:"icon-toolbar-saveas",name:"t_save_as",tooltip:IRm$.r1("L_SAVE_REPORT_AS"),handler:function(){this._t$("cmd_saveas")},scope:this},{iconCls:"icon-toolbar-simple-view",tooltip:"Simple Relation View",handler:function(){this._t$("cmd_simple_view")},scope:this},{iconCls:"icon-toolbar-c_a",tooltip:"Collapse/Expand all tables",hidden:window.Ext?false:true,handler:function(){this._t$("cmd_c_a")},scope:this},{iconCls:"icon-toolbar-table-order",tooltip:"Table order",handler:function(){this._t$("cmd_table_order")},scope:this},{iconCls:"icon-toolbar-fixkey",text:"Fix key",tooltip:"Fix Key columns",handler:function(){this._t$("cmd_fix_key")},scope:this},{iconCls:"icon-toolbar-export",tooltip:"Print",handler:function(){this._t$("cmd_print")},scope:this},"->",{iconCls:"icon-cube",name:"b_b_cube",text:IRm$.r1("L_BUILD_CUBE"),tooltip:IRm$.r1("B_BUILD"),hidden:!this.uid,handler:function(){this._t$("cmd_b_cube")},scope:this}],listeners:{afterrender:function(b){this._IFd()},resize:function(b){this.m.s5.call(this.m)},beforeclose:function(c,d){var e=true;if(this.writable&&this.uid){var b=new IG$._I3e();b.init(c,{ack:"11",payload:IG$._I2d({uid:c.uid}),mbody:IG$._I2e({option:"lock",detail:"close"})},c,function(f){},false);b._l()}return e}}});IG$._IC7.superclass.initComponent.call(this)}});IG$._IA9=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:true,resizable:true,width:500,height:610,callback:null,_IFd:function(){var c=this,b=c.c1,a,d=[],f=c.down("[name=grd_tables]"),e;for(a=0;a<b.tables.length;a++){e={uid:b.tables[a].uid,name:b.tables[a].name,seq:b.tables[a].seq};e.disp=(e.seq)?e.name+"("+e.seq+")":e.name;d.push(e)}f.store.loadData(d)},CC1:function(){var e=this,d=e.c1,b={},c,g=e.down("[name=grd_tables]"),f,a;for(c=0;c<g.store.data.items.length;c++){f=g.store.data.items[c];b[f.get("uid")+"_"+f.get("seq")]=c}for(c=0;c<d.tables.length;c++){a=d.tables[c].uid+"_"+d.tables[c].seq;d.tables[c].sortindex=b[a]}d.tables.sort(function(l,k){return l.sortindex-k.sortindex});e.close()},initComponent:function(){var a=this;a.title=IRm$.r1("L_TBL_ORD");$s.apply(this,{defaults:{bodyStyle:"padding:10px"},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",flex:1,$h:540,name:"grd_tables",store:{xtype:"store",fields:["name","uid","seq","disp"]},columns:[{xtype:"gridcolumn",flex:1,text:IRm$.r1("B_NAME"),dataIndex:"name"}]},{xtype:"container",padding:"0 0 0 5",layout:{type:"vbox",pack:"center",align:"stretch"},items:[{xtype:"button",iconCls:"ig-btn-up",handler:function(){var f=this.down("[name=grd_tables]"),c,e=f.getSelectionModel(),d=e.getSelection(),b;if(d.length==1){b=f.store.indexOf(d[0]);if(b>0){f.store.remove(d[0]);f.store.insert(b-1,d[0]);e.select(d[0])}}},scope:this},{xtype:"container",height:10},{xtype:"button",iconCls:"ig-btn-down",handler:function(){var f=this.down("[name=grd_tables]"),c,e=f.getSelectionModel(),d=e.getSelection(),b;if(d.length==1){b=f.store.indexOf(d[0]);if(b+1<f.store.data.items.length){f.store.remove(d[0]);f.store.insert(b+1,d[0]);e.select(d[0])}}},scope:this}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this.CC1()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]});IG$._IA9.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(a){a._IFd.call(a)}}});IG$.DM2a=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:true,resizable:true,width:500,autoHeight:true,callback:null,in$t:function(){var a=this;if(a.table){a.l1()}},l1:function(b){var a=this,c=new IG$._I3e();a.setLoading(true);c.init(a,{ack:"25",payload:IG$._I2d({uid:a.table.uid,type:a.table.type,passwd:b,option:"preview"},"uid;type;option;passwd"),mbody:IG$._I2e({option:"preview"})},a,a.rs_l1,a.err_l1);c._l()},_IMa:function(a){var b=this,c=IG$.dbp[a];if(!c){var d=new IG$._Ice({poolname:a,callback:new IG$._I3d(b,b.r_IMa,a)});IG$._I_5(b,d)}else{b.l1(c)}},r_IMa:function(b,a){IG$.dbp[a]=b;this.l1(b)},rs_l1:function(s){var v=this,b=IG$._I18(s,"/smsg/item/result"),q=IG$._I18(s,"/smsg/item/result/headers"),g=IG$._I18(s,"/smsg/item/result/data"),n,l,f,e,x=[],k=[],w,a,t,u,m=[],d,o=v.down("[name=dataview]"),p=v.table;umap={};v.setLoading(false);if(q&&g){for(n=0;n<p.fields.length;n++){umap[p.fields[n].name]=p.fields[n].alias}w=IG$._I1b(b,"delimiter");f=IG$._I26(q);for(n=0;n<f.length;n++){a=IG$._I1b(f[n],"name");if(umap[a]&&umap[a]!=a){a=umap[a]+" - "+a}t="col_"+n;k.push({xtype:"gridcolumn",width:150,text:a,dataIndex:t});m.push({name:t,mapping:t})}u=k.length;l=IG$._I24(g);l=l.split(w);e={};if(u>1){for(n=0;n<l.length;n++){t="col_"+(n%u);if(n>0&&n%u==0){x.push(e);e={};e[t]=l[n]}else{e[t]=l[n]}}}else{t="col_0";for(n=0;n<l.length-1;n++){e[t]=l[n];x.push(e)}}}d={store:"array",fields:m,data:x};o.reconfigure(d,k)},err_l1:function(a){var c=this,d=IG$._I18(a,"/smsg"),b=(d?IG$._I1b(d,"errorcode"):null),e=(d?IG$._I24(d):null);if(b=="0x4090"){c._IMa(e);return false}},initComponent:function(){var a=this;a.title=IRm$.r1("L_PRV_DATA");$s.apply(this,{defaults:{bodyStyle:"padding:10px"},layout:"fit",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:"Table data preview"},{xtype:"gridpanel",name:"dataview",height:400,columns:[]}]}],buttons:[{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(c){var b=this;b.in$t()}}});IG$.DM2a.superclass.initComponent.apply(this,arguments)}});IG$._Icb=$s.extend($s.window,{modal:true,layout:"fit",closable:false,resizable:false,width:500,autoHeight:true,bodyPadding:10,bodyStyle:{background:"#ffffff"},callback:null,sel:null,_IG0:function(){this.close()},mm1:function(){if(this.callback){var c=this.down("[name=gridduty_sel]"),a,b=[];for(a=0;a<c.store.data.length;a++){b.push(c.store.data.items[a])}this.callback.execute(b)}this.close()},mm2:function(){var a=this,b=new IG$._I3e();b.init(a,{ack:"28",payload:IG$._I2d({address:"/Auth"},"address"),mbody:IG$._I2e({option:"select"})},a,a.rs_mm2,false);b._l()},rs_mm2:function(g){var e,b=IG$._I18(g,"/smsg/item"),f,n=[],c=[],d,l,k=this.down("[name=gridduty]"),m=this.down("[name=gridduty_sel]"),a={};if(this.sel){for(e=0;e<this.sel.length;e++){a[this.sel[e].sid]=this.sel[e]}}if(b){f=IG$._I26(b);for(e=0;e<f.length;e++){l=IG$._I1c(f[e]);if(a[l.sid]){c.push(l)}else{n.push(l)}}}k.store.loadData(n);m.store.loadData(c)},m1:function(a){var e=this,d,b=e.down("[name=gridduty"+(a==false?"_sel":"")+"]"),c=e.down("[name=gridduty"+(a==true?"_sel":"")+"]"),f=b.getSelectionModel().getSelection();if(f.length>0){for(d=0;d<f.length;d++){b.store.remove(f[d]);c.store.add(f[d])}}},initComponent:function(){this.title=IRm$.r1("L_MGR_UD");var a=[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},border:0,items:[{xtype:"displayfield",value:IRm$.r1("L_UD_DESC")},{xtype:"panel",layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",name:"gridduty",flex:1,height:300,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},multiSelect:true,store:{fields:["name","dutytype","sid","status","type"]},columns:[{header:IRm$.r1("B_NAME"),dataIndex:"name",flex:1,sortable:true,hideable:false},{header:IRm$.r1("B_TYPE"),dataIndex:"type",flex:1,sortable:true,hideable:false}]},{xtype:"container",bodyPadding:"0 4 0 4",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:1},{xtype:"button",text:">>",handler:function(){this.m1(true)},scope:this},{xtype:"button",text:"<<",handler:function(){this.m1(false)},scope:this},{xtype:"container",flex:1}]},{xtype:"gridpanel",name:"gridduty_sel",flex:1,height:300,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},multiSelect:true,store:{fields:["name","dutytype","sid","status","type"]},columns:[{header:IRm$.r1("B_NAME"),dataIndex:"name",flex:1,sortable:true,hideable:false},{header:IRm$.r1("B_TYPE"),dataIndex:"type",flex:1,sortable:true,hideable:false}]}]}]}];var b=[{text:IRm$.r1("B_CONFIRM"),handler:function(){this.mm1()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}];$s.apply(this,{items:a,buttons:b});IG$._Icb.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(a){this.mm2()}}});IG$._IMm=$s.extend($s.window,{modal:true,layout:"fit",closable:false,resizable:false,width:540,height:480,callback:null,_IG0:function(){this.close()},_IFf:function(){var k=this,e=k.down("[name=grd_data]"),d=k.down("[name=i_cset_g]"),a=k.down("[name=displabel_c]"),b=k.down("[name=p_1a]"),g,f,l,c=k.pitem;if(c){c.ditem.name=k.down("[name=p_1]").getValue();c.ditem.description=k.down("[name=p_2]").getValue();c.dtype=k.down("[name=p_3]").getValue();c.dsql=k.down("[name=p_4]").getValue();c.dvalues=[];c.ds=k.down("[name=cbdatasource]").getValue();c.i_cdata=[];if(c.dtype=="static"){c.i_cset=k.down("[name=i_cset_s]").getValue()}else{c.i_cset=k.down("[name=i_cset]").checkboxCmp.getValue()}for(g=0;g<e.store.data.items.length;g++){f=e.store.data.items[g];if(f.get("value")){c.dvalues.push({code:f.get("code"),value:f.get("value")});if(c.dtype=="static"&&f.get("color")){c.i_cdata.push({value:f.get("code"),color:f.get("color")})}}}if(c.dtype!="static"){for(g=0;g<d.store.data.items.length;g++){f=d.store.data.items[g];if(f.get("color")){c.i_cdata.push({value:f.get("value"),color:f.get("color")})}}}b._IFf.call(b);if(c.dtype=="static"||c.dtype=="sql"){c.displabel=a.getValue()}l=new IG$._I3e();l.init(k,{ack:"31",payload:IG$._I2d({uid:k.pitem.ditem.uid}),mbody:k.pitem.p2.call(k.pitem)},k,function(m){var n=this;n.callback&&n.callback.execute(n.item);n._IG0()},null);l._l()}},_IFd:function(){this.l1()},r1:function(){var b=this,a=new IG$._I3e();a.init(b,{ack:"5",payload:IG$._I2d({uid:b.uid,revision:b.revision}),mbody:IG$._I2e({option:"diagnostics"})},b,function(c){var d=this;d.pitem=new IG$.iff(c);d._l1()},false);a._l()},l1:function(){var b=this,a=new IG$._I3e();a.init(b,{ack:"25",payload:IG$._I2d({address:"/"}),mbody:IG$._I2e({option:"standard"})},b,function(c){var k=this,n,f,m,l,e,g;l=IG$._I18(c,"/smsg/item");k.setLoading(false);if(l){m=IG$._I26(l);e="<smsg>";for(f=0;f<m.length;f++){n=IG$._I1c(m[f]);e+="<item address='/"+n.name+"' option='StoredContent'/>"}e+="</smsg>";k.setLoading(true);g=new IG$._I3e();g.init(k,{ack:"25",payload:e,mbody:"<smsg></smsg>"},k,k.rs_l1,null);g._l()}},false);a._l()},rs_l1:function(e){var g=this,b=[],d,f=IG$._I18(e,"/smsg"),c,a,l=false,k=g.down("[name=cbdatasource]");b.push({dispname:"-- Select Pool --",uid:""});if(f){c=IG$._I26(f);l=IG$._I83.jS2;for(d=0;d<c.length;d++){a=IG$._I1c(c[d]);if(l==true||(l==false&&a.name.toUpperCase()!="INGECEP")){a.dispname=a.name;a.dispname=IG$._I08(a.dispname);b.push(a)}}}k.store.loadData(b);k.setValue("");g.r1()},_l1:function(){var b=this,c=b.pitem,d=b.down("[name=p_1a]"),a;if(c){a=[{c:"p_1",v:c.ditem.name},{c:"p_2",v:c.ditem.description},{c:"p_3",v:c.dtype},{c:"p_4",v:c.dsql},{c:"cbdatasource",v:c.ds},{c:"i_cset_s",v:c.i_cset}];b.down("[name=p_1a]").rec=c;if(c.dtype=="sqljoin"){d.pooluid=c.ds;d.sK3.call(d)}b._l2(a);b.down("[name=grd_data]").store.loadData(c.dvalues);b.down("[name=i_cset_g]").store.loadData(c.i_cdata);b.down("[name=displabel_c]").setValue(c.displabel||"");if(c.i_cset){b.down("[name=i_cset]").expand()}}},_l2:function(a){var d=this,e,b;for(b=0;b<a.length;b++){e=d.down("[name="+a[b].c+"]");e.setValue(a[b].v||"")}},_m2:function(d,e){var b=d.getSelectionModel().getSelection(),a=b&&b.length?b[0]:null;if(!a){return}var c=d.getStore().indexOf(a);if(e<0){c--;if(c<0){return}}else{c++;if(c>=d.getStore().getCount()){return}}d.getStore().remove(a);d.getStore().insert(c,a);d.getSelectionModel().select(a,true)},initComponent:function(){var a,c=this,b=[];c.title=IRm$.r1("T_CODE_MAPPING");$s.apply(c,{bodyStyle:"padding:5px; background: #ffffff",items:[{xtype:"panel",padding:"5 5",border:0,autoScroll:true,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:IRm$.r1("B_NAME"),name:"p_1"},{xtype:"textarea",fieldLabel:IRm$.r1("B_DESC"),name:"p_2",height:60},{xtype:"combobox",fieldLabel:"Mapping Type",name:"p_3",store:{xtype:"store",fields:["name","value"],data:[{name:"Select",value:""},{name:"Static Values",value:"static"},{name:"SQL Query",value:"sql"},{name:"SQL Join",value:"sqljoin"}]},queryMode:"local",valueField:"value",displayField:"name",editable:false,listeners:{change:function(g,d,f){if(d){var e=this;e.down("[name=cbdatasource]").setVisible(d!="static");e.down("[name=lt_0]").setVisible(d=="static");e.down("[name=lt_1]").setVisible(d=="sql");e.down("[name=lt_2]").setVisible(d=="sqljoin");e.down("[name=i_cset]").setVisible(d!="static");e.down("[name=displabel_c]").setVisible(d!="sqljoin")}},scope:this}},{xtype:"fieldset",title:"Static Data Values",name:"lt_0",flex:1,hidden:true,layout:{type:"vbox",align:"stretch"},items:[{xtype:"checkbox",name:"i_cset_s",fieldLabel:"Use ColorSet",boxLabel:IRm$.r1("B_ENABLE"),listeners:{change:function(d){var f=d.getValue(),e=this.down("[name=grd_data]");e.columns[2].setVisible(f);e.columns[3].setVisible(f)},scope:this}},{xtype:"gridpanel",name:"grd_data",tbar:[{xtype:"toolbar",hidden:this.mdlgmode?true:false,items:[{text:"Add Row",xtype:"button",handler:function(){var d=this.down("[name=grd_data]");d.store.add({})},scope:this},{text:"Delete Selected",xtype:"button",handler:function(){var e=this.down("[name=grd_data]"),f=e.getSelectionModel().selected,d;for(d=f.length-1;d>=0;d--){e.store.remove(f.items[d])}},scope:this},"-",{xtype:"button",text:"Up",handler:function(){var e=this,d=e.down("[name=grd_data]");e._m2(d,-1)},scope:this},{xtype:"button",text:"Down",handler:function(){var e=this,d=e.down("[name=grd_data]");e._m2(d,1)},scope:this}]}],flex:1,store:{xtype:"store",fields:["code","value","color"]},selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{text:IRm$.r1("B_CODE"),dataIndex:"code",flex:1,editor:{xtype:"textfield",allowBlack:true}},{text:IRm$.r1("B_TEXT"),dataIndex:"value",flex:1,editor:{xtype:"textfield",allowBlack:false}},{xtype:"templatecolumn",text:IRm$.r1("B_COLOR"),dataIndex:"color",width:60,hidden:true,tpl:"<div style='width: 60px; height: 20px; background-color: {color}'></div>"},{xtype:"actioncolumn",hidden:true,width:20,items:[{iconCls:"icon-grid-config",handler:function(f,g,e){var d=new $s.menu({items:[{xtype:"colorpicker",text:"Color",listeners:{select:function(l,k){f.store.data.items[g].set("color","#"+k);l.hide()}}}]});d.show()}}]}]}]},{xtype:"combobox",name:"cbdatasource",queryMode:"local",fieldLabel:"Data Source",displayField:"dispname",valueField:"uid",editable:false,autoSelect:false,store:{xtype:"store",fields:["name","dispname","uid","isuserdb","savepwd"]},listeners:{select:function(d){var e=this,g=d.getValue(),k=e.down("[name=p_1a]"),f=e.down("[name=p_3]");if(f.getValue()=="sqljoin"){k.pooluid=g;k.sK3.call(k)}},scope:this}},{xtype:"fieldset",title:"SQL Data Values",name:"lt_1",minHeight:230,flex:1,hidden:true,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textarea",name:"p_4",flex:1}]},{xtype:"container",title:"SQL Table Join",name:"lt_2",flex:1,hidden:true,minHeight:600,layout:"anchor",items:[new IG$._IA8a({name:"p_1a",border:0,anchor:"100%",d_m:"cmap"})]},{xtype:"combobox",fieldLabel:"Label Value",name:"displabel_c",queryMode:"local",hidden:true,editable:true,valueField:"value",displayField:"name",store:{xtype:"store",fields:["name","value"],data:[{name:"Mapped values",value:""},{name:"{CODE} {VALUE}",value:"{CODE} {VALUE}"},{name:"{CODE} {SORT} {VALUE}",value:"{CODE} {SORT} {VALUE}"}]}},{xtype:"fieldset",title:"ColorSet",name:"i_cset",checkboxToggle:true,collapsed:true,height:200,layout:"fit",items:[{xtype:"gridpanel",name:"i_cset_g",selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},store:{xtype:"store",fields:["value","color"]},columns:[{text:"Value",dataIndex:"value",flex:1},{text:"Color",dataIndex:"color",flex:1}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._IFf()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){this._IFd()}}});IG$._IMm.superclass.initComponent.apply(this,arguments)}});IG$._Ic9=$s.extend($s.window,{modal:true,region:"center",layout:"fit",defaults:{bodyStyle:"padding:10px"},bodyPadding:4,closable:false,resizable:false,width:400,autoHeight:true,callback:null,_IG0:function(){this.close()},_IFf:function(){var e=this;if(e.callback){var d=[],b,f=this.down("[name=measureview]"),a=this.down("[name=clocation]"),c,g;for(b=0;b<f.store.data.items.length;b++){c=f.store.data.items[b];g={nodepath:c.get("nodepath"),formula:c.get("formula"),type:c.get("type"),name:c.get("name"),uid:c.get("uid"),datatype:c.get("datatype"),measurename:c.get("measurename"),ctype:c.get("ctype"),clocation:c.get("clocation")};d.push(g)}e.callback.execute({items:d,clocation:a.getValue(),dialog:e,vmode:e.vmode,tmpl:e.tmpl})}e._IG0()},initComponent:function(){this.title=IRm$.r1("T_M_MEASURE");$s.apply(this,{items:[{xtype:"fieldset",title:"MultiMeasure",layout:"anchor",bodyPadding:4,defaults:{anchor:"100%"},items:[{xtype:"textfield",fieldLabel:"Location",hidden:this.vmode==1,name:"clocation"},{xtype:"fieldcontainer",layout:"hbox",fieldLabel:"Measure Name",items:[{xtype:"textfield",name:"t_format",value:"[field]"},{xtype:"button",text:"Apply",handler:function(){var c,d=this,e=d.down("[name=measureview]"),g,a=d.down("[name=t_format]").getValue(),b=e.getSelectionModel().selected,f,k=a?a.indexOf("[field]"):-1;if(k>-1){for(c=0;c<b.length;c++){g=b.items[c];f=g.get("name");f=a.substring(0,k)+f+a.substring(k+"[field]".length);g.set("measurename",f)}}},scope:this}]},{xtype:"gridpanel",name:"measureview",collapsible:false,stateful:true,columnLines:true,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell"},store:{fields:["name","uid","nodepath","type","datatype","measurename","formula","ctype","clocation"]},flex:2,height:300,initialized:false,layout:"fit",plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{xtype:"gridcolumn",text:"Measure name",dataIndex:"measurename",flex:3,editor:{allowBlank:false}},{xtype:"gridcolumn",text:"Fact name",dataIndex:"name",flex:3,editor:{allowBlank:false}},{xtype:"gridcolumn",width:120,text:"Measure Type",dataIndex:"formula",editor:{xtype:"combobox",queryMode:"local",displayField:"name",valueField:"value",editable:false,autoSelect:true,triggerAction:"all",selectOnTab:true,store:{xtype:"store",fields:["name","value"],data:[{name:"Distinct Count",value:"COUNT DISTINCT"},{name:"Count",value:"COUNT"},{name:"Sum",value:"SUM"},{name:"Average",value:"AVG"},{name:"Max",value:"MAX"},{name:"Min",value:"MIN"},{name:"Template",value:"TMPL"}]},lazyRender:true,listClass:"x-combo-list-small"}}],viewConfig:{stripeRows:true},fbar:[{xtype:"toolbar",items:[{xtype:"button",text:"Remove Selected",handler:function(){var c=this,e=c.down("[name=measureview]"),a=e.store,d=e.getSelectionModel().selected,b;for(b=d.length-1;b>=0;b--){a.remove(d.items[b])}},scope:this},"->",{xtype:"button",text:"Template",handler:function(){var c=this,e=new IG$._Ie1({dmode:1,cubeuid:c.pcube.uid,clItem:c.tmpl||new IG$.c$s18(),callback:new IG$._I3d(c,function(l){c.tmpl=l?l.citem:null;var f,k=c.down("[name=measureview]"),g=k.getSelectionModel().selected;for(f=0;f<g.length;f++){g.items[f].set("formula","TMPL")}})}),a=c.pcube,d=a?a.customstyle:null,b;e.clItem.cubeinfo.styles=[];if(d){for(b=0;b<d.length;b++){e.clItem.cubeinfo.styles.push(d[b])}}e.clItem.expressiontype=e.clItem.expressiontype||"SUM([field])";e.clItem.expression=e.clItem.expression||"SUM([field])";e.show()},scope:this}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._IFf()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(){var b=this.down("[name=measureview]"),a=this.down("[name=clocation]");a.setValue(this.mfolder==null?"{parent}/measures":this.mfolder);if(this.metaitems){b.store.loadData(this.metaitems)}}}});IG$._Ic9.superclass.initComponent.apply(this,arguments)}});IG$._Ibe=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:false,resizable:false,width:700,autoHeight:true,autoScroll:true,callback:null,_ILa:null,_ILb:null,uid:null,_IJa:null,_IG0:function(){this.close()},updateChanges:function(){var c=this.down("[name=ctrlpool]"),a,b=this.down("[name=columngrid]"),e,d;this._ILb.sqloption.dbpool=c.getValue();c=this.down("[name=sqlquery]");this._ILb.sqloption.sql=c.getValue();this._ILb.sqloption.sqlquery=this._ILb.sqloption.sql;this._ILb.sqloption.columns=[];for(a=0;a<b.store.data.items.length;a++){e=b.store.data.items[a];d=e.data;d.dataoption={};d.dataoption.data=e.get("dataoption_data");d.dataoption.datadelimiter=e.get("dataoption_datadelimiter");d.dataoption.coldelimiter=e.get("dataoption_coldelimiter");d.dataoption.valuetype=e.get("dataoption_valuetype");this._ILb.sqloption.columns.push(d)}},confirmDialig:function(){this.updateChanges();this.callback&&this.callback.execute();this.close()},sK3:function(){var e=this,b=this,d=new IG$._I3e(),a,g,f,c;if(!this._ILb.sqloption){this._ILb.sqloption={}}this.down("[name=sqlquery]").setValue(this._ILb.sqloption.sql||this._ILb.sqloption.sqlquery||"");d.init(b,{ack:"25",payload:IG$._I2d({address:""},"address"),mbody:IG$._I2e()},b,b.rs_sK3,null);d._l()},rs_sK3:function(a){var c,k=IG$._I18(a,"/smsg/item"),g=IG$._I26(k),d=this.down("[name=ctrlpool]"),f=this.down("[name=ctrlquerytype]"),b=[],e;for(c=0;c<g.length;c++){e=IG$._I1c(g[c]);e.select=(this._ILb.sqloption.dbpool==e.name)?true:false;if(e.name!="MECBASE"){b.push(e)}}d.store.loadData(b);d.setValue(this._ILb.sqloption.dbpool);f.setValue("stmt")},sK4:function(){var f=this,a=this,e=new IG$._I3e(),c=a.down("[name=promptgrid]"),d,b;this.updateChanges();d="<smsg><ExecuteSQL dbpool='"+a.down("[name=ctrlpool]").getValue()+"' method='"+a.down("[name=ctrlquerytype]").getValue()+"'>";d+="<SQL><![CDATA["+a.down("[name=sqlquery]").getValue()+"]]></SQL>";d+="<prompts>";d+="</prompts>";d+="</ExecuteSQL></smsg>";a.setLoading(true);e.init(a,{ack:"18",payload:IG$._I2d({uid:this.uid,option:"sqlcubedata"},"uid;option;active"),mbody:d},a,a.rs_sK4,null);e._l()},rs_sK4:function(q){var u=this,p,e=IG$._I18(q,"/smsg/columns"),s=e?IG$._I26(e):null,b=IG$._I18(q,"/smsg/result"),k=[],d,a=[],l=[],v=[],f,m,w=this.down("[name=columngrid]"),c,t,o;u.setLoading(false);if(s){for(p=0;p<s.length;p++){d=IG$._I1c(s[p]);k.push(d);l.push("c"+p);a.push({xtype:"gridcolumn",flex:1,text:d.fieldname,minWidth:120,dataIndex:"c"+p})}if(b){t=IG$._I1b(b,"delimiter");m=IG$._I24(b);m=m.split(t);f={};for(p=0;p<m.length;p++){o=p%k.length;if(p>0&&o==0){v.push(f);f={};if(v.length>100){break}}f["c"+o]=m[p]}}}var g=Ext.create("Ext.data.ArrayStore",{fields:l});w.reconfigure(g,a);w.store.loadData(v)},sK5:function(a){switch(a){case"cmd_getmeta":this.sK4();break}},initComponent:function(){var a=this,c=$(document);a.maxHeight=c.height()-20;a.title=IRm$.r1("I_SQLCUBE");a.title=IRm$.r1("I_QRY_TOOL");var b={xtype:"panel",layout:{type:"vbox",align:"stretch"},padding:5,tbar:[{xtype:"combobox",name:"ctrlpool",queryMode:"local",displayField:"disp",valueField:"name",fieldLabel:"Database Source",editable:false,autoSelect:true,store:{fields:["name","disp"]}},{xtype:"combobox",name:"ctrlquerytype",queryMode:"local",displayField:"disp",valueField:"name",fieldLabel:"Query Type",editable:false,autoSelect:true,store:{fields:["name","disp"],data:[{disp:"Statement",name:"stmt",selected:1},{disp:"PreparedStatement",name:"pstmt"}]}}],items:[{xtype:"textarea",name:"sqlquery",fieldLabel:"SQL Query",height:160},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:IRm$.r1("L_RUN_REPORT"),width:120,handler:function(){this.sK5("cmd_getmeta")},scope:this},{xtype:"fieldcontainer",width:10},{xtype:"displayfield",value:" Click button to get result",flex:1}]},{xtype:"grid",title:"Data Results",name:"columngrid",height:250,stateful:true,columnLines:true,store:{xtype:"store",fields:["name","fieldname","type","datatype","tablename","dataoption_data","dataoption_valuetype","dataoption_datadelimiter","dataoption_coldelimiter","uid","mapto"]},initialized:false,layout:"fit",columns:[]}]};Ext.apply(this,{defaults:{bodyStyle:"padding:0px"},autoScroll:true,items:[b],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this.confirmDialig()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(d){this.sK3()}}});IG$._Ibe.superclass.initComponent.apply(this,arguments)}});IG$._Ib2=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:false,resizable:true,width:600,autoHeight:true,callback:null,defaults:{bodyStyle:"padding:0px"},autoScroll:true,L1:function(){var b=this,a=b.fitem;if(a){b.fitem.dataoption={};b.fitem.dataoption.data=b.down("[name=sql]").getValue();b.fitem.dataoption.valuetype=b.down("[name=valuetype]").getValue();b.fitem.dataoption.datadelimiter=b.down("[name=datadelimiter]").getValue();b.fitem.dataoption.coldelimiter=b.down("[name=coldelimiter]").getValue()}if(b.callback){b.callback.execute(b.fitem)}b.close()},L2:function(){var b=this,a=b.fitem;if(a){a.dataoption=a.dataoption||{};b.down("[name=valuetype]").setValue(a.dataoption.valuetype||"");b.down("[name=datadelimiter]").setValue(a.dataoption.datadelimiter||"");b.down("[name=coldelimiter]").setValue(a.dataoption.coldelimiter||"");b.down("[name=sql]").setValue(a.dataoption.data||"")}},initComponent:function(){var a=this;a.title=IRm$.r1("I_SQLCUBE");a.items=[{xtype:"panel",layout:"fit",border:0,items:[{xtype:"form",layout:"anchor",padding:10,border:0,defaults:{anchor:"100%"},items:[{xtype:"displayfield",value:"Edit column for ("+a.fitem.name+")"},{xtype:"combobox",name:"valuetype",fieldLabel:"Value type",editable:false,queryMode:"local",labelField:"label",valueField:"value",displayField:"label",store:{xtype:"store",fields:["label","value"],data:[{label:"SQL Query",value:"sql"},{label:"List data",value:"listdata"}]}},{xtype:"combobox",name:"datadelimiter",fieldLabel:"Delimiter",editable:false,queryMode:"local",labelField:"label",valueField:"value",displayField:"label",store:{xtype:"store",fields:["label","value"],data:[{label:"newline",value:"newline"},{label:"comma",value:"comma"},{label:"tab",value:"tab"}]}},{xtype:"combobox",name:"coldelimiter",fieldLabel:"Column Delimiter",editable:false,queryMode:"local",labelField:"label",valueField:"value",displayField:"label",store:{xtype:"store",fields:["label","value"],data:[{label:"No value field",value:""},{label:"newline",value:"newline"},{label:"comma",value:"comma"},{label:"tab",value:"tab"}]}},{xtype:"textarea",name:"sql",height:150,fieldLabel:"Value data"}]}]}];a.buttons=["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this.L1()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}];a.listeners={afterrender:function(b){b.L2()}};IG$._Ib2.superclass.initComponent.apply(this,arguments)}});IG$._Ib3=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:false,resizable:true,width:600,autoHeight:true,callback:null,L1:function(){var a=this;a.prompt.defaultvalue=a.down("[name=defaultvalue]").getValue();a.prompt.datatype=a.down("[name=datatype]").getValue();a.prompt.type=a.down("[name=prompttype]").getValue();a.prompt.allownullvalue=a.down("[name=allownullvalue]").getValue()?"T":"F";a.prompt.sql=a.down("[name=sql]").getValue();a.prompt.valuetype=a.down("[name=valuetype]").getValue();a.prompt.datadelimiter=a.down("[name=datadelimiter]").getValue();a.prompt.coldelimiter=a.down("[name=coldelimiter]").getValue();a.prompt.L2.call(a.prompt);a.record.set("defaultvalue",a.prompt.defaultvalue);a.record.set("datatype",a.prompt.datatype);a.record.set("type",a.prompt.type);a.record.set("allownullvalue",a.prompt.allownullvalue);a.record.set("valuetype",a.prompt.valuetype);a.record.set("datadelimiter",a.prompt.datadelimiter);a.record.set("coldelimiter",a.prompt.coldelimiter);a.close()},L2:function(){var a=this;if(a.prompt){a.down("[name=defaultvalue]").setValue(a.prompt.defaultvalue||"");a.down("[name=datatype]").setValue(a.prompt.datatype||"string");a.down("[name=prompttype]").setValue(a.prompt.type||"textinput");a.down("[name=valuetype]").setValue(a.prompt.valuetype||"listdata");a.down("[name=datadelimiter]").setValue(a.prompt.datadelimiter||"newline");a.down("[name=allownullvalue]").setValue(a.prompt.allownullvalue=="T"?true:false);a.down("[name=sql]").setValue(a.prompt.sql||"")}},initComponent:function(){var a=this;a.title=IRm$.r1("I_SQLCUBE");$s.apply(this,{defaults:{bodyStyle:"padding:0px"},autoScroll:true,items:[{xtype:"panel",border:0,layout:"fit",items:[{xtype:"form",layout:"anchor",padding:10,plain:true,border:0,defaults:{anchor:"100%"},items:[{xtype:"displayfield",value:"Edit prompt for ("+a.prompt.name+")"},{xtype:"textfield",name:"defaultvalue",fieldLabel:"Default value"},{xtype:"combobox",name:"datatype",fieldLabel:"Data type",editable:false,queryMode:"local",labelField:"label",valueField:"value",displayField:"label",store:{xtype:"store",fields:["label","value"],data:[{label:"Numeric",value:"numeric"},{label:"string",value:"string"}]}},{xtype:"combobox",name:"prompttype",fieldLabel:"Prompt type",editable:false,queryMode:"local",labelField:"label",valueField:"value",displayField:"label",store:{xtype:"store",fields:["label","value"],data:[{label:"Textinput",value:"textinput"},{label:"Selection",value:"selection"},{label:"Combobox",value:"combobox"}]}},{xtype:"combobox",name:"valuetype",fieldLabel:"Value type",editable:false,queryMode:"local",labelField:"label",valueField:"value",displayField:"label",store:{xtype:"store",fields:["label","value"],data:[{label:"SQL Query",value:"sql"},{label:"List data",value:"listdata"}]}},{xtype:"combobox",name:"datadelimiter",fieldLabel:"Delimiter",editable:false,queryMode:"local",labelField:"label",valueField:"value",displayField:"label",store:{xtype:"store",fields:["label","value"],data:[{label:"newline",value:"newline"},{label:"comma",value:"comma"},{label:"tab",value:"tab"}]}},{xtype:"checkbox",name:"allownullvalue",fieldLabel:"Allow null"},{xtype:"textarea",name:"sql",height:150,fieldLabel:"Value data"}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this.L1()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(b){b.L2()}}});IG$._Ib3.superclass.initComponent.apply(this,arguments)}});IG$._g5=$s.extend($s.window,{modal:true,region:"center",xtype:"window",layout:"fit",closable:false,resizable:true,width:520,height:400,_c1:function(){var b=this,a,d=b.down("[name=feditor]"),e,c;for(a=0;a<d.store.data.items.length;a++){e=d.store.data.items[a];c=e.get("rownum");b.fields[c].col=e.get("col");b.fields[c].syntax=e.get("syntax");b.fields[c].alias=e.get("alias");b.fields[c].seq=e.get("seq")}b.callback&&b.callback.execute();b.close()},_c2:function(){var b=this,c=b.down("[name=feditor]"),a;if(b.fields){for(a=0;a<b.fields.length;a++){b.fields[a].rownum=a}c.store.loadData(b.fields)}},initComponent:function(){var a=this;a.title=IRm$.r1("I_SQLCUBE_CW");$s.apply(this,{items:[{xtype:"panel",bodyPadding:5,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:IRm$.r1("I_SQLCUBE_CMSG")},{xtype:"gridpanel",name:"feditor",flex:1,store:{xtype:"store",fields:["row","col","seq","syntax","alias","rownum"]},plugins:[{ptype:"cellediting",clicksToEdit:1}],selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell",mode:"MULTI"},tbar:[{xtype:"button",text:"Remove Selected",handler:function(){var c=this,f=c.down("[name=feditor]"),e=f.getSelectionModel().selected,b,g,d;for(b=e.length-1;b>=0;b--){g=e.items[b];d=g.get("rownum");c.fields[d].removed=true;f.store.remove(g)}},scope:this}],columns:[{text:"Row",dataIndex:"row",width:80},{text:"Type",dataIndex:"col",width:100,editor:{xtype:"combobox",queryMode:"local",displayField:"name",valueField:"value",allowBlank:false,editable:false,autoSelect:true,selectOnTab:true,triggerAction:"all",store:{xtype:"store",fields:["name","value"],data:[{name:"Column",value:"@COL"},{name:"Aggregated",value:"@AGG"}]},lazyRender:true}},{text:"Block No",dataIndex:"seq",editor:{xtype:"numberfield",minValue:0,maxValue:10,allowBlank:false}},{text:"Syntax",dataIndex:"syntax",minWidth:120,editor:{allowBlank:false}},{text:"Alias",dataIndex:"alias",minWidth:120,editor:{allowBlank:false}}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){var b=this;b._c1()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]});IG$._g5.superclass.initComponent.apply(this,arguments)},listeners:{afterrender:function(a){this._c2()}}});IG$._Ib1=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:false,resizable:true,width:650,height:500,autoScroll:false,callback:null,_ILa:null,_ILb:null,uid:null,_IJa:null,defaults:{bodyStyle:"padding:0px"},bodyPadding:0,plain:true,_IG0:function(){this.close()},updateChanges:function(){var k=this,a=k.down("[name=ctrlpool]"),e,m=k.down("[name=columngrid]"),n=k.down("[name=promptgrid]"),l=k.promptmap,f=k.down("[name=viewname]"),d,b,c,g={};k._ILb.sqloption.dbpool=a.getValue();a=k.down("[name=sqlquery]");k._ILb.sqloption.sql=a.getValue();k._ILb.sqloption.sqlquery=k._ILb.sqloption.sql;k._ILb.viewname=f.getValue();if(k.wmode=="inlineview"&&!k._ILb.viewname){IG$._I54(ig$.appname,"Check view name to continue!",null,null,1,"alert");return false}k._ILb.sqloption.columns=[];if(k.columns){for(e=0;e<k.columns.length;e++){g[k.columns[e].name]=k.columns[e]}}for(e=0;e<m.store.data.items.length;e++){d=m.store.data.items[e];b=d.data;if(b.mapto=="-"&&b.uid){b.uid=null}else{if(b.mapto&&g[b.mapto]){b.uid=g[b.mapto].uid}}b.dataoption={};b.dataoption.data=d.get("dataoption_data");b.dataoption.datadelimiter=d.get("dataoption_datadelimiter");b.dataoption.coldelimiter=d.get("dataoption_coldelimiter");b.dataoption.valuetype=d.get("dataoption_valuetype");k._ILb.sqloption.columns.push(b)}k._ILb.sqloption.prompts=[];for(e=0;e<n.store.data.items.length;e++){c=n.store.data.items[e].get("name");if(l[c]){k._ILb.sqloption.prompts.push(l[c])}}return true},_c:function(){this._m2("c_getcols",1)},_m3:function(){var k=this,a=k,m=new IG$._I3e(),o=k.down("[name=columngrid]"),p=k.down("[name=promptgrid]"),l,f,e,b=[],d,n=[],g=[],c;e=k.columnmap={};l=k.promptmap={};if(a.columns){b.push({fieldname:"",name:"-",uid:""});for(d=0;d<a.columns.length;d++){b.push(a.columns[d])}a.maptocombo.store.loadData(b)}if(!k._ILb.sqloption){k._ILb.sqloption={}}k.down("[name=viewname]").setValue(k._ILb.viewname||"");k.down("[name=sqlquery]").setValue(k._ILb.sqloption.sql||k._ILb.sqloption.sqlquery||"");if(k._ILb.sqloption.columns){for(d=0;d<k._ILb.sqloption.columns.length;d++){c={};f=k._ILb.sqloption.columns[d];k._ILb.sqloption.columns[d].type=k._ILb.sqloption.columns[d].type||k._ILb.sqloption.columns[d].itemtype;IG$._I1d(f,c,"uid;fieldname;sqlfield;name;type;datatype;size;tablename;alias");c.dataoption_data=(f.dataoption?f.dataoption.data:"");c.dataoption_valuetype=(f.dataoption?f.dataoption.valuetype:"");c.dataoption_datadelimiter=(f.dataoption?f.dataoption.datadelimiter:"");c.dataoption_coldelimiter=(f.dataoption?f.dataoption.coldelimiter:"");e[c.name]=c;n.push(c)}o.store.loadData(n)}if(k._ILb.sqloption.prompts){for(d=0;d<k._ILb.sqloption.prompts.length;d++){var c={};IG$._I1d(k._ILb.sqloption.prompts[d],c,"name;type;datatype;defaultvalue;allownullvalue;datadelimiter;coldelimiter;valuetype");l[c.name]=k._ILb.sqloption.prompts[d];g.push(c)}p.store.loadData(g)}m.init(a,{ack:"25",payload:IG$._I2d({address:""},"address"),mbody:IG$._I2e()},a,a.rs__m3,null);m._l()},rs__m3:function(a){var f=this,c,k=IG$._I18(a,"/smsg/item"),g=IG$._I26(k),d=f.down("[name=ctrlpool]"),b=[],e;for(c=0;c<g.length;c++){e=IG$._I1c(g[c]);e.select=(f._ILb.sqloption.dbpool==e.name)?true:false;if(e.name!="IGCBASE"){b.push(e)}}d.store.loadData(b);d.setValue(f._ILb.sqloption.dbpool)},_g0:function(a,b){var e=[],d,c;for(c=0;c<a.length;c++){if(b&&a[c]==b){if(d){d.t=a[c];e.push(d);d=null}}else{if(!b&&(a[c]=="\n"||a[c]==" ")){if(d){d.t=a[c];e.push(d);d=null}}else{d=d||{s:"",t:null};d.s+=a[c]}}}if(d){d.t=d.t||"";e.push(d)}return e},_g1:function(){var n=this,k=n.down("[name=sqlquery]"),e=k.getValue(),p=[],b,m=[],s=false,g=0,f,d,v,u,t=0,o=-1,a,q=-1,c=-1;if(e){e=n._g0(e);while(g<e.length){u=e[g].s.toUpperCase();if(u.substring(0,4)=="@COL"||u.substring(0,4)=="@AGG"){s=true;IG$._I54(ig$.appname,IRm$.r1("E_SQL_P1"),null,null,1,"error");break}switch(u){case"SELECT":p.push(e[g]);q=g+1;break;case"FROM":c=g-1;if(q>-1){a=n._g2(t,e,p,q,c,m);if(a==false){s==true;for(f=q;f<c;f++){p.push(e[g])}}else{p.push({s:"\n\t{COLUMNS,"+t+"}",t:"\n"});o=t;t++}}c=-1;q=-1;p.push(e[g]);break;case"GROUP":if(e[g+1]&&e[g+1].s.toUpperCase()=="BY"&&o>-1){p.push({s:"\n\t{GROUPBY_COLUMNS,"+o+"}",t:"\n"});g++}break;default:if(q==-1){p.push(e[g])}break}g++}}else{s=true}if(s==false){b="";for(g=0;g<m.length;g++){b+=m[g]+"\n"}b+="\n";b+=n._g3(p);k.setValue(b)}},_g2:function(n,b,k,e,m,p){var x=this,s,q,u="",w="@^",a,d=[],g,o=false,v,t,l=true;for(s=e;s<m+1;s++){q=b[s];u+=q.s+q.t}a=u.split(",");for(s=0;s<a.length;s++){if(a[s].indexOf("(")>-1&&a[s].indexOf(")")>-1){d.push(a[s]);o=false}else{if(a[s].indexOf("(")>-1){o=true;d.push(a[s])}else{if(a[s].indexOf(")")>-1){d[d.length-1]=d[d.length-1]+a[s]}else{if(o){d[d.length-1]=d[d.length-1]+a[s]}else{d.push(a[s])}}}}}for(s=0;s<d.length;s++){t=x._g5(d[s],s);g=t.aggregate?"AGG":"COL";v="@"+g+w+n;v+=w+t.field+w+t.alias;p.push(v)}return l},_g3:function(a){var c=[],b;for(b=0;b<a.length;b++){c.push(a[b].s+a[b].t)}return c.join("")},_g4:function(){var l=this,e=l.down("[name=sqlquery]"),c=e.getValue(),g=[],k,d=0,a="@^",b,p,o,m;if(c){c=l._g0(c,"\n");while(d<c.length){p=c[d].s.toUpperCase();if(p.substring(0,4)=="@COL"||p.substring(0,4)=="@AGG"){o=c[d];o.row=d;o.cols=c[d].s.split(a);g.push({row:d,col:o.cols[0],seq:o.cols[1],syntax:o.cols[2],alias:o.cols[3]})}d++}if(g.length>0){m=new IG$._g5({fields:g,callback:new IG$._I3d(l,function(){var f,n,q;for(f=0;f<g.length;f++){n=g[f];c[n.row].s=n.col+a+n.seq+a+n.syntax+a+n.alias}for(f=g.length-1;f>=0;f--){n=g[f];if(n.removed){c.splice(n.row,1)}}q=this._g3(c);e.setValue(q)})});IG$._I_5(this,m)}else{IG$._I54(ig$.appname,IRm$.r1("E_SQL_P0"),null,null,1,"error")}}},_g5:function(g,b){g=g.split("\n").join("");g=IG$.trim12(g);var a=g.toUpperCase(),e={aggregate:false,field:null,alias:null},d,k,c;if(/(SUM|MIN|MAX|AVG)/.test(a)){e.aggregate=true}k=a.indexOf(" AS ");if(k<0&&a.lastIndexOf(" ")>-1){d=[];d.push(a.substring(0,a.lastIndexOf(" ")));d.push(a.substring(a.lastIndexOf(" ")+1));d[0]=IG$.trim12(d[0]);d[1]=IG$.trim12(d[1]);if((d[1].indexOf(" ")==-1||(d[1].charAt(0)=="'"&&d[1].charAt(d[1].length-1)=="'"))){e.field=d[0];e.alias=d[1]}}if(!e.field){if(k>-1){e.field=g.substring(0,k);e.alias=g.substring(k+" AS ".length)}else{if(e.aggregate){e.field=g;e.alias="column_"+b}else{if(g.indexOf("(")<0&&g.indexOf(" ")<0){e.field=g;e.alias=g}else{e.field=g;e.alias="column_"+b}}}}e.field=IG$.trim12(e.field);e.alias=IG$.trim12(e.alias);return e},_m1:function(b){var k=this,a=k,g=new IG$._I3e(),d=a.down("[name=promptgrid]"),f,c,e;e=this.updateChanges();if(e==false){return}if(k.wmode=="sqlcube"||k.wmode=="inlineview"){f="<smsg><ExecuteSQL dbpool='"+a.down("[name=ctrlpool]").getValue()+"'>";f+="<SQL><![CDATA["+a.down("[name=sqlquery]").getValue()+"]]></SQL>";f+="<prompts>";for(c=0;c<k._ILb.sqloption.prompts.length;c++){f+=k._ILb.sqloption.prompts[c].L1()}f+="</prompts>";f+="</ExecuteSQL></smsg>";g.init(a,{ack:"18",payload:IG$._I2d({uid:this.uid,option:"sqlcubemeta"},"uid;option;active"),mbody:f},a,a.rs__m1,null,{bclose:b});g._l()}else{f=this._ILa._IJ1();g.init(a,{ack:"18",payload:IG$._I2d({uid:this.uid,option:"metainfo",active:this._IJa},"uid;option;active"),mbody:f},a,a.rs__m1,null,{bclose:b});g._l()}},rs__m1:function(s,a){var u=this,q,l=a?a.bclose:false,d=IG$._I18(s,"/smsg/columns"),t=d?IG$._I26(d):null,g=[],c,k=[],m,v=u.down("[name=columngrid]"),f=u.down("[name=promptgrid]"),e=u.promptmap,w=u.columnmap,n={},b;if(u.columns){for(q=0;q<u.columns.length;q++){n[u.columns[q].fieldname]=u.columns[q]}}if(t){for(q=0;q<t.length;q++){c=IG$._I1c(t[q]);c.fieldinfo=c.uid;c.uid=null;c.name=c.alias||c.fieldname;c.sqlfield=c.name;if(!c.name){c.name="column_"+(q+1)}b=c.fieldname;if(n[b]){c.mapto=n[b].name;c.uid=n[b].uid;c.name=n[b].name}c.type="Metric";if(w&&w[c.name]){c.dataoption_data=w[c.name].dataoption_data;c.dataoption_datadelimiter=w[c.name].dataoption_datadelimiter;c.dataoption_coldelimiter=w[c.name].dataoption_coldelimiter;c.dataoption_valuetype=w[c.name].dataoption_valuetype}g.push(c)}}v.store.loadData(g);d=IG$._I18(s,"/smsg/prompts");t=(d?IG$._I26(d):null);if(t){for(q=0;q<t.length;q++){m=IG$._I1c(t[q]);if(!e[m.name]){var o=new IG$._Ib4(null);o.name=m.name;e[o.name]=o;k.push(m)}else{var o=e[m.name];k.push({name:o.name,datatype:o.datatype,type:o.type,allownullvalue:o.allownullvalue,defaultvalue:o.defaultvalue,datadelimiter:o.datadelimiter,coldelimiter:o.coldelimiter,valuetype:o.valuetype})}}}f.store.loadData(k);if(l){u.callback&&u.callback.execute(u);u.close()}else{u.m8(1)}},_m2:function(c,a){var b=this;switch(c){case"c_getcols":b._m1(a);break;case"cmd_field":b._g1();break;case"cmd_col_editor":b._g4();break}},m1$20:function(b){var c=b.get("name"),a=this.promptmap,d;if(a[c]){d=new IG$._Ib3({prompt:a[c],record:b});IG$._I_5(this,d)}},_i2:function(a){var b=a.get("name");dlg=new IG$._Ib2({record:a});IG$._I_5(this,dlg)},m8:function(b){var c=this,d=c.down("[name=mainpanel]"),a=d.getLayout();a.setActiveItem(b)},initComponent:function(){var a=this,c=$(document);a.height=Math.min(a.height,c.height()-20);a.title=IRm$.r1("I_SQLCUBE");var b={xtype:"combobox",name:"maptocombo",queryMode:"local",displayField:"name",labelField:"name",valueField:"name",editable:false,autoSelect:true,triggerAction:"all",selectOnTab:true,hidden:false,store:{xtype:"store",fields:["name","uid"],data:[]},lazyRender:true,listClass:"x-combo-list-small"},d=$s.create($s.combobox,b);a.maptocombo=d;$s.apply(this,{items:[{xtype:"panel",name:"mainpanel",layout:"card",flex:1,autoScroll:false,items:[{xtype:"panel",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",name:"ctrlpool",queryMode:"local",hidden:(this.wmode=="inlineview"?true:false),displayField:"disp",valueField:"name",fieldLabel:"Database Source",editable:false,autoSelect:true,store:{fields:["name","disp"]}},{xtype:"textfield",fieldLabel:"View name",name:"viewname",hidden:(this.wmode=="inlineview"?false:true)},{xtype:"textarea",name:"sqlquery",fieldLabel:"SQL Query",height:340},{xtype:"fieldcontainer",fieldLabel:"Query Tools",layout:{type:"hbox"},hidden:(this.wmode=="inlineview"?true:false),items:[{xtype:"button",text:"Field Extract",handler:function(){this._m2("cmd_field")},scope:this},{xtype:"container",width:5},{xtype:"button",text:"Column Editor",handler:function(){this._m2("cmd_col_editor")},scope:this}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:IRm$.r1("L_RUN_REPORT"),width:120,handler:function(){this._m2("c_getcols")},scope:this},{xtype:"fieldcontainer",width:10},{xtype:"displayfield",value:" Click button to query database or skip to view column."},{xtype:"fieldcontainer",width:60},{xtype:"button",text:"View Column Mapping",handler:function(){this.m8(1)},scope:this}]}]},{xtype:"panel",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"grid",name:"columngrid",columnLines:true,flex:1,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell"},store:{xtype:"store",fields:["name","fieldname","sqlfield","type","datatype","tablename","dataoption_data","dataoption_valuetype","dataoption_datadelimiter","dataoption_coldelimiter","uid","mapto","alias"]},initialized:false,layout:"fit",plugins:[{ptype:"cellediting",clicksToEdit:1}],viewConfig:{plugins:[{ptype:"gridviewdragdrop",dragText:"Drag and drop to filter area",enableDrop:false,enableDrag:true,ddGroup:"_I$RD_G_"}]},columns:[{text:"Metric Name",dataIndex:"name",flex:1,editor:{allowBlank:false}},{text:"Column Name",dataIndex:"fieldname",flex:1,editor:{allowBlank:false}},{text:"Alias Name",dataIndex:"alias",flex:1,editor:{allowBlank:false}},{text:"Data Type",dataIndex:"datatype",width:60},{text:"Map to",dataIndex:"mapto",editor:d,hidden:(this.wmode!="sqlcube")},{text:"UID",dataIndex:"uid",hidden:true},{xtype:"actioncolumn",width:40,items:[{iconCls:"icon-grid-config",tooltip:IRm$.r1("L_EDIT"),handler:function(k,m,g){var e=this.down("[name=columngrid]"),f=e.store,l=f.getAt(m);this._i2(l)},scope:this}]}]},{xtype:"grid",title:"Prompts",name:"promptgrid",stateful:true,columnLines:true,hidden:true,selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell"},store:{xtype:"store",fields:["name","defaultvalue","type","datatype","allownullvalue","valuetype","datadelimiter","coldelimiter"]},initialized:false,layout:"fit",plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{text:"Name",dataIndex:"name",flex:1,editor:{allowBlank:false}},{text:"Default value",dataIndex:"defaultvalue",flex:1},{text:"Data Type",dataIndex:"datatype",width:60},{text:"Value Type",dataIndex:"type",width:60},{xtype:"actioncolumn",width:50,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(k,m,f){var e=this.down("[name=promptgrid]"),l=e.store.getAt(m),g=l.get("name");if(this.promptmap[g]){delete this.promptmap[g]}e.store.removeAt(m)},scope:this},{iconCls:"icon-grid-config",tooltip:IRm$.r1("L_EDIT"),handler:function(k,m,g){var e=this.down("[name=promptgrid]"),f=e.store,l=f.getAt(m);this.m1$20(l)},scope:this}]}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"displayfield",value:" Click button to view query"},{xtype:"fieldcontainer",width:250},{xtype:"button",text:"View SQL Query",handler:function(){this.m8(0)},scope:this}]}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._c()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(e){this._m3()}}});IG$._Ib1.superclass.initComponent.apply(this,arguments)}});IG$._Id5=$s.extend($s.window,{modal:false,layout:"fit",resizable:false,isWindow:true,closeAction:"destroy",width:500,autoHeight:true,callback:null,_IG0:function(){this.close()},_IFf:function(){this.sK6()},_IFd:function(){var a=this,b=new IG$._I3e();b.init(a,{ack:"5",payload:IG$._I2d({uid:this.uid}),mbody:IG$._I2e({option:"diagnostics"})},a,a.rs_sK5,null);b._l()},rs_sK5:function(a){var e=IG$._I18(a,"/smsg/item"),d=this,g=IG$._I18(a,"/smsg/item/objinfo"),f,c,b;b=d.iteminfo={objectinfo:{},measureitems:[]};if(g){b.objectinfo=IG$._I1c(g)}g=IG$._I18(a,"/smsg/item/MeasureItems");f=IG$._I26(g);for(c=0;c<f.length;c++){b.measureitems.push(IG$._I1c(f[c]))}d.down("[name=dimension_name]").setValue(b.objectinfo.dimension_name||"");d.down("[name=measure_name]").setValue(b.objectinfo.measure_name||"");d.down("[name=measureitems]").store.loadData(b.measureitems)},sK6:function(){var f=this,b,d=this,k,e,a=f.down("[name=measureitems]"),l,c;k="<smsg><item><objinfo "+IG$._I20(f.iteminfo.objectinfo,"dimension_uid;measure_uid;cubeuid","s")+"/>";k+="<MeasureItems>";for(e=0;e<a.store.data.items.length;e++){c=a.store.data.items[e];l={uid:c.get("uid"),nodepath:c.get("nodepath"),name:c.get("name"),type:c.get("type")};k+="<Measure "+IG$._I20(l,"name;uid;nodepath;type","s")+"/>"}k+="</MeasureItems>";k+="</item></smsg>";var g=new IG$._I3e();g.init(d,{ack:"31",payload:IG$._I2d({uid:this.uid}),mbody:k},d,d.rs_sK6,null,null);g._l()},rs_sK6:function(a){this.callback&&this.callback.execute();this.close()},P2C:function(b){var a=this,c=a.down("[name=measureitems]");c.store.add(b)},initComponent:function(){var a=this;a.title=IRm$.r1("L_GROUP_MEASURE");$s.apply(this,{defaults:{bodyStyle:"padding:5px"},items:[{xtype:"form",layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"textfield",fieldLabel:"Name Dimension",name:"dimension_name"},{xtype:"textfield",fieldLabel:"Gropu Measure",name:"measure_name"},{xtype:"gridpanel",name:"measureitems",height:300,store:{xtype:"store",fields:["uid","nodepath","name","type"]},selType:"checkboxmodel",selModel:{checkSelector:".x-grid-cell"},columns:[{xtype:"gridcolumn",text:"Name",dataIndex:"name",flex:1},{xtype:"gridcolumn",text:"Location",dataIndex:"nodepath",flex:1}],tbar:[{xtype:"button",text:"Add Measure",handler:function(){var b=new IG$._I96({visibleItems:"workspace;folder;measure",u5x:{cubebrowse:true,rootuid:a.iteminfo.objectinfo.cubeuid}});b.callback=new IG$._I3d(this,this.P2C);IG$._I_5(this,b)},scope:this},{xtype:"button",text:"Delete Selected",handler:function(){var c=this,b,e=c.down("[name=measureitems]"),d=e.getSelectionModel().getSelection();for(b=d.length-1;b>=0;b--){e.store.remove(d[b])}},scope:this}]}]}],buttons:["->",{text:IRm$.r1("B_CONFIRM"),handler:function(){this._IFf()},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this._IG0()},scope:this}],listeners:{afterrender:function(b){this._IFd()}}});IG$._Id5.superclass.initComponent.apply(this,arguments)}});IG$.A$Navi=function(){IG$.A$Navi.superclass.constructor.call(this,{region:"west",split:true,header:false,width:200,minSize:175,maxSize:400,collapsible:true,margins:"0 0 5 5",cmargins:"0 0 0 0",rootVisible:true,lines:false,autoScroll:true,animCollapse:false,animate:true,collapseMode:"mini",store:new IG$.blM({cubeuid:null,cubeaddress:null,cubebrowse:true}),root:{id:"root",text:"Root",address:"/",type:"root"},collapseFirst:false,listeners:{itemclick:function(n,g,p,k,l){var f;var m;var c;var o;var d=g.data;if(g.isLeaf()==false){f="mcube";m="";c=this.cubeaddress;o=this.cubeuid}else{f=d.type.toLowerCase();m=d.name;c=d.nodepath;o=d.uid}if(g.isLeaf()){this.editMetaObject.call(this,o,m,c,f)}var b=this.customMenu;b.removeAll();var a=this;switch(f){case"mcube":case"metrics":b.add({text:"Make item",menu:[{text:"Folder",handler:function(){a._I90.call(a,"Metrics",o,c,g)}},{text:"Dimension",handler:function(){a._I90.call(a,"Metric",o,c,g)}},{text:"Measure",handler:function(){a._I90.call(a,"Measure",o,c,g)}}],scope:this});if(f!="mcube"){b.add({text:"Remove"+m,handler:function(){a.removeMetaObject.call(a,o)}})}break;case"report":b.add({text:"test"});break;case"metric":b.add({text:"Edit metric "+m,handler:function(){a.editMetaObject.call(a,o,m,c,f)}});break;case"measure":b.add({text:"Edit measure "+m,handler:function(){a.editMetaObject.call(a,o,m,c,f)}})}}}});this.getSelectionModel().on("beforeselect",function(b,a){return a.isLeaf()})};IG$.A$Navi=$s.extend($s.treepanel,{customMenu:null,_I90:function(c,d,b){var a=new IG$._I6e({parentnodepath:b,itemtype:objectype,parentuid:d,callback:new IG$._I3d(this,this.r_I90,node)});IG$._I_5(this,a)},r_I90:function(a){if(a){this.refreshNode(a)}},editMetaObject:function(b,e,d,c){switch(c){case"multimetric":var a=this.ownerCt;a.a$tab.m1$7.call(a.a$tab,b,c,e,d);break;case"multimeasure":var a=this.ownerCt;a.a$tab.m1$7.call(a.a$tab,b,c,e,d);break}},removeMetaObject:function(b){var a=this;a.setLoading(true,true);var c=new IG$._I3e();c.init(a,{ack:"7",payload:IG$._I2d({uid:b}),mbody:IG$._I2e()},a,a.rs_removeMetaObject,null);c._l()},rs_removeMetaObject:function(a){var b=XGetNode(a,"/smsg/item");panel.setLoading(false)},refreshNode:function(b){var a=b;if(b.isLeaf()==true){a=b.parentNode}while(a.firstChild){a.removeChild(a.firstChild)}a.expand(false)},initComponent:function(){this.hiddenPkgs=[];this.customMenu=new Ext.menu.Menu({items:[]});$s.apply(this,{tbar:[" ",{text:"Search",menu:{items:[new Ext.form.TextField({width:200,emptyText:"Search keyword",enableKeyEvents:true,listeners:{render:function(a){this.filter=new Ext.tree.TreeFilter(this,{clearBlank:true,autoClear:true})},keydown:{fn:this.filterTree,buffer:350,scope:this},scope:this}})," "," "]}},"-",{iconCls:"icon-refresh",tooltip:"Refresh",handler:function(){var a=this.getRootNode();while(a.firstChild){a.removeChild(a.firstChild)}this.store.load()},scope:this},"-",{text:"Menu",menu:this.customMenu}]});IG$.A$Navi.superclass.initComponent.call(this)},filterTree:function(a,d){var f=a.getValue();Ext.each(this.hiddenPkgs,function(e){e.ui.show()});if(!f){this.filter.clear();return}this.expandAll();var b=new RegExp("^"+Ext.escapeRe(f),"i");this.filter.filterBy(function(e){return !e.attributes.isClass||b.test(e.text)});this.hiddenPkgs=[];var c=this;this.root.cascade(function(e){if(e.ui.ctNode.offsetHeight<3){e.ui.hide();c.hiddenPkgs.push(e)}})}});IG$.A$TB=function(){IG$.A$TB.superclass.constructor.call(this,{region:"center",margins:"0 5 5 0",resizeTabs:true,minTabWidth:135,tabWidth:135,enableTabScroll:true,activeTab:0,requestCubeCommand:function(f){var a=this;var e="";var d="<smsg></smsg>";switch(f){case"CMD_BUILD_CUBE":e="BuildCube";break;case"CMD_IMPORT":var c=new IG$.MmD$m({cubeuid:a.uid});c.show();return;break}var b=new IG$._I3e();b.init(a,{ack:"17",payload:"<smsg><item cubeuid='"+a.uid+"' action=\""+e+'"/></smsg>',mbody:d},a,a.rs_requestCubeCommand,null);b._l()},rs_requestCubeCommand:function(a){var b=XGetNode(a,"/smsg/item");var c=IG$._I26(b)},items:{title:"About M-Cube",autoLoad:{url:"./html/mcube_intro.html",callback:this.initSearch,scope:this},iconCls:"icon-docs",autoScroll:true,tbar:[{iconCls:"icon-expand-all",tooltip:"Build Cube",handler:function(){this.requestCubeCommand.call(this,"CMD_BUILD_CUBE")},scope:this},{iconCls:"icon-expand-all",tooltip:"Import Data",handler:function(){this.requestCubeCommand.call(this,"CMD_IMPORT")},scope:this}]}})};IG$.A$TB=$s.extend($s.tabpanel,{m1$7:function(b,a,g,d){var c=this.getComponent(b);if(c){this.setActiveTab(c)}else{var e=IG$._I61(b,a,g,d,null);if(e!=null){e.id=b;e.cubeuid=this.ownerCt.uid;e.address=d;e.title=g;var f=this.add(e);this.setActiveTab(f)}}},initSearch:function(){}});IG$.mA$_c=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:false,resizable:true,width:500,height:450,callback:null,_IG0:function(){this.close()},_IFf:function(){var f=this,e=f.down("[name=dbpools]"),k=f.down("[name=columnlist]"),b,l,d,g=f.down("[name=buildcube]").getValue(),a={dbpool:e.getValue(),columns:[],sql:f.down("[name=sqlquery]").getValue(),buildcube:g};if(!a.dbpool){return}for(b=0;b<k.store.data.items.length;b++){d=k.store.data.items[b];l={name:d.get("name"),datatype:d.get("datatype"),selected:d.get("include"),uid:d.get("uid")};a.columns.push(l)}if(a.columns.length==0){return}if(f.callback){f.callback.execute(a)}f.close()},Jo0:function(){var a=this;this.Jo1();if(this.sqldata){a.down("[name=sqlquery]").setValue(a.sqldata.sql||"")}a.maptocombo.store.loadData(a.columns)},Jo1:function(){var a=this;var b=new IG$._I3e();b.init(a,{ack:"25",payload:IG$._I2d({address:"/"},"address"),mbody:IG$._I2e({option:"standard"})},a,a.rs_Jo1,null);b._l()},rs_Jo1:function(g){var m=this,c=IG$._I18(g,"/smsg/item"),l=(c?IG$._I26(c):null),e,d,k=[],b=m.down("[name=dbpools]"),f,a,n;k.push({disp:"Select database",name:""});if(l){for(e=0;e<l.length;e++){n=IG$._I1c(l[e]);n.type="pool";k.push(n)}}b.store.loadData(k);b.setValue(m.sqldata?m.sqldata.dbpool:"")},Jo3:function(){var g=this,e=g.down("[name=dbpools]"),c=g.down("[name=delimiter]"),b=g.down("[name=scancount]"),a=g.down("[name=sqlquery]"),d={dbpool:e.getValue(),scancount:b.getValue()},f=new IG$._I3e();if(!d.dbpool){return}f.init(g,{ack:"25",payload:IG$._I2d({uid:g.uid,option:"sqlpreview",dbpool:d.dbpool,scancount:d.scancount,scanheader:"T"},"uid;option;dbpool;scancount;scanheader"),mbody:"<smsg><SQL><![CDATA["+a.getValue()+"]]></SQL></smsg>"},g,g.rs_Jo3,null);f._l()},rs_Jo3:function(f){var l=this,d=l.down("[name=columnlist]"),c=l.down("[name=grdresult]"),a=IG$._I18(f,"/smsg/item/Result/headers"),g=(a)?IG$._I26(a):null,k=[],m,e,b={};for(e=0;e<l.columns.length;e++){b[l.columns[e].name]=l.columns[e]}for(e=0;e<g.length;e++){m=IG$._I1c(g[e]);m.include=true;if(b[m.name]){m.mapto=m.name;m.uid=b[m.name].uid}k.push(m)}d.store.loadData(k)},initComponent:function(){var a=this,b=Ext.create(Ext.form.field.ComboBox,{xtype:"combobox",name:"maptocombo",queryMode:"local",displayField:"name",labelField:"name",valueField:"name",editable:false,autoSelect:true,triggerAction:"all",selectOnTab:true,store:{xtype:"store",fields:["name","uid"],data:[]},lazyRender:true,listClass:"x-combo-list-small"});this.maptocombo=b;a.title=IRm$.r1("T_DATA_UPLOAD");Ext.apply(this,{defaults:{bodyStyle:"padding:10px"},layout:"fit",items:[{xtype:"panel",name:"mform",autoScroll:true,layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",name:"dbpools",fieldLabel:"DataSource",queryMode:"local",displayField:"disp",valueField:"name",editable:false,autoSelect:true,store:{xtype:"store",fields:["name","type","disp","status","productname","productversion","catalogname","isuserdb"]}},{xtype:"textarea",fieldLabel:"SQL Query",name:"sqlquery",height:150},{xtype:"fieldcontainer",fieldLabel:"Preview",layout:"hbox",items:[{xtype:"numberfield",name:"scancount",value:100,minValue:1,maxValue:10000},{xtype:"button",text:"Preview",handler:function(){this.Jo3()},scope:this}]},{xtype:"gridpanel",name:"columnlist",height:200,selModel:Ext.create(Ext.selection.CheckboxModel,{checkSelector:".x-grid-cell"}),plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:false,listeners:{edit:function(g,m,l){if(m.field=="mapto"){var d=m.rowIdx,c=m.grid,k=m.record,f;k.set("uid","");for(f=0;f<a.columns.length;f++){if(a.columns[f].name==m.value){k.set("uid",a.columns[f].uid)}}}}}})],store:{xtype:"store",fields:["name","datatype","include","uid","mapto"]},columns:[{xtype:"gridcolumn",text:"Name",dataIndex:"name",flex:1,editor:{xtype:"textfield",allowBlank:false}},{xtype:"gridcolumn",text:"DataType",dataIndex:"datatype",field:{xtype:"combobox",queryMode:"local",displayField:"name",valueField:"value",editable:false,autoSelect:true,triggerAction:"all",selectOnTab:true,store:{xtype:"store",fields:["name","value"],data:[{name:"String",value:"string"},{name:"Numeric",value:"number"}]},lazyRender:true,listClass:"x-combo-list-small"}},{xtype:"gridcolumn",text:"Map to",dataIndex:"mapto",editor:b},{xtype:"gridcolumn",text:"Map to uid",dataIndex:"uid",hidden:true},{xtype:"checkcolumn",text:"Include",dataIndex:"include",width:60}],tbar:[{xtype:"button",iconCls:"icon-grid-delete",text:"Delete",handler:function(){var c=this.down("[name=grdcols]"),d=c.getSelectionModel(),f=d.getSelection(),e;if(f.length>0){for(e=f.length-1;e>=0;e--){c.store.remove(f[e])}}},scope:this},"->",{xtype:"checkbox",name:"buildcube",fieldLabel:"",boxLabel:"Build Cube",checked:true}]},{xtype:"fieldset",layout:"fit",title:"Result",hidden:true,collapsible:true,collapsed:true,items:[{xtype:"gridpanel",name:"grdresult",height:300,store:{xtype:"store",fields:[]},columns:[{xtype:"gridcolumn",text:"Result"}]}]}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._IFf()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(c){c.Jo0.call(c)}}});IG$.mA$_c.superclass.initComponent.apply(this,arguments)}});IG$._IC1=function(a){$s.apply(this,a);IG$._IC1.superclass.constructor.call(this,{autoScroll:false,collapseFirst:true,bodyBorder:false,layout:{type:"border"}})};function j$sP(b,a){this.uid=b;if(a){this.m1(a)}}j$sP.prototype={m1:function(k){var m=this,d,c,b,p,l,g,f,a;m.items=[];m.itemmap={};m.styles=[];m.sqldata={};m.dataloader={option:{}};c=IG$._I18(k,"/smsg/item/MetricItems");if(c){b=IG$._I26(c);for(g=0;g<b.length;g++){p={};IG$._I1f(p,b[g],"uid;nodepath;name;metrictype;stylename;type;sequence;uniquekey;fieldname","s");m.items.push(p);m.itemmap[p.uid]=p}}var o=IG$._I18(k,"/smsg/item/Styles"),n;if(o){b=IG$._I26(o);for(g=0;g<b.length;g++){n=new IG$._IF7(b[g],"appstyle",true);m.styles.push(n)}}var c=IG$._I18(k,"/smsg/item/SQLData/item"),d,e;if(c){m.sqldata.dbpool=IG$._I1b(c,"dbpool");d=IG$._I19(c,"sqlquery");if(d){m.sqldata.sql=IG$._I24(d)}}c=IG$._I18(k,"/smsg/item/DataLoader/Option");if(c){e=IG$._I26(c);for(g=0;g<e.length;g++){f=IG$._I1b(e[g],"name");a=IG$._I24(e[g]);m.dataloader.option[f]=a}}},m2:function(){var d=this,c,b;c="<smsg><item uid='"+d.uid+"'><objinfo version='1.1'/>";c+="<MetricItems>";for(b=0;b<d.items.length;b++){c+="<item"+IG$._I20(d.items[b],"uid;nodepath;name;metrictype;stylename;type;sequence;uniquekey;fieldname","s")+"/>"}c+="</MetricItems>";c+="<SQLData>";if(d.sqldata&&d.sqldata.dbpool&&d.sqldata.columns){c+="<item dbpool='"+(d.sqldata.dbpool||"")+"'>";c+="<columns>";for(b=0;b<d.sqldata.columns.length;b++){c+="<column name='"+d.sqldata.columns[b].name+"' datatype='"+d.sqldata.columns[b].datatype+"' mappto='"+(d.sqldata.columns[b].mapto||"")+"'/>"}c+="</columns>";c+="<sqlquery><![CDATA["+(d.sqldata.sql||"")+"]]></sqlquery>";c+="</item>"}c+="</SQLData>";c+="<DataLoader>";c+="<Option>";if(d.dataloader.option){for(var a in d.dataloader.option){c+="<prop name='"+a+"'><![CDATA["+d.dataloader.option[a]+"]]></prop>"}}c+="</Option>";c+="</DataLoader>";c+="<Styles>";for(b=0;b<this.styles.length;b++){c+=this.styles[b].tx()}c+="</Styles></item></smsg>";return c}};IG$._IC1=$s.extend(IG$._I57,{uid:"",scroll:false,initialized:false,refreshmode:"F",closable:true,cubeaddress:null,nindex:0,nameprefix:"Dimension_",ditems:[],header:false,initComponent:function(){var a=this;var c=Ext.create("Ext.data.ArrayStore",{sorters:["name"],groupField:"relpath",fields:["name","nodepath","uid","datasize","datatype","fieldfullpath","fieldinfo","fieldname","relpath","selected","tablename","tableuid","type","metrictype","stylename","sequence","uniquekey","isnew"],data:[]});var d=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"Folder: {name} ({rows.length} items)"});var b=Ext.create("Ext.grid.plugin.CellEditing",{clicksToMoveEditor:1,autoCancel:false});this.dataview=Ext.create("Ext.grid.Panel",{collapsible:false,iconCls:"icon-grid",frame:false,store:c,header:false,features:[d],plugins:[b],columns:[{xtype:"checkcolumn",dataIndex:"selected",menuDisabled:true,width:30,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"}},{text:IRm$.r1("B_NAME"),dataIndex:"name",menuDisabled:true,flex:2,editor:{allowBlank:false}},{text:"Metric type",dataIndex:"metrictype",menuDisabled:true,width:80},{xtype:"actioncolumn",width:50,menuDisabled:true,items:[{iconCls:"icon-grid-add",tooltip:"Edit Data",handler:function(f,g,e){a.mm4.call(a,g,e)}},{iconCls:"icon-grid-delete",tooltip:"Remove",handler:function(f,g,e){a.mm3.call(a,g,e)}}]}]});$s.apply(this,{header:false,tbar:[" ",{iconCls:"icon-toolbar-save",tooltip:IRm$.r1("L_SAVE_CUBE"),handler:function(){this._t$("cmd_save")},scope:this},{iconCls:"icon-refresh",tooltip:IRm$.r1("L_REFRESH"),handler:function(){this._t$("cmd_refresh")},scope:this},"-",{iconCls:"icon-toolbar-mcubefile",text:IRm$.r1("L_LD_FILE"),tooltip:IRm$.r1("L_LD_FILE"),handler:function(){this._t$("cmd_ld_file")},scope:this},{iconCls:"icon-toolbar-mcubedb",tooltip:IRm$.r1("L_LD_SQL_D"),text:IRm$.r1("L_LD_SQL"),handler:function(){this._t$("cmd_sql")},scope:this},{iconCls:"icon-toolbar-buildcube",text:IRm$.r1("L_BUILD_MCUBE"),tooltip:IRm$.r1("L_BUILD_MCUBE"),hidden:true,handler:function(){this._t$("cmd_buildcube")},scope:this},{iconCls:"icon-toolbar-addmetric",tooltip:IRm$.r1("L_ADD_METRIC"),hidden:true,handler:function(){this._t$("cmd_add_metric")},scope:this},"-",{iconCls:"icon-toolbar-style",text:IRm$.r1("L_LD_ST"),tooltip:IRm$.r1("L_LD_ST"),handler:function(){this._t$("cmd_style")},scope:this},{iconCls:"icon-toolbar-remove",tooltip:IRm$.r1("L_DELETE_CHECKED"),handler:function(){this._t$("cmd_delete")},scope:this},"-",{iconCls:"icon-toolbar-db-unload",tooltip:IRm$.r1("L_LD_UL"),text:IRm$.r1("L_LD_UL"),handler:function(){this._t$("cmd_db_unload")},scope:this},{iconCls:"icon-toolbar-db-load",tooltip:IRm$.r1("L_LD_LK"),text:IRm$.r1("L_LD_LK"),handler:function(){this._t$("cmd_db_load")},scope:this},"-",{iconCls:"icon-toolbar-db-destroy",text:IRm$.r1("L_LD_INI"),title:IRm$.r1("L_LD_INI"),handler:function(){this._t$("cmd_db_destroy")},scope:this}],items:[{layout:"fit",items:[this.dataview],region:"center",collapsible:false}]});IG$._IC1.superclass.initComponent.call(this)},entryLogin:function(b){if(demos.Login.success==true){var a=demos.IG$._IC1;a.sK5.call(a)}else{history.back(-1)}},sK5:function(){var b=this;var a=b.body.getWidth();var c=b.body.getHeight();if(b.uid&&b.uid.length>0){b.setLoading(true,true);var d=new IG$._I3e();d.init(b,{ack:"5",payload:IG$._I2d({uid:b.uid}),mbody:IG$._I2e({option:"content"})},b,b.rs_sK5,null);d._l();b.refreshmode="F"}},rs_sK5:function(a){var b=this;var c=IG$._I18(a,"/smsg/item");b.cubeaddress=IG$._I1b(c,"nodepath");b.MM1=new j$sP(b.uid,a);b.sqldata=b.MM1.sqldata;b.mr1()},mr1:function(){var a=this,b=new IG$._I3e();b.init(a,{ack:"5",payload:IG$._I2d({uid:a.uid}),mbody:IG$._I2e({option:"metrics"})},a,a.rs_mr1,null);b._l()},rs_mr1:function(m){var b=this,k,d,c,o,f=[],p,l=b.dataview,e=b.cubeaddress,q,a=b.MM1,g=(e)?e.length:0;b.setLoading(false);c=IG$._I18(m,"/smsg/item");b.nindex=0;b.ditems=[];if(c){o=IG$._I26(c);for(k=0;k<o.length;k++){p=IG$._I1c(o[k]);if(p.type=="Folder"){if(o[k].hasChildNodes()==false){p.type="blank";p.name="No items defined";p.relpath=p.nodepath.substring(g);f.push(p)}}else{d=p.nodepath.lastIndexOf("/");p.relpath=p.nodepath.substring(0,d).substring(g);if(p.name.substring(0,b.nameprefix.length)==b.nameprefix){q=Number(p.name.substring(b.nameprefix.length));if(isNaN(q)==false){b.nindex=Math.max(b.nindex,q+1)}}if(a.itemmap[p.uid]){p.stylename=a.itemmap[p.uid].stylename;p.metrictype=a.itemmap[p.uid].metrictype||"metric"}f.push(p)}}}l.store.loadData(b.MM1.items)},listeners:{render:function(b){var a=b;a.sK5.call(a);a.initialized=true},deactivate:function(b){var a=b;a.disposeContent(a)},resize:function(c,e,b,a,d){c.Mm11.call(c,e,b)},scope:this},refreshContent:function(){this.refreshmode="T";this._IJ2(this)},Mm11:function(b,a,c){},disposeContent:function(a){},d1:function(b){var a=this;if(!a.uid){var c=new IG$._I96({mode:"newitem",initpath:this.nodepath});c.callback=new IG$._I3d(this,this.rs_d1,b);IG$._I_5(this,c);return false}return true},rs_d1:function(c,d){if(c&&c.nodepath&&c.name){var a=this,e=IG$._I2e(),b=new IG$._I3e();b.init(a,{ack:"31",payload:"<smsg><item address='"+c.nodepath+"/"+c.name+"' name='"+c.name+"' type='DataCube' pid='"+c.uid+"' description=''/></smsg>",mbody:"<smsg><item address='"+c.nodepath+"'/></smsg>"},a,function(){this._t$(d)},null);b.showerror=false;b._l()}},_t$:function(d){var a=this,c=this,b;switch(d){case"cmd_save":if(a.d1()==true){a.mm5()}break;case"cmd_refresh":a.sK5();break;case"cmd_ld_file":if(a.d1()==true){a.mD1()}break;case"cmd_buildcube":a.mm1();break;case"cmd_add_metric":a.mm2();break;case"cmd_style":var e=new IG$._I9c({styleinfo:a.MM1.styles});IG$._I_5(this,e);break;case"cmd_sql":if(a.d1()==true){a.mD2()}break;case"cmd_db_unload":b=new IG$._I3e();b.init(c,{ack:"17",payload:IG$._I2d({cubeuid:c.uid,action:"unlockcube"},"cubeuid;action"),mbody:"<smsg></smsg>"},c,function(){IG$._I54(ig$.appname,IRm$.r1("B_SUCCESS"),null,a,0,"success")},null);b._l();break;case"cmd_db_load":b=new IG$._I3e();b.init(c,{ack:"17",payload:IG$._I2d({cubeuid:c.uid,action:"loadcube"},"cubeuid;action"),mbody:"<smsg></smsg>"},c,function(){IG$._I54(ig$.appname,IRm$.r1("B_SUCCESS"),null,a,0,"success")},null);b._l();break;case"cmd_db_destroy":IG$._I55("Confirm delete DB?","Click ok button to delete molap db content.",c.lm1,c,c);break;case"cmd_delete":c.sk5m();break}},sk5m:function(){var b,f,g,e,a=this;g="";e="<smsg><Info option='delete'/></smsg>";for(b=this.dataview.store.data.items.length-1;b>=0;b--){f=this.dataview.store.data.items[b].data;if(f.selected==true&&f.uid){g+="<item uid='"+f.uid+"' name='"+f.name+"' type='"+f.type+"'/>"}else{if(f.selected){this.dataview.store.remove(this.dataview.store.data.items[b])}}}if(g!=""){req=new IG$._I3e();req.init(a,{ack:"30",payload:"<smsg>"+g+"</smsg>",mbody:e},a,a.rs_sK4Ld,null);req._l()}},rs_sK4Ld:function(a){var b,c;for(b=this.dataview.store.data.items.length-1;b>=0;b--){c=this.dataview.store.data.items[b].data;if(c.selected==true){this.dataview.store.remove(this.dataview.store.data.items[b])}}},lm1:function(a){var c=this,b;if(a=="yes"){b=new IG$._I3e();b.init(c,{ack:"17",payload:IG$._I2d({cubeuid:c.uid,action:"51"},"cubeuid;action"),mbody:"<smsg></smsg>"},c,function(){IG$._I54(ig$.appname,IRm$.r1("B_SUCCESS"),null,c,0,"success")},null);b._l()}},mD2:function(){var f=this,a=this.dataview,b=[],e,c,d;for(c=0;c<a.store.data.items.length;c++){d=a.store.data.items[c];e={name:d.get("name"),uid:d.get("uid")};b.push(e)}var g=new IG$.mA$_c({uid:f.uid,columns:b,sqldata:f.sqldata,callback:new IG$._I3d(f,this.rs_mD2)});IG$._I_5(this,g)},rs_mD2:function(g){var m=this,f,c,k=m.dataview,n=new IG$._I3e(),d=0,b=1,p,o,l={},e,a=m.MM1;m.sqldata={dbpool:g.dbpool,columns:g.columns,sql:g.sql};a.sqldata=m.sqldata;c=m.sqldata.columns;if(g.buildcube==true){m.setLoading(true);cnt="<smsg>";for(f=0;f<g.columns.length;f++){cnt+="<column uid='"+(g.columns[f].uid||"")+"' name='"+g.columns[f].name+"' datatype='"+g.columns[f].datatype+"' isuse='"+(g.columns[f].selected==true?"T":"F")+"'/>"}cnt+="</smsg>";e="<smsg><item uid='"+m.uid+"' action='sqlcube' dbpool='"+g.dbpool+"'>";e+="<SQL><![CDATA["+g.sql+"]]></SQL>";e+="</item></smsg>";n.init(m,{ack:"17",payload:e,mbody:cnt},m,m.rs_mD2a,null);n._l()}},rs_mD2a:function(g){var m=this,e,b=IG$._I18(g,"/smsg"),k=IG$._I26(b),f=m.dataview,a,l={},n,o,c=m.cubeaddress,d=(c)?c.length:0;for(e=0;e<f.store.data.items.length;e++){n=f.store.data.items[e].get("uid");l[n]=f.store.data.items[e]}for(e=0;e<k.length;e++){o=IG$._I1c(k[e]);o.type=(o.datatype=="number")?"Measure":"Metric";o.datatype=(o.datatype=="number")?"numeric":"string";o.metrictype=o.type;o.fieldname=o.name;o.sequence=o.sequence;o.uniquekey=o.uniquekey;o.isnew=l[n]?false:true;o.parentnodepath=c;o.relpath=c.substring(d);o.nodepath=o.parentnodepath+"/"+o.name;n=o.uid;if(l[n]){l[n].set("type",o.type);l[n].set("datatype",o.datatype);l[n].set("metrictype",o.metrictype);l[n].set("fieldname",o.fieldname);l[n].set("uniquekey",o.uniquekey);l[n].set("sequence",o.sequence)}else{f.store.add(o)}}},mD1:function(){var f=this,a=this.dataview,c,e,d,b=[];for(c=0;c<a.store.data.items.length;c++){e=a.store.data.items[c];d={name:e.get("name"),uid:e.get("uid")};b.push(d)}var g=new IG$.M$d10({uid:f.uid,columns:b,mm:f.MM1,callback:new IG$._I3d(f,this.rs_mD1)});IG$._I_5(this,g)},rs_mD1:function(c){var e=this,d=new IG$._I3e(),b,a,f=c.buildcube;if(!f){e.rs_mD1b(c.columns)}else{e.setLoading(true);b="<smsg>";for(a=0;a<c.columns.length;a++){b+="<column uid='"+c.columns[a].uid+"' name='"+c.columns[a].name+"' datatype='"+c.columns[a].datatype+"' isuse='"+(c.columns[a].selected==true?"T":"F")+"' ismeasure='"+(c.columns[a].ismeasure==true?"T":"F")+"'/>"}b+="</smsg>";d.init(e,{ack:"17",payload:IG$._I2d({uid:e.uid,action:"38",datafile:c.datafile,delimiter:c.delimiter,datatransformer:c.datatransformer},"uid;action;datafile;delimiter;datatransformer"),mbody:b},e,e.rs_mD1a,null);d._l()}},rs_mD1b:function(c){var m=this,g,l={},o,n,d,k=m.dataview,e=m.cubeaddress,f=(e)?e.length:0,a=1,b=0;for(g=0;g<k.store.data.items.length;g++){n=k.store.data.items[g].get("name");l[n]=k.store.data.items[g]}for(g=0;g<c.length;g++){o=c[g];o.type=(o.datatype=="number")?"Measure":"Metric";o.datatype=(o.datatype=="number")?"numeric":"string";o.metrictype=o.type;o.fieldname=o.name;o.sequence=(o.datatype=="numeric")?0:a++;o.uniquekey=(o.datatype=="numeric")?b++:-1;o.isnew=true;o.parentnodepath=e;o.relpath=e.substring(f);o.nodepath=o.parentnodepath+"/"+o.name;if(o.ismeasure=="T"){continue}n=o.name;if(l[n]){l[n].set("type",o.type);l[n].set("datatype",o.datatype);l[n].set("metrictype",o.metrictype);l[n].set("fieldname",o.fieldname);l[n].set("uniquekey",o.uniquekey);l[n].set("sequence",o.sequence)}else{k.store.add(o)}}},rs_mD1a:function(g){var m=this,a=IG$._I18(g,"/smsg"),k=(a?IG$._I26(a):null),e,l={},o,n,b,f=m.dataview,c=m.cubeaddress||"",d=(c)?c.length:0;m.setLoading(false);if(k){for(e=0;e<f.store.data.items.length;e++){n=f.store.data.items[e].get("uid");l[n]=f.store.data.items[e]}for(e=0;e<k.length;e++){o=IG$._I1c(k[e]);o.type=(o.ismeausre=="T")?"Measure":"Metric";o.datatype=(o.ismeasure=="T")?"numeric":"string";o.metrictype=o.type;o.fieldname=o.name;o.sequence=o.sequence;o.uniquekey=o.uniquekey;o.isnew=true;o.parentnodepath=c;o.relpath=c.substring(d);o.nodepath=o.parentnodepath+"/"+o.name;if(o.ismeasure=="T"){continue}n=o.uid;if(l[n]){l[n].set("type",o.type);l[n].set("datatype",o.datatype);l[n].set("metrictype",o.metrictype);l[n].set("fieldname",o.fieldname);l[n].set("uniquekey",o.uniquekey);l[n].set("sequence",o.sequence)}else{f.store.add(o)}}}},mm1:function(){var b=this,g=new IG$._I3e(),a=b.dataview,c=a.store,f,d,e=false;for(d=0;d<c.data.items.length;d++){f=c.data.items[d];if(f.get("type")=="Metric"&&!f.get("uid")){e=true;IG$._I54(ig$.appname,"Save Cube before build multi dimensional database",null,null,0,"success");break}}if(e==false){g.init(b,{ack:"17",payload:"<smsg><item cubeuid='"+b.uid+"' action='BuildCube'/></smsg>",mbody:"<smsg></smsg>"},b,b.rs_mm1,null);g._l()}},rs_mm1:function(a){IG$._I54(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},mm2:function(){var a=this,g=a.dataview,k=g.getSelectionModel(),d=a.cubeaddress,f=(d)?d.length:0,e,b,l,c;e=d;if(k.selected.items.length>0){b=k.selected.items[0];if(b.get("type")=="blank"){e=b.get("nodepath");c=b}else{e=b.get("nodepath");e=e.substring(0,e.lastIndexOf("/"))}}l={isnew:true,name:a.nameprefix+(a.nindex++),uid:null,parentnodepath:e,relpath:e.substring(f),type:"Metric"};l.nodepath=l.parentnodepath+"/"+l.name;g.store.add(l);if(c){g.store.remove(c)}},mm3:function(d,g){var b=this,a=b.dataview,c,e,k,f=false;e=a.store.getAt(d);if(e.get("type")=="Metric"){a.store.removeAt(d);if(e.get("uid")){b.ditems.push({uid:e.get("uid"),name:e.get("name"),nodepath:e.get("nodepath"),type:e.get("type")})}if(e.get("relpath")!=""){for(c=0;c<a.store.data.items.length;c++){k=a.store.data.items[c];if(k.get("relpath")==e.get("relpath")){f=true;break}}if(f==false){k={type:"blank",name:"No items defined",relpath:e.get("relpath"),nodepath:e.get("nodepath")};a.store.add(k)}}}},mm4:function(k,d){var b=this,a=b.dataview,f,g,e;g=a.store.getAt(k);e=g.get("uid");if(g.get("type")=="Metric"||g.get("type")=="Measure"){if(e){var c=new IG$._IC2({uid:e,sequence:g.get("sequence"),uniquekey:g.get("uniquekey"),itemtype:g.get("type")});IG$._I_5(this,c)}else{IG$._I54(ig$.appname,IRm$.r1("L_ERR_SAVE"),null,null,1,"error")}}},mm5:function(){var a=this,e=a.dataview,m=e.store,d,n,l=new IG$._I3e(),b=a.ditems,k="<smsg>",g="<smsg>",f=0,c;for(d=0;d<m.data.items.length;d++){n=m.data.items[d];if(n.get("type")=="Metric"||n.get("type")=="Measure"){c=n.get("nodepath");c=c.substring(0,c.lastIndexOf("/"));c=c+"/"+n.get("name");k+="<item nodepath='"+c+"' name='"+n.get("name")+"' type='"+n.get("type")+"'";if(n.get("isnew")==true){k+=" pid='"+this.uid+"' uid='"+c+"' reserved_uid='"+n.get("uid")+"'"}else{k+=" uid='"+(n.get("uid")?n.get("uid"):c)+"'"}k+="/>";g+="<item><objinfo cubeuid='"+a.uid+"' sequence='"+n.get("sequence")+"'";if(n.get("uniquekey")){g+=" uniquekey='"+n.get("uniquekey")+"'"}g+="/></item>";f++}}for(d=0;d<b.length;d++){n=b[d];k+="<item option='delete' uid='"+n.uid+"'/>";g+="<item/>";f++}k+="</smsg>";g+="</smsg>";if(f>0){a.setLoading(true);l.init(a,{ack:"30",payload:k,mbody:g},a,a.rs_mm5,null);l._l()}},rs_mm5:function(e){var a=this,d=a.dataview,k=d.store,l,g=IG$._I18(e,"/smsg"),f=IG$._I26(g),b=0,c;if(f&&f.length>0){for(c=0;c<k.data.items.length;c++){l=k.data.items[c];if(l.get("type")=="Metric"||l.get("type")=="Measure"){if(!l.get("uid")){l.set("uid",IG$._I1b(f[b],"uid"))}b++}}}a.ditems=[];a.mm6()},mm6:function(){var b=this,g,k=b.MM1,d,a=b.dataview,c=a.store,f;k.items=[];for(d=0;d<c.data.items.length;d++){f=c.data.items[d];if(f.get("type")=="Metric"||f.get("type")=="Measure"){k.items.push({name:f.get("name"),type:f.get("type"),nodepath:f.get("nodepath"),uid:f.get("uid"),metrictype:f.get("metrictype")||"",stylename:f.get("stylename")||"",sequence:f.get("sequence")||"",uniquekey:f.get("uniquekey")||"",fieldname:f.get("fieldname")||""})}}g=k.m2.call(k);var e=new IG$._I3e();e.init(b,{ack:"31",payload:IG$._I2d({uid:b.uid}),mbody:g},b,b.rs_mm6,null);e._l()},rs_mm6:function(a){this.setLoading(false);IG$._I54(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}});IG$.M$d10=$s.extend($s.window,{modal:true,region:"center",layout:"fit",closable:false,resizable:true,width:450,height:400,callback:null,_IG0:function(){this.close()},_IFf:function(){var l=this,g=l.down("[name=datafiles]"),a=l.down("[name=delimiter]"),d=l.down("[name=columnlist]"),f=l.down("[name=datatransformer]"),e,k,n,m=l.down("[name=buildcube]").getValue(),b={datafile:g.getValue(),delimiter:a.getValue(),columns:[],buildcube:m,datatransformer:f.getValue()};if(!b.datafile){return}if(l.mm&&l.mm.dataloader&&l.mm.dataloader.option){l.mm.dataloader.option.datafile=b.datafile;l.mm.dataloader.option.delimiter=b.delimiter;l.mm.dataloader.option.datatransformer=b.datatransformer}for(e=0;e<d.store.data.items.length;e++){n=d.store.data.items[e];k={name:n.get("name"),datatype:n.get("datatype"),selected:n.get("selected"),mcuid:n.get("mcuid"),ismeasure:n.get("ismeasure")};b.columns.push(k)}if(b.columns.length==0){return}if(l.callback){l.callback.execute(b)}l.close()},Jo0:function(){var d=this,b=d.down("[name=delimiter]"),a=d.down("[name=scancount]"),c=d.down("[name=datatransformer]");if(d.mm&&d.mm.dataloader&&d.mm.dataloader.option){b.setValue(d.mm.dataloader.option.delimiter||",");a.setValue(d.mm.dataloader.option.scancount||100);c.setValue(d.mm.dataloader.option.datatransformer)}this.Jo1()},Jo1:function(){var a=this;var b=new IG$._I3e();b.init(a,{ack:"25",payload:IG$._I2d({uid:this.uid,option:"datafiles"},"uid;option"),mbody:IG$._I2e({})},a,a.rs_Jo1,null);b._l()},rs_Jo1:function(k){var n=this,b=IG$._I18(k,"/smsg"),m=(b?IG$._I26(b):null),e,d,l=[],g=n.down("[name=datafiles]"),f,a,c;l.push({name:"Select File",value:""});if(m){for(e=0;e<m.length;e++){l.push({name:IG$._I1b(m[e],"name"),value:IG$._I1b(m[e],"name")})}}g.store.loadData(l);g.setValue("")},Jo3:function(){var g=this,a=g.down("[name=datafiles]"),c=g.down("[name=delimiter]"),b=g.down("[name=scancount]"),d=g.down("[name=datatransformer]"),e={datafile:a.getValue(),delimiter:c.getValue(),scancount:b.getValue(),datatransformer:d.getValue()},f=new IG$._I3e();if(!e.datafile){return}f.init(g,{ack:"17",payload:IG$._I2d({uid:g.uid,action:"37",datafile:e.datafile,delimiter:e.delimiter,scancount:e.scancount,scanheader:"T",datatransformer:e.datatransformer},"uid;action;datafile;delimiter;scancount;scanheader;datatransformer"),mbody:"<smsg></smsg>"},g,g.rs_Jo3,null);f._l()},rs_Jo3:function(e){var k=this,c=k.down("[name=columnlist]"),a=IG$._I18(e,"/smsg"),f=(a)?IG$._I26(a):null,g=[],l,d,b={};for(d=0;d<k.columns.length;d++){b[k.columns[d].name]=k.columns[d]}for(d=0;d<f.length;d++){l=IG$._I1c(f[d]);l.selected=true;if(b[l.name]){l.mapto=l.name;l.mcuid=b[l.name].mcuid}g.push(l)}c.store.loadData(g)},initComponent:function(){var a=this,b;a.title=IRm$.r1("T_DATA_UPLOAD");b=Ext.create(Ext.form.field.ComboBox,{xtype:"combobox",name:"maptocombo",queryMode:"local",displayField:"name",labelField:"name",valueField:"mcuid",editable:false,autoSelect:true,triggerAction:"all",selectOnTab:true,store:{xtype:"store",fields:["name","mcuid"],data:a.columns},lazyRender:true,listClass:"x-combo-list-small"});a.maptocombo=b;Ext.apply(this,{layout:{type:"vbox",align:"stretch"},bodyStyle:"padding:10px",border:1,items:[{xtype:"form",name:"mform",customowner:this,layout:"anchor",border:0,defaults:{anchor:"100%"},items:[{xtype:"combobox",fieldLabel:"Delimiter",name:"delimiter",queryMode:"local",autoSelect:true,autoScroll:true,editable:false,labelField:"name",displayField:"name",valueField:"value",store:{fields:["name","value"],data:[{name:",",value:","},{name:"Tab",value:"tab"},{name:"space",value:"space"},{name:"|",value:"|"}]}},{xtype:"combobox",name:"datafiles",fieldLabel:"DataFiles",queryMode:"local",displayField:"name",valueField:"value",editable:false,autoSelect:true,store:{xtype:"store",fields:["name","value"]}},{xtype:"fieldcontainer",fieldLabel:"Scan",layout:"hbox",items:[{xtype:"numberfield",name:"scancount",value:100,minValue:0,maxValue:10000,flex:1},{xtype:"button",text:"Scan",handler:function(){this.Jo3()},scope:this}]},{xtype:"textfield",name:"datatransformer",fieldLabel:"Data transform class"},{xtype:"checkbox",name:"buildcube",fieldLabel:"Build Cube",boxLabel:"buildcube",checked:true}]},{xtype:"gridpanel",name:"columnlist",flex:1,store:{xtype:"store",fields:["name","datatype","ismeasure","selected","mapto","uid","mcuid"]},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:0,listeners:{edit:function(g,m,l){if(m.field=="mapto"){var d=m.rowIdx,c=m.grid,k=m.record,f;k.set("mcuid","");for(f=0;f<a.columns.length;f++){if(a.columns[f].name==m.value){k.set("mcuid",a.columns[f].uid)}}}}}})],columns:[{xtype:"gridcolumn",text:"Name",dataIndex:"name",flex:2,editor:{xtype:"textfield"}},{xtype:"gridcolumn",dataIndex:"datatype",width:120,text:"DataType",field:{xtype:"combobox",queryMode:"local",displayField:"name",valueField:"value",editable:false,autoSelect:true,triggerAction:"all",selectOnTab:true,store:{xtype:"store",fields:["name","value"],data:[{name:"String",value:"string"},{name:"Numeric",value:"number"}]},lazyRender:true,listClass:"x-combo-list-small"}},{xtype:"checkcolumn",dataIndex:"ismeasure",width:120,text:"Measure"},{xtype:"gridcolumn",dataIndex:"mapto",flex:1,text:"Map to",editor:b},{xtype:"gridcolumn",dataIndex:"uid",hidden:true},{xtype:"checkcolumn",dataIndex:"selected",width:40,text:"Use"}]}],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){this._IFf()},scope:this},{text:IRm$.r1("B_CANCEL"),handler:function(){this.close()},scope:this}],listeners:{afterrender:function(c){var d=this.down("[name=delimiter]");d.setValue(",");c.Jo0.call(c)}}});IG$.M$d10.superclass.initComponent.apply(this,arguments)}});IG$._IC3=$s.extend(IG$._I57,{layout:"fit",uid:null,parentnodepath:null,itemtype:null,parentuid:null,callback:null,objinfo:null,seq:0,bodyPadding:10,initComponent:function(){var a=this;$s.apply(this,{items:[{xtype:"gridpanel",name:"elemtree",store:{xtype:"store",fields:["name","ukey"]},selModel:Ext.create(Ext.selection.CheckboxModel,{checkSelector:".x-grid-cell"}),tbar:[{iconCls:"icon-toolbar-save",tooltip:"Save Content",handler:function(){this.U1.call(this,null)},scope:this},"-",{iconCls:"icon-toolbar-add",tooltip:"Add Node",hidden:true,handler:function(){var b=this;b.Mex.call(b)},scope:this},{iconCls:"icon-toolbar-remove",tooltip:"Delete Node",hidden:true,handler:function(){var b=this;b.Mrx.call(b)},scope:this}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:false})],columns:[{xtype:"gridcolumn",text:"Element name",dataIndex:"name",flex:1,editor:{allowBlank:false}},{xtype:"gridcolumn",text:"Unique value",dataIndex:"ukey",width:80,editor:{allowBlank:false}},{xtype:"actioncolumn",hidden:true,width:80,items:[{iconCls:"icon-grid-config",tooltip:IRm$.r1("B_CONFIG_ITEM"),handler:function(d,k,c,f,g,b){a.Mkx(k,b,"edit")},scope:a},{iconCls:"icon-grid-delete",tooltip:IRm$.r1("B_DELETE_ITEM"),handler:function(d,k,c,f,g,b){a.Mkx(k,b,"delete")},scope:a}]}],listeners:{checkchange:function(c,b){c.set("chekced",b)}}}],U1:function(f){var e=this,b="<item uid='"+this.uid+"'>",l=e.down("[name=elemtree]"),g=l.store,d=g.getRootNode(),c;e.setLoading(true);c=e.U3(d,null);b+="<objinfo"+IG$._I20(e.objinfo,"cubeuid","s")+"/>";b+="<Elements lseq='"+e.seq+"'><![CDATA["+c+"]]></Elements>";b+="</item>";var k=new IG$._I3e();k.init(e,{ack:"31",payload:IG$._I2d({uid:e.uid}),mbody:"<smsg>"+b+"</smsg>"},e,e.rs_U1,null,f);k._l()},rs_U1:function(b,c){this.U1m(c)},U1m:function(c){var b=this,d=new IG$._I3e();d.init(b,{ack:"17",payload:"<smsg><item uid='"+b.uid+"' cubeuid='"+b.objinfo.cubeuid+"' action='UpdateMetric'/></smsg>",mbody:"<smsg></smsg>"},b,b.rs_U1m,null,c);d._l()},rs_U1m:function(b,d){var c=this;c.setLoading(false);if(d){d.close()}else{IG$._I54(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")}},U3:function(k,g){var e=this,c,d="",f,b;for(c=0;c<k.childNodes.length;c++){f=k.childNodes[c];b=f.get("seq");d+=""+b+","+(g?g.get("seq"):"")+","+f.get("name")+"|";if(f.childNodes&&f.childNodes.length>0){d+=this.U3(f,f)}}return d},U2:function(){var b=this;var c=new IG$._I3e();c.init(b,{ack:"5",payload:IG$._I2d({uid:b.uid}),mbody:IG$._I2e({option:"diagnostics"})},b,b.rs_U2,null);c._l()},rs_U2:function(g){var b=this,d=IG$._I18(g,"/smsg/item"),k=IG$._I18(g,"/smsg/item/objinfo"),l,c=[],f,e,m;if(k){b.objinfo=IG$._I1c(k)}if(b.objinfo&&b.objinfo.sequence){b.m1$a(c)}},U4:function(f,d){for(var c=0;c<f.length;c++){var e=IG$._I1b(f[c],"id");var k=IG$._I1b(f[c],"text");var b=this.mtree.appendNodeElement.call(this.mtree,d,e,k);var g=IG$._I26(f[c]);if(g&&g.length>0){this.U4(g,b)}}},Mkx:function(d,b,g){var e=this,f=e.down("[name=elemtree]"),c=f.store;if(g=="delete"){if(b.get("root")!==true){b.remove()}}},m1$a:function(k){var g=this,b=g,f=this.clItem,c,d=g.objinfo;b.setLoading(true);var e=new IG$._I3e();e.init(b,{ack:"17",payload:IG$._I2d({uid:b.uid,sequence:d.sequence,action:"55"},"uid;sequence;action"),mbody:IG$._I2e({option:"standard"})},b,b.rs_m1$a,null);e._l()},rs_m1$a:function(b){var f=this,l=IG$._I18(b,"/smsg/item"),k=(l?IG$._I26(l):null),c=[],e,g=f.down("[name=elemtree]"),d;f.setLoading(false);for(d=0;d<k.length;d++){e=IG$._I1c(k[d]);e.name=IG$._I24(k[d]);c.push(e)}g.store.loadData(c)},mm:function(c){var b=[],e={},d;for(i=0;i<c.length;i++){e[c[i].seq]=c[i];if(c[i].pnode!=null&&e[c[i].pnode]){d=e[c[i].pnode];d.leaf=false;delete d.checked;c[i].leaf=true;c[i].checked=false;d.children=d.children||[];d.children.push(c[i])}else{c[i].leaf=true;c[i].checked=false;b.push(c[i])}}return b},Mex:function(){var l=this,n=l.down("[name=elemtree]"),o=n.store,m=n.getSelectionModel(),p,k,c,d,e,g,b=0,f;if(m.selected.items.length>0){c=m.selected.items[0]}else{c=n.getRootNode()}p=c.get("valuedesc");k=c.get("values");c.set("valuedesc","");c.set("values","");c.set("leaf",false);g="new item ";for(e=0;e<c.childNodes.length;e++){f=c.childNodes[e].get("name");if(f.substring(0,g.length)==g){f=f.substring(g.length);f=Number(f);if(isNaN(f)==false){b=Math.max(b,Number(f)+1)}}}b=Math.max(b,l.seq+1);l.seq=b;g+=b;d={seq:b,name:g,values:k||"",valuedesc:p||"",leaf:true,checked:false};c.appendChild(d);c.expand()},Mrx:function(){var e=this,f=e.down("[name=elemtree]"),c=f.store,b=c.getRootNode(),d;e.mrx(b)},mrx:function(b){var e=this,c,d;for(c=b.childNodes.length-1;c>=0;c--){d=b.childNodes[c];if(d.get("checked")==true){b.removeChild(d)}else{if(d.childNodes&&d.childNodes.length>0){e.mrx(d)}}}},listeners:{afterrender:function(b){this.U2()}}});IG$._IC3.superclass.initComponent.apply(this)}});IG$._IC2=$s.extend($s.window,{modal:true,layout:"fit",closable:false,resizable:false,width:500,height:400,callback:null,_IG0:function(){this.close()},initComponent:function(){var a=this;a.title=IRm$.r1("L_MC_ELEM_EDT");a.edt=new IG$._IC3({uid:a.uid});$s.apply(this,{defaults:{bodyStyle:"padding:0px"},layout:"fit",items:[this.edt],buttons:[{text:IRm$.r1("B_CONFIRM"),handler:function(){var b=this,c=this.edt;c.U1.call(c,this)},scope:this},{text:IRm$.r1("B_CLOSE"),handler:function(){this.close()},scope:this}]});IG$._IC2.superclass.initComponent.apply(this,arguments)}});IG$._IC4=function(a){$s.apply(this,a);IG$._IC4.superclass.constructor.call(this,{autoScroll:true,collapseFirst:false,closable:true,items:[{html:"<div class='elementeditor'></div>"}]})};function CMolapMeasure(a){this.measuretype="COUNT";this.uid=null;this.name=null;this.nodepath=null;this.baseItem=null;this.parseMeasure=function(b){var c=IG$._I18(b,"/smsg/item");this.name=IG$._I1b(c,"name");this.nodepath=IG$._I1b(c,"nodepath");this.uid=IG$._I1b(c,"uid");this.isDisinct=true;c=IG$._I18(b,"/smsg/item/objinfo");if(c){this.measuretype=IG$._I1b(c,"measuretype")}c=IG$._I18(b,"/smsg/item/BaseItem");if(c){this.baseItem={};this.baseItem.name=IG$._I1b(c,"name");this.baseItem.uid=IG$._I1b(c,"uid");this.baseItem.nodepath=IG$._I1b(c,"nodepath");this.baseItem.itemtype=IG$._I1b(c,"type")}c=IG$._I18(b,"/smsg/item/Options");if(c&&c.hasChildNodes()==true){var f=IG$._I26(c);for(i=0;i<f.length;i++){var e=f[i];var d=IG$._I24(f[i]);switch(IG$._I1b(e,"name")){case"isDistinct":this.isDisinct=(d=="F")?false:true;break}}}};this.getMeasureXML=function(){var b='<smsg><item uid="'+this.uid+'" name="'+this.name+'" nodepath="'+this.nodepath+'"><objinfo measuretype="'+this.measuretype+'"/>';switch(this.measuretype){case"COUNT":b+='<BaseItem uid="'+this.baseItem.uid+'" nodepath="'+this.baseItem.nodepath+'" name="'+this.baseItem.name+'" type="'+this.baseItem.itemtype+'"/>';b+="<Options>";b+='<Property name="isDistinct">'+(this.isDistinct==true?"T":"F")+"</Property>";b+="</Options>";break;case"SUM":break;case"MAX":break;case"DATE":break}b+="</item></smsg>";return b};if(a){this.parseMeasure(a)}}IG$._IC4=$s.extend(IG$._I57,{title:"Make item",modal:true,region:"center",layout:"vbox",layoutConfig:{align:"stretch"},closable:true,resizable:false,width:400,height:500,uid:null,cubeuid:null,parentnodepath:null,itemtype:null,parentuid:null,measureObj:null,selectCombo:null,defaults:{autoHeight:true,bodyStyle:"padding:10px"},pivotSelectionChangedHandler:function(a){this.measureObj.measuretype=a;this.resetMeasureUI()},metricSelectedHandler:function(a){this.measureObj.baseItem=a;this.baseItemField1.setValue(this.measureObj.baseItem.nodepath)},initComponent:function(){var a=this;this.baseItemField1=new Ext.form.TextField({name:"fmetric",allowBlank:false});this.stabcontainer=new Ext.Container({flex:3,layout:"card",items:[{layout:"fit",layoutConfig:{align:"stretch"},items:[{xtype:"fieldcontainer",fieldLabel:"Metric",items:[this.baseItemField1,{xtype:"button",text:"..",handler:function(){var b=new IG$._I96({u5x:{cubebrowse:true,rootuid:a.cubeuid}});b.callback=new IG$._I3d(a,a.metricSelectedHandler);IG$._I_5(this,b)},scope:this}]}],hidden:false},{html:"Sum of measure type",hidden:true},{html:"Max of measure type",hidden:true},{html:"Date of measure type",hidden:true}]});$s.apply(this,{items:[{flex:1,height:40,items:[{html:'<div class="pivotSelect">Measure type:</div>',border:false,listeners:{afterlayout:function(b){b.addPivotSelectHandler.call(b)}},selectBoxAdded:false,addPivotSelectHandler:function(){if(this.selectBoxAdded==false){var c=$(".pivotSelect",a.body.dom),b=$('<select name="pivotSelect"><option value="COUNT">Count Metric</option><option value="SUM">Sum data</option><option value="MAX">Max data</option><option value="DATE">Date Measure</option></select>');b.change(function(){a.pivotSelectionChangedHandler.call(a,this.value)});b.appendTo(c);this.selectBoxAdded=true;a.selectCombo=b}}}]},this.stabcontainer],tbar:[{iconCls:"icon-expand-all",tooltip:"Save Content",handler:function(){this.storeContent.call(this)},scope:this}],storeContent:function(){var c=this;var b=c.measureObj.getMeasureXML();var d=new IG$._I3e();d.init(c,{ack:"31",payload:IG$._I2d({uid:c.uid}),mbody:b},c,c.rs_storeContent,null);d._l()},rs_storeContent:function(b){IG$._I54(ig$.appname,IRm$.r1("M_SAVED"),null,null,0,"success")},refreshContent:function(){var b=this;var c=new IG$._I3e();c.init(b,{ack:"5",payload:IG$._I2d({uid:b.uid}),mbody:IG$._I2e()},b,b.rs_refreshContent,null);c._l()},rs_refreshContent:function(b){a.measureObj=new CMolapMeasure(b);a.resetMeasureUI.call(a)},resetMeasureUI:function(){this.selectCombo[0].value=this.measureObj.measuretype;var b=this.measureObj.measuretype;var d=0;switch(b){case"COUNT":d=0;if(this.measureObj.baseItem){this.baseItemField1.setValue(this.measureObj.baseItem.nodepath)}break;case"SUM":d=1;break;case"MAX":d=2;break;case"DATE":d=3;break}var c=this.stabcontainer;for(i=0;i<c.items.items.length;i++){c.items.items[i].setVisible((i==d?true:false))}}});IG$._IC4.superclass.initComponent.apply(this,arguments)}});IG$.MmD$m=function(a){$s.apply(this,a);IG$.MmD$m.superclass.constructor.call(this,{})};$s.extend(IG$.MmD$m,$s.window,{title:"Import datafile",modal:true,region:"center",layout:{type:"vbox",align:"stretch"},closable:false,resizable:false,width:600,height:500,uid:null,cubeuid:null,parentnodepath:null,itemtype:null,parentuid:null,defaults:{autoHeight:false,bodyStyle:"padding:4px"},mform:null,filekey:null,msgtitle:"Cube DataLoader",m1C:null,sKK1:function(c){var a=this;a.filekey=c;var b=new IG$._I3e();b.init(a,{ack:"27",payload:'<smsg><item uid="'+c+'" rowlimit="100"/></smsg>',mbody:IG$._I2e({option:"readexcelcontent"})},a,a.rs_sKK1,null);b._l()},rs_sKK1:function(c){var d=this,b=$(".dataview",d.body.dom),a=new IG$._IF1(c,100),e=d._0x030;e.width=b.clientWidth;e.height=b.clientHeight;e.size=10;e.initialize(null,b);e.styles=a.styles;e.fixedCol=a.colfix;e.fixedRow=a.rowfix;e.setDataProvider(a.data);d.datastore.clearData();for(i=0;i<a.data[0].length;i++){d.m1C.push({nodepath:null,uid:null,name:"",columnIndex:i})}d.datastore.loadData(d.m1C)},P2C:function(a){var b=this,c=b.editingRowIndex;c.data.uid=a.uid;c.data.nodepath=a.nodepath;c.data.name=a.name;b.datastore.loadData(b.m1C)},P3C:function(a,b){var c=this;c.metricmapping[a].data.uid=b.uid;c.metricmapping[a].data.nodepath=b.nodepath;c.metricmapping[a].data.name=b.name;c.datastore.loadData(c.m1C)},initComponent:function(){this._0x030=new IG$.cMa();var c=this;this.m1C=[];var b=["nodepath","name","columnIndex","uid"];this.datastore=$s.create("Ext.data.ArrayStore",{fields:b});this.mform=new Ext.form.Panel({width:400,bodyPadding:5,customowner:this,frame:true,border:false,items:[{xtype:"fieldcontainer",layout:"hbox",border:false,items:[{xtype:"fileuploadfield",name:"photo",fieldLabel:"Data",labelWidth:50,msgTarget:"side",allowBlank:false,width:280,buttonText:"Select File..."},{xtype:"button",text:"Upload",handler:function(){if(this.mform.getForm().isValid()){this.mform.getForm().submit({url:ig$.servlet,waitMsg:"Uploading your data file",success:function(d,g){IG$._I54("Success","Processed file on the server",null,null,0,"success");var f=IG$._I18(d.errorReader.xmlData,"/smsg/Result"),e=IG$._I1b(f,"uid");d.customowner.sKK1.call(d.customowner,e)}})}},scope:this}]}]});var a=Ext.create(IG$._I98,{cubebrowse:true,rootuid:c.cubeuid,enableDragDrop:true,enabledrag:true,useArrows:true,ddGroup:"_I$RD_G_"});this.G1=Ext.create("Ext.grid.Panel",{flex:2,multiSelect:false,reserveScrollOffset:true,store:c.datastore,border:1,panel:this,columns:[{text:"Column Index",header:"Column Index",width:90,dataIndex:"columnIndex"},{text:"Metric Item",header:"Metric Item",flex:1,dataIndex:"name"}],listeners:{itemdblclick:function(f,d,k,g,l){c.editingRowIndex=c.m1C[g];var m=new IG$._I96({u5x:{cubebrowse:true,rootuid:c.cubeuid}});m.callback=new IG$._I3d(c,c.P2C);IG$._I_5(this,m)},render:function(d){var e=this;e.dropZone=Ext.create("Ext.grid.ViewDropZone",{view:e,ddGroup:"_I$RD_G_",getTargetFromEvent:function(p){var o=p.getTarget(this.view.view.getItemSelector()),l,k,g,m,f,n;if(!o){l=p.getPageY();for(m=0,k=this.view.view.getNodes(),f=k.length;m<f;m++){g=k[m];n=Ext.fly(g).getBox();if(l<=n.bottom){return g}}}return o},onNodeEnter:function(l,f,k,g){},onNodeOut:function(l,f,k,g){},onNodeOver:function(l,f,k,g){return Ext.dd.DropZone.prototype.dropAllowed},onNodeDrop:function(g,q,p,k){var l,v=k.records[0].data;var s=this.view,t=s.getStore(),o,f,l,n;var m=s.view.getRecord(g);var u=m.data.columnIndex;s.panel.P3C.call(s.panel,u,v)}})}}});$s.apply(this,{items:[{html:"Step 1: Upload Datafile",flex:1,border:false},{xtype:"container",border:true,flex:8,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",border:true,flex:2,layout:"fit",items:[a]},{xtype:"container",border:true,flex:5,layout:{type:"vbox",align:"stretch"},items:[this.mform,{html:'<div class="dataview"></div>',flex:2,height:200,border:false},this.G1]}]}],buttons:[{text:"Confirm",handler:function(){this.P1C.call(this)},scope:this},{text:"Close",handler:function(){this.close()},scope:this}],_IG0:function(){this.close()},listeners:{afterrender:function(d){d.mform.getForm().errorReader=new IG$.m2ER()}}});IG$.MmD$m.superclass.initComponent.apply(this,arguments)}});